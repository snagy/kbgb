!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="src/",n(n.s=13)}([function(e,t){e.exports=BABYLON},function(e,t){e.exports=BABYLON.GUI},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t,n,r){e.exports=function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){var n=t[a][1][e];return i(n||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var o=!1,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,a,s,u,l,c=[],h=0,f=e.length,d=f,p="string"!==r.getTypeOf(e);h<e.length;)d=f-h,p?(t=e[h++],n=h<f?e[h++]:0,i=h<f?e[h++]:0):(t=e.charCodeAt(h++),n=h<f?e.charCodeAt(h++):0,i=h<f?e.charCodeAt(h++):0),a=t>>2,s=(3&t)<<4|n>>4,u=d>1?(15&n)<<2|i>>6:64,l=d>2?63&i:64,c.push(o.charAt(a)+o.charAt(s)+o.charAt(u)+o.charAt(l));return c.join("")},n.decode=function(e){var t,n,r,a,s,u,l=0,c=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===o.charAt(64)&&f--,e.charAt(e.length-2)===o.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|f):new Array(0|f);l<e.length;)t=o.indexOf(e.charAt(l++))<<2|(a=o.indexOf(e.charAt(l++)))>>4,n=(15&a)<<4|(s=o.indexOf(e.charAt(l++)))>>2,r=(3&s)<<6|(u=o.indexOf(e.charAt(l++))),h[c++]=t,64!==s&&(h[c++]=n),64!==u&&(h[c++]=r);return h}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";var r=e("./external"),i=e("./stream/DataWorker"),o=e("./stream/DataLengthProbe"),a=e("./stream/Crc32Probe");function s(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}o=e("./stream/DataLengthProbe"),s.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,n){return e.pipe(new a).pipe(new o("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";var r=e("./utils"),i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==r.getTypeOf(e)?function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}(0|t,e,e.length,0):function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t.charCodeAt(s))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:r}},{lie:37}],7:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),o=e("./utils"),a=e("./stream/GenericWorker"),s=r?"uint8array":"array";function u(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",o.inherits(u,a),u.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,e.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new u("Deflate",e)},n.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){"use strict";var r=e("../utils"),i=e("../stream/GenericWorker"),o=e("../utf8"),a=e("../crc32"),s=e("../signature"),u=function(e,t){var n,r="";for(n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},l=function(e,t,n,i,l,c){var h,f,d=e.file,p=e.compression,m=c!==o.utf8encode,g=r.transformTo("string",c(d.name)),D=r.transformTo("string",o.utf8encode(d.name)),y=d.comment,b=r.transformTo("string",c(y)),w=r.transformTo("string",o.utf8encode(y)),C=D.length!==d.name.length,v=w.length!==y.length,A="",x="",E="",_=d.dir,F=d.date,k={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(k.crc32=e.crc32,k.compressedSize=e.compressedSize,k.uncompressedSize=e.uncompressedSize);var B=0;t&&(B|=8),m||!C&&!v||(B|=2048);var T,S,M,I=0,O=0;_&&(I|=16),"UNIX"===l?(O=798,I|=(T=d.unixPermissions,S=_,M=T,T||(M=S?16893:33204),(65535&M)<<16)):(O=20,I|=63&(d.dosPermissions||0)),h=F.getUTCHours(),h<<=6,h|=F.getUTCMinutes(),h<<=5,h|=F.getUTCSeconds()/2,f=F.getUTCFullYear()-1980,f<<=4,f|=F.getUTCMonth()+1,f<<=5,f|=F.getUTCDate(),C&&(x=u(1,1)+u(a(g),4)+D,A+="up"+u(x.length,2)+x),v&&(E=u(1,1)+u(a(b),4)+w,A+="uc"+u(E.length,2)+E);var z="";return z+="\n\0",z+=u(B,2),z+=p.magic,z+=u(h,2),z+=u(f,2),z+=u(k.crc32,4),z+=u(k.compressedSize,4),z+=u(k.uncompressedSize,4),z+=u(g.length,2),z+=u(A.length,2),{fileRecord:s.LOCAL_FILE_HEADER+z+g+A,dirRecord:s.CENTRAL_FILE_HEADER+u(O,2)+z+u(b.length,2)+"\0\0\0\0"+u(I,4)+u(i,4)+g+A+b}},c=function(e){return s.DATA_DESCRIPTOR+u(e.crc32,4)+u(e.compressedSize,4)+u(e.uncompressedSize,4)};function h(e,t,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(h,i),h.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},h.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=l(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=l(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:c(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,o){var a=r.transformTo("string",o(i));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+u(e,2)+u(e,2)+u(t,4)+u(n,4)+u(a.length,2)+a}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},h.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},h.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var r=e("../compressions"),i=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var o=new i(t.streamFiles,n,t.platform,t.encodeFileName),a=0;try{e.forEach((function(e,n){a++;var i=function(e,t){var n=e||t,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),s=n.options.compressionOptions||t.compressionOptions||{},u=n.dir,l=n.date;n._compressWorker(i,s).withStreamInfo("file",{name:e,dir:u,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(o)})),o.entriesCount=a}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=e("./object"),r.prototype.loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.5.0",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./external"),o=e("./utf8"),a=(r=e("./utils"),e("./zipEntries")),s=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function l(e){return new i.Promise((function(t,n){var r=e.decompressed.getContentWorker().pipe(new s);r.on("error",(function(e){n(e)})).on("end",(function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new a(t);return n.load(e),n})).then((function(e){var n=[i.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var o=0;o<r.length;o++)n.push(l(r[o]));return i.Promise.all(n)})).then((function(e){for(var r=e.shift(),i=r.files,o=0;o<i.length;o++){var a=i[o];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";var r=e("../utils"),i=e("../stream/GenericWorker");function o(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(o,i),o.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},o.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";var r=e("readable-stream").Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),n&&n(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,r),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,n,r){"use strict";n.exports={isNode:void 0!==t,newBufferFrom:function(e,n){if(t.from&&t.from!==Uint8Array.from)return t.from(e,n);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new t(e,n)},allocBuffer:function(e){if(t.alloc)return t.alloc(e);var n=new t(e);return n.fill(0),n},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){"use strict";var r=e("./utf8"),i=e("./utils"),o=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),s=e("./defaults"),u=e("./compressedObject"),l=e("./zipObject"),c=e("./generate"),h=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),d=function(e,t,n){var r,a=i.getTypeOf(t),c=i.extend(n||{},s);c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(e=m(e)),c.createFolders&&(r=p(e))&&g.call(this,r,!0);var d="string"===a&&!1===c.binary&&!1===c.base64;n&&void 0!==n.binary||(c.binary=!d),(t instanceof u&&0===t.uncompressedSize||c.dir||!t||0===t.length)&&(c.base64=!1,c.binary=!0,t="",c.compression="STORE",a="string");var D=null;D=t instanceof u||t instanceof o?t:h.isNode&&h.isStream(t)?new f(e,t):i.prepareContent(e,t,c.binary,c.optimizedBinaryString,c.base64);var y=new l(e,D,c);this.files[e]=y},p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:s.createFolders,e=m(e),this.files[e]||d.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function D(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,r))},filter:function(e){var t=[];return this.forEach((function(n,r){e(n,r)&&t.push(r)})),t},file:function(e,t,n){if(1===arguments.length){if(D(e)){var r=e;return this.filter((function(e,t){return!t.dir&&r.test(e)}))}var i=this.files[this.root+e];return i&&!i.dir?i:null}return e=this.root+e,d.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(D(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=g.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=i.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var s=n.comment||this.comment||"";t=c.generateWorker(this,n,s)}catch(e){(t=new o("error")).error(e)}return new a(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){"use strict";var r=e("./DataReader");function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&n===o[1]&&r===o[2]&&i===o[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";var r=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,n){"use strict";var r=e("./Uint8ArrayReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";var r=e("./DataReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";var r=e("./ArrayReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var r=e("../utils"),i=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),s=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new s(e):i.uint8array?new u(r.transformTo("uint8array",e)):new o(r.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){"use strict";var r=e("./GenericWorker"),i=e("../utils");function o(e){r.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(o,r),o.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";var r=e("./GenericWorker"),i=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(o,i),o.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}r.inherits(o,i),o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],29:[function(e,n,r){"use strict";var i=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),s=e("../base64"),u=e("../support"),l=e("../external"),c=null;if(u.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function h(e,n){return new l.Promise((function(r,o){var a=[],u=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,t){a.push(e),n&&n(t)})).on("error",(function(e){a=[],o(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return s.encode(t);default:return i.transformTo(e,t)}}(l,function(e,n){var r,i=0,o=null,a=0;for(r=0;r<n.length;r++)a+=n[r].length;switch(e){case"string":return n.join("");case"array":return Array.prototype.concat.apply([],n);case"uint8array":for(o=new Uint8Array(a),r=0;r<n.length;r++)o.set(n[r],i),i+=n[r].length;return o;case"nodebuffer":return t.concat(n);default:throw new Error("concat : unsupported type '"+e+"'")}}(u,a),c);r(e)}catch(e){o(e)}a=[]})).resume()}))}function f(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=n,i.checkSupport(r),this._worker=e.pipe(new o(r)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}f.prototype={accumulate:function(e){return h(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,n)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==t,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=0===o.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";for(var r=e("./utils"),i=e("./support"),o=e("./nodejsUtils"),a=e("./stream/GenericWorker"),s=new Array(256),u=0;u<256;u++)s[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function l(){a.call(this,"utf-8 decode"),this.leftOver=null}function c(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,n.utf8encode=function(e){return i.nodebuffer?o.newBufferFrom(e,"utf-8"):function(e){var t,n,r,o,a,s=e.length,u=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=i.uint8array?new Uint8Array(u):new Array(u),a=0,o=0;a<u;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t}(e)},n.utf8decode=function(e){return i.nodebuffer?r.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,o,a=e.length,u=new Array(2*a);for(n=0,t=0;t<a;)if((i=e[t++])<128)u[n++]=i;else if((o=s[i])>4)u[n++]=65533,t+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&t<a;)i=i<<6|63&e[t++],o--;o>1?u[n++]=65533:i<65536?u[n++]=i:(i-=65536,u[n++]=55296|i>>10&1023,u[n++]=56320|1023&i)}return u.length!==n&&(u.subarray?u=u.subarray(0,n):u.length=n),r.applyFromCharCode(u)}(e=r.transformTo(i.uint8array?"uint8array":"array",e))},r.inherits(l,a),l.prototype.processChunk=function(e){var t=r.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=t;(t=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),t.set(o,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var a=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}(t),u=t;a!==t.length&&(i.uint8array?(u=t.subarray(0,a),this.leftOver=t.subarray(a,t.length)):(u=t.slice(0,a),this.leftOver=t.slice(a,t.length))),this.push({data:n.utf8decode(u),meta:e.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=l,r.inherits(c,a),c.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){"use strict";var r=e("./support"),i=e("./base64"),o=e("./nodejsUtils"),a=e("set-immediate-shim"),s=e("./external");function u(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,n){var r=[],i=0,o=e.length;if(o<=n)return String.fromCharCode.apply(null,e);for(;i<o;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,o)))):r.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,o)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(e){return!1}}()}};function h(e){var t=65536,r=n.getTypeOf(e),i=!0;if("uint8array"===r?i=c.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=c.applyCanBeUsed.nodebuffer),i)for(;t>1;)try{return c.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function f(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=h;var d={};d.string={string:u,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return d.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,o.allocBuffer(e.length))}},d.array={string:h,array:u,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(e)}},d.arraybuffer={string:function(e){return h(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:u,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(new Uint8Array(e))}},d.uint8array={string:h,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:u,nodebuffer:function(e){return o.newBufferFrom(e)}},d.nodebuffer={string:h,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return d.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:u},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var r=n.getTypeOf(t);return d[r][e](t)},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":r.nodebuffer&&o.isBuffer(e)?"nodebuffer":r.uint8array&&e instanceof Uint8Array?"uint8array":r.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!r[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)r+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return r},n.delay=function(e,t,n){a((function(){e.apply(n||null,t||[])}))},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,o,a,u){return s.Promise.resolve(t).then((function(e){return r.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new s.Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)})):e})).then((function(t){var c,h=n.getTypeOf(t);return h?("arraybuffer"===h?t=n.transformTo("uint8array",t):"string"===h&&(u?t=i.decode(t):o&&!0!==a&&(t=l(c=t,r.uint8array?new Uint8Array(c.length):new Array(c.length)))),t):s.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,n){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),o=e("./signature"),a=e("./zipEntry"),s=(e("./utf8"),e("./support"));function u(e){this.files=[],this.loadOptions=e}u.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=t-n;if(r>0)this.isSignature(t,o.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),o=e("./compressedObject"),a=e("./crc32"),s=e("./utf8"),u=e("./compressions"),l=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r};e.setIndex(i)},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var o=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)||a(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)||a(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";var r=e("./stream/StreamHelper"),i=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),s=e("./stream/GenericWorker"),u=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};u.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(t=t.pipe(new o.Utf8EncodeWorker)),!a&&i&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new s("error")).error(e)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<l.length;h++)u.prototype[l[h]]=c;t.exports=u},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(c),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var u=new e.MessageChannel;u.port1.onmessage=c,n=function(){u.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||n()}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){"use strict";var r=e("immediate");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var a=p((function(){t(i,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);return this.state!==u?h(n,this.state===s?e:t,this.outcome):this.queue.push(new c(n,e,t)),n},c.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){o.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,u=-1,l=new this(i);++u<n;)c(e[u],u);return l;function c(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(l,a))}),(function(e){r||(r=!0,o.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a,s=-1,u=new this(i);++s<n;)a=e[s],t.resolve(a).then((function(e){r||(r=!0,o.resolve(u,e))}),(function(e){r||(r=!0,o.reject(u,e))}));return u}},{immediate:36}],38:[function(e,t,n){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){"use strict";var r=e("./zlib/deflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,c)))throw new Error(a[n]);this._dict_set=!0}}function c(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}l.prototype.push=function(e,t){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=r.deflate(s,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),s.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=l,n.deflate=c,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){"use strict";var r=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),u=e("./zlib/zstream"),l=e("./zlib/gzheader"),c=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new l,r.inflateGetHeader(this.strm,this.header)}function f(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(e,t){var n,s,u,l,h,f,d=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?d.input=o.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(p),d.next_out=0,d.avail_out=p),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(f="string"==typeof m?o.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,n=r.inflateSetDictionary(this.strm,f)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(d.output,d.next_out),l=d.next_out-u,h=o.buf2string(d.output,u),d.next_out=l,d.avail_out=p-l,l&&i.arraySet(d.output,d.output,u,l,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=h,n.inflate=f,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},n.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(r)},{}],42:[function(e,t,n){"use strict";var r=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,i,o,a,s=e.length,u=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return u(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,o,s=t||e.length,l=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)l[r++]=i;else if((o=a[i])>4)l[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&e[n++],o--;o>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return u(l,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],44:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],46:[function(e,t,n){"use strict";var r,i=e("../utils/common"),o=e("./trees"),a=e("./adler32"),s=e("./crc32"),u=e("./messages");function l(e,t){return e.msg=u[t],t}function c(e){return(e<<1)-(e>4?9:0)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function f(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function d(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,f(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function g(e,t){var n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+258,d=l[o+a-1],p=l[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===p&&l[n+a-1]===d&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<f);if(r=258-(f-o),o=f-258,r>a){if(e.match_start=t,a=r,r>=s)break;d=l[o+a-1],p=l[o+a]}}}while((t=h[t&c])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function D(e){var t,n,r,o,u,l,c,h,f,d,p=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);o+=p}if(0===e.strm.avail_in)break;if(l=e.strm,c=e.window,h=e.strstart+e.lookahead,f=o,d=void 0,(d=l.avail_in)>f&&(d=f),n=0===d?0:(l.avail_in-=d,i.arraySet(c,l.input,l.next_in,d,h),1===l.state.wrap?l.adler=a(l.adler,c,d,h):2===l.state.wrap&&(l.adler=s(l.adler,c,d,h)),l.next_in+=d,l.total_in+=d,d),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function y(e,t){for(var n,r;;){if(e.lookahead<262){if(D(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=g(e,n)),e.match_length>=3)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var n,r,i;;){if(e.lookahead<262){if(D(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=g(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(d(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&d(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function w(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):l(e,-2)}function A(e){var t,n=v(e);return 0===n&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function x(e,t,n,r,o,a){if(!e)return-2;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||a<0||a>4)return l(e,-2);8===r&&(r=9);var u=new C;return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=n,A(e)}r=[new w(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(D(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,d(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(d(e,!1),e.strm.avail_out),1)})),new w(4,4,8,4,y),new w(4,5,16,8,y),new w(4,6,32,32,y),new w(4,4,16,16,b),new w(8,16,32,32,b),new w(8,16,128,128,b),new w(8,32,128,256,b),new w(32,128,258,1024,b),new w(32,258,258,4096,b)],n.deflateInit=function(e,t){return x(e,t,8,15,8,0)},n.deflateInit2=x,n.deflateReset=A,n.deflateResetKeep=v,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},n.deflate=function(e,t){var n,i,a,u;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var g=8+(i.w_bits-8<<4)<<8;g|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=32),g+=31-g%31,i.status=113,m(i,g),0!==i.strstart&&(m(i,e.adler>>>16),m(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),f(e),a=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),f(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),f(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&f(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(f(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&c(t)<=c(n)&&4!==t)return l(e,-5);if(666===i.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var y=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(D(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,a,s=e.window;;){if(e.lookahead<=258){if(D(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=e.strstart+258;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=258-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==y&&4!==y||(i.status=666),1===y||3===y)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===y&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(h(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),f(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(m(i,e.adler>>>16),m(i,65535&e.adler)),f(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},n.deflateSetDictionary=function(e,t){var n,r,o,s,u,l,c,f,d=t.length;if(!e||!e.state)return-2;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return-2;for(1===s&&(e.adler=a(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new i.Buf8(n.w_size),i.arraySet(f,t,d-n.w_size,n.w_size,0),t=f,d=n.w_size),u=e.avail_in,l=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,D(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,D(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=c,e.avail_in=u,n.wrap=s,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,i,o,a,s,u,l,c,h,f,d,p,m,g,D,y,b,w,C,v,A,x,E,_;n=e.state,r=e.next_in,E=e.input,i=r+(e.avail_in-5),o=e.next_out,_=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),u=n.dmax,l=n.wsize,c=n.whave,h=n.wnext,f=n.window,d=n.hold,p=n.bits,m=n.lencode,g=n.distcode,D=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(d+=E[r++]<<p,p+=8,d+=E[r++]<<p,p+=8),b=m[d&D];t:for(;;){if(d>>>=w=b>>>24,p-=w,0==(w=b>>>16&255))_[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=m[(65535&b)+(d&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}C=65535&b,(w&=15)&&(p<w&&(d+=E[r++]<<p,p+=8),C+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=E[r++]<<p,p+=8,d+=E[r++]<<p,p+=8),b=g[d&y];n:for(;;){if(d>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=g[(65535&b)+(d&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(v=65535&b,p<(w&=15)&&(d+=E[r++]<<p,(p+=8)<w&&(d+=E[r++]<<p,p+=8)),(v+=d&(1<<w)-1)>u){e.msg="invalid distance too far back",n.mode=30;break e}if(d>>>=w,p-=w,v>(w=o-a)){if((w=v-w)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(A=0,x=f,0===h){if(A+=l-w,w<C){C-=w;do{_[o++]=f[A++]}while(--w);A=o-v,x=_}}else if(h<w){if(A+=l+h-w,(w-=h)<C){C-=w;do{_[o++]=f[A++]}while(--w);if(A=0,h<C){C-=w=h;do{_[o++]=f[A++]}while(--w);A=o-v,x=_}}}else if(A+=h-w,w<C){C-=w;do{_[o++]=f[A++]}while(--w);A=o-v,x=_}for(;C>2;)_[o++]=x[A++],_[o++]=x[A++],_[o++]=x[A++],C-=3;C&&(_[o++]=x[A++],C>1&&(_[o++]=x[A++]))}else{A=o-v;do{_[o++]=_[A++],_[o++]=_[A++],_[o++]=_[A++],C-=3}while(C>2);C&&(_[o++]=_[A++],C>1&&(_[o++]=_[A++]))}break}}break}}while(r<i&&o<s);r-=C=p>>3,d&=(1<<(p-=C<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=d,n.bits=p}},{}],49:[function(e,t,n){"use strict";var r=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees");function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,c(e)):-2}function f(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,h(e))):-2}function d(e,t){var n,r;return e?(r=new l,e.state=r,r.window=null,0!==(n=f(e,t))&&(e.state=null),n):-2}var p,m,g=!0;function D(e){if(g){var t;for(p=new r.Buf32(512),m=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,m,0,e.work,{bits:5}),g=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}function y(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}n.inflateReset=h,n.inflateReset2=f,n.inflateResetKeep=c,n.inflateInit=function(e){return d(e,15)},n.inflateInit2=d,n.inflate=function(e,t){var n,l,c,h,f,d,p,m,g,b,w,C,v,A,x,E,_,F,k,B,T,S,M,I,O=0,z=new r.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),f=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,l=e.input,d=e.avail_in,m=n.hold,g=n.bits,b=d,w=p,S=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;g<16;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(2&n.wrap&&35615===m){n.check=0,z[0]=255&m,z[1]=m>>>8&255,n.check=o(n.check,z,2,0),m=0,g=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",n.mode=30;break}if(g-=4,T=8+(15&(m>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&m?10:12,m=0,g=0;break;case 2:for(;g<16;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(n.flags=m,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(z[0]=255&m,z[1]=m>>>8&255,n.check=o(n.check,z,2,0)),m=0,g=0,n.mode=3;case 3:for(;g<32;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.head&&(n.head.time=m),512&n.flags&&(z[0]=255&m,z[1]=m>>>8&255,z[2]=m>>>16&255,z[3]=m>>>24&255,n.check=o(n.check,z,4,0)),m=0,g=0,n.mode=4;case 4:for(;g<16;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(z[0]=255&m,z[1]=m>>>8&255,n.check=o(n.check,z,2,0)),m=0,g=0,n.mode=5;case 5:if(1024&n.flags){for(;g<16;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(z[0]=255&m,z[1]=m>>>8&255,n.check=o(n.check,z,2,0)),m=0,g=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((C=n.length)>d&&(C=d),C&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,l,h,C,T)),512&n.flags&&(n.check=o(n.check,l,C,h)),d-=C,h+=C,n.length-=C),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===d)break e;C=0;do{T=l[h+C++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&C<d);if(512&n.flags&&(n.check=o(n.check,l,C,h)),d-=C,h+=C,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===d)break e;C=0;do{T=l[h+C++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&C<d);if(512&n.flags&&(n.check=o(n.check,l,C,h)),d-=C,h+=C,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;g<16;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(m!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}m=0,g=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;g<32;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}e.adler=n.check=u(m),m=0,g=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=m,n.bits=g,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){m>>>=7&g,g-=7&g,n.mode=27;break}for(;g<3;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}switch(n.last=1&m,g-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(D(n),n.mode=20,6===t){m>>>=2,g-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}m>>>=2,g-=2;break;case 14:for(m>>>=7&g,g-=7&g;g<32;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,m=0,g=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(C=n.length){if(C>d&&(C=d),C>p&&(C=p),0===C)break e;r.arraySet(c,l,h,C,f),d-=C,h+=C,p-=C,f+=C,n.length-=C;break}n.mode=12;break;case 17:for(;g<14;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(n.nlen=257+(31&m),m>>>=5,g-=5,n.ndist=1+(31&m),m>>>=5,g-=5,n.ncode=4+(15&m),m>>>=4,g-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;g<3;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.lens[P[n.have++]]=7&m,m>>>=3,g-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,M={bits:n.lenbits},S=s(0,n.lens,0,19,n.lencode,0,n.work,M),n.lenbits=M.bits,S){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;E=(O=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,_=65535&O,!((x=O>>>24)<=g);){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(_<16)m>>>=x,g-=x,n.lens[n.have++]=_;else{if(16===_){for(I=x+2;g<I;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(m>>>=x,g-=x,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],C=3+(3&m),m>>>=2,g-=2}else if(17===_){for(I=x+3;g<I;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}g-=x,T=0,C=3+(7&(m>>>=x)),m>>>=3,g-=3}else{for(I=x+7;g<I;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}g-=x,T=0,C=11+(127&(m>>>=x)),m>>>=7,g-=7}if(n.have+C>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;C--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,M={bits:n.lenbits},S=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,M),n.lenbits=M.bits,S){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,M={bits:n.distbits},S=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,M),n.distbits=M.bits,S){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(d>=6&&p>=258){e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=m,n.bits=g,a(e,w),f=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,l=e.input,d=e.avail_in,m=n.hold,g=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;E=(O=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,_=65535&O,!((x=O>>>24)<=g);){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(E&&0==(240&E)){for(F=x,k=E,B=_;E=(O=n.lencode[B+((m&(1<<F+k)-1)>>F)])>>>16&255,_=65535&O,!(F+(x=O>>>24)<=g);){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}m>>>=F,g-=F,n.back+=F}if(m>>>=x,g-=x,n.back+=x,n.length=_,0===E){n.mode=26;break}if(32&E){n.back=-1,n.mode=12;break}if(64&E){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&E,n.mode=22;case 22:if(n.extra){for(I=n.extra;g<I;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;E=(O=n.distcode[m&(1<<n.distbits)-1])>>>16&255,_=65535&O,!((x=O>>>24)<=g);){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(0==(240&E)){for(F=x,k=E,B=_;E=(O=n.distcode[B+((m&(1<<F+k)-1)>>F)])>>>16&255,_=65535&O,!(F+(x=O>>>24)<=g);){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}m>>>=F,g-=F,n.back+=F}if(m>>>=x,g-=x,n.back+=x,64&E){e.msg="invalid distance code",n.mode=30;break}n.offset=_,n.extra=15&E,n.mode=24;case 24:if(n.extra){for(I=n.extra;g<I;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===p)break e;if(C=w-p,n.offset>C){if((C=n.offset-C)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}C>n.wnext?(C-=n.wnext,v=n.wsize-C):v=n.wnext-C,C>n.length&&(C=n.length),A=n.window}else A=c,v=f-n.offset,C=n.length;C>p&&(C=p),p-=C,n.length-=C;do{c[f++]=A[v++]}while(--C);0===n.length&&(n.mode=21);break;case 26:if(0===p)break e;c[f++]=n.length,p--,n.mode=21;break;case 27:if(n.wrap){for(;g<32;){if(0===d)break e;d--,m|=l[h++]<<g,g+=8}if(w-=p,e.total_out+=w,n.total+=w,w&&(e.adler=n.check=n.flags?o(n.check,c,w,f-w):i(n.check,c,w,f-w)),w=p,(n.flags?m:u(m))!==n.check){e.msg="incorrect data check",n.mode=30;break}m=0,g=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;g<32;){if(0===d)break e;d--,m+=l[h++]<<g,g+=8}if(m!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}m=0,g=0}n.mode=29;case 29:S=1;break e;case 30:S=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=m,n.bits=g,(n.wsize||w!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&y(e,e.output,e.next_out,w-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,n.total+=w,n.wrap&&w&&(e.adler=n.check=n.flags?o(n.check,c,w,e.next_out-w):i(n.check,c,w,e.next_out-w)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===b&&0===w||4===t)&&0===S&&(S=-5),S)},n.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},n.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:y(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){"use strict";var r=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,u,l,c,h,f){var d,p,m,g,D,y,b,w,C,v=f.bits,A=0,x=0,E=0,_=0,F=0,k=0,B=0,T=0,S=0,M=0,I=null,O=0,z=new r.Buf16(16),P=new r.Buf16(16),R=null,N=0;for(A=0;A<=15;A++)z[A]=0;for(x=0;x<u;x++)z[t[n+x]]++;for(F=v,_=15;_>=1&&0===z[_];_--);if(F>_&&(F=_),0===_)return l[c++]=20971520,l[c++]=20971520,f.bits=1,0;for(E=1;E<_&&0===z[E];E++);for(F<E&&(F=E),T=1,A=1;A<=15;A++)if(T<<=1,(T-=z[A])<0)return-1;if(T>0&&(0===e||1!==_))return-1;for(P[1]=0,A=1;A<15;A++)P[A+1]=P[A]+z[A];for(x=0;x<u;x++)0!==t[n+x]&&(h[P[t[n+x]]++]=x);if(0===e?(I=R=h,y=19):1===e?(I=i,O-=257,R=o,N-=257,y=256):(I=a,R=s,y=-1),M=0,x=0,A=E,D=c,k=F,B=0,m=-1,g=(S=1<<F)-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){b=A-B,h[x]<y?(w=0,C=h[x]):h[x]>y?(w=R[N+h[x]],C=I[O+h[x]]):(w=96,C=0),d=1<<A-B,E=p=1<<k;do{l[D+(M>>B)+(p-=d)]=b<<24|w<<16|C|0}while(0!==p);for(d=1<<A-1;M&d;)d>>=1;if(0!==d?(M&=d-1,M+=d):M=0,x++,0==--z[A]){if(A===_)break;A=t[n+h[x]]}if(A>F&&(M&g)!==m){for(0===B&&(B=F),D+=E,T=1<<(k=A-B);k+B<_&&!((T-=z[k+B])<=0);)k++,T<<=1;if(S+=1<<k,1===e&&S>852||2===e&&S>592)return 1;l[m=M&g]=F<<24|k<<16|D-c|0}}return 0!==M&&(l[D+M]=A-B<<24|64<<16|0),f.bits=F,0}},{"../utils/common":41}],51:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){"use strict";var r=e("../utils/common");function i(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=new Array(576);i(l);var c=new Array(60);i(c);var h=new Array(512);i(h);var f=new Array(256);i(f);var d=new Array(29);i(d);var p,m,g,D=new Array(30);function y(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function w(e){return e<256?h[e]:h[256+(e>>>7)]}function C(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function v(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,C(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function A(e,t,n){v(e,n[2*t],n[2*t+1])}function x(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function E(e,t,n){var r,i,o=new Array(16),a=0;for(r=1;r<=15;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=x(o[s]++,s))}}function _(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function F(e){e.bi_valid>8?C(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function k(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function B(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&k(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!k(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function T(e,t,n){var r,i,s,u,l=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===r?A(e,i,t):(A(e,(s=f[i])+256+1,t),0!==(u=o[s])&&v(e,i-=d[s],u),A(e,s=w(--r),n),0!==(u=a[s])&&v(e,r-=D[s],u))}while(l<e.last_lit);A(e,256,t)}function S(e,t){var n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==o[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)B(e,o,n);i=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],B(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,B(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,a,s,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=u[2*u[2*(r=e.heap[n])+1]+1]+1)>p&&(o=p,m++),u[2*r+1]=o,r>l||(e.bl_count[o]++,a=0,r>=d&&(a=f[r-d]),s=u[2*r],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(c[2*r+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>l||(u[2*i+1]!==o&&(e.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),r--)}}(e,t),E(o,l,e.bl_count)}function M(e,t,n){var r,i,o=-1,a=t[1],s=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<u&&i===a||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(u=138,l=3):i===a?(u=6,l=3):(u=7,l=4))}function I(e,t,n){var r,i,o=-1,a=t[1],s=0,u=7,l=4;for(0===a&&(u=138,l=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<u&&i===a)){if(s<l)do{A(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(A(e,i,e.bl_tree),s--),A(e,16,e.bl_tree),v(e,s-3,2)):s<=10?(A(e,17,e.bl_tree),v(e,s-3,3)):(A(e,18,e.bl_tree),v(e,s-11,7));s=0,o=i,0===a?(u=138,l=3):i===a?(u=6,l=3):(u=7,l=4)}}i(D);var O=!1;function z(e,t,n,i){v(e,0+(i?1:0),3),function(e,t,n,i){F(e),i&&(C(e,n),C(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}n._tr_init=function(e){O||(function(){var e,t,n,r,i,u=new Array(16);for(n=0,r=0;r<28;r++)for(d[r]=n,e=0;e<1<<o[r];e++)f[n++]=r;for(f[n-1]=r,i=0,r=0;r<16;r++)for(D[r]=i,e=0;e<1<<a[r];e++)h[i++]=r;for(i>>=7;r<30;r++)for(D[r]=i<<7,e=0;e<1<<a[r]-7;e++)h[256+i++]=r;for(t=0;t<=15;t++)u[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,u[8]++;for(;e<=255;)l[2*e+1]=9,e++,u[9]++;for(;e<=279;)l[2*e+1]=7,e++,u[7]++;for(;e<=287;)l[2*e+1]=8,e++,u[8]++;for(E(l,287,u),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=x(e,5);p=new y(l,o,257,286,15),m=new y(c,a,0,30,15),g=new y(new Array(0),s,0,19,7)}(),O=!0),e.l_desc=new b(e.dyn_ltree,p),e.d_desc=new b(e.dyn_dtree,m),e.bl_desc=new b(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,_(e)},n._tr_stored_block=z,n._tr_flush_block=function(e,t,n,r){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),S(e,e.l_desc),S(e,e.d_desc),a=function(e){var t;for(M(e,e.dyn_ltree,e.l_desc.max_code),M(e,e.dyn_dtree,e.d_desc.max_code),S(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?z(e,t,n,r):4===e.strategy||o===i?(v(e,2+(r?1:0),3),T(e,l,c)):(v(e,4+(r?1:0),3),function(e,t,n,r){var i;for(v(e,t-257,5),v(e,n-1,5),v(e,r-4,4),i=0;i<r;i++)v(e,e.bl_tree[2*u[i]+1],3);I(e,e.dyn_ltree,t-1),I(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),T(e,e.dyn_ltree,e.dyn_dtree)),_(e),r&&F(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(f[n]+256+1)]++,e.dyn_dtree[2*w(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){v(e,2,3),A(e,256,l),function(e){16===e.bi_valid?(C(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){"use strict";t.exports="function"==typeof r?r:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)}).call(this,n(5).Buffer,n(2),n(9).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=function(){this.color="#cccccc",this.labels=[],this.textColor=[],this.textSize=[],this.default={textColor:"#000000",textSize:3},this.x=0,this.y=0,this.width=1,this.height=1,this.x2=0,this.y2=0,this.width2=1,this.height2=1,this.rotation_x=0,this.rotation_y=0,this.rotation_angle=0,this.decal=!1,this.ghost=!1,this.stepped=!1,this.nub=!1,this.profile="",this.sm="",this.sb="",this.st=""};t.Key=i;var o=function(){this.author="",this.backcolor="#eeeeee",this.background=null,this.name="",this.notes="",this.radii="",this.switchBrand="",this.switchMount="",this.switchType=""};t.KeyboardMetadata=o;var a=function(){this.meta=new o,this.keys=[]};t.Keyboard=a;var s=function(){function e(){}return e.copy=function(t){if("object"!=typeof t)return t;if(t instanceof Array){for(var n=[],r=0;r<t.length;r++)n[r]=e.copy(t[r]);return n}var i=Object.create(Object.getPrototypeOf(t));for(var o in t.constructor&&i.constructor(),t)"function"==typeof t[o]&&i[o]||(i[o]=e.copy(t[o]));return i},e.reorderLabelsIn=function(t,n,r){void 0===r&&(r=null);for(var i=[],o=0;o<t.length;++o)t[o]&&t[o]!==r&&(i[e.labelMap[n][o]]=t[o]);return i},e.deserializeError=function(e,t){throw"Error: "+e+(t?":\n  "+r.stringify(t):"")},e.deserialize=function(t){t instanceof Array||e.deserializeError("expected an array of objects");for(var n=new i,r=new a,o=4,s=0;s<t.length;++s)if(t[s]instanceof Array){for(var u=0;u<t[s].length;++u){var l=t[s][u];if("string"==typeof l){var c=e.copy(n);c.width2=0===c.width2?n.width:n.width2,c.height2=0===c.height2?n.height:n.height2,c.labels=e.reorderLabelsIn(l.split("\n"),o),c.textSize=e.reorderLabelsIn(c.textSize,o);for(var h=0;h<12;++h)c.labels[h]||(delete c.textSize[h],delete c.textColor[h]),c.textSize[h]==c.default.textSize&&delete c.textSize[h],c.textColor[h]==c.default.textColor&&delete c.textColor[h];r.keys.push(c),n.x+=n.width,n.width=n.height=1,n.x2=n.y2=n.width2=n.height2=0,n.nub=n.stepped=n.decal=!1}else{if(0==u||null==l.r&&null==l.rx&&null==l.ry||e.deserializeError("rotation can only be specified on the first key in a row",l),null!=l.r&&(n.rotation_angle=l.r),null!=l.rx&&(n.rotation_x=l.rx),null!=l.ry&&(n.rotation_y=l.ry),null!=l.a&&(o=l.a),l.f&&(n.default.textSize=l.f,n.textSize=[]),l.f2)for(h=1;h<12;++h)n.textSize[h]=l.f2;if(l.fa&&(n.textSize=l.fa),l.p&&(n.profile=l.p),l.c&&(n.color=l.c),l.t){var f=l.t.split("\n");n.default.textColor=f[0],n.textColor=e.reorderLabelsIn(f,o,n.default.textColor)}l.x&&(n.x+=l.x),l.y&&(n.y+=l.y),l.w&&(n.width=n.width2=l.w),l.h&&(n.height=n.height2=l.h),l.x2&&(n.x2=l.x2),l.y2&&(n.y2=l.y2),l.w2&&(n.width2=l.w2),l.h2&&(n.height2=l.h2),l.n&&(n.nub=l.n),l.l&&(n.stepped=l.l),l.d&&(n.decal=l.d),null!=l.g&&(n.ghost=l.g),l.sm&&(n.sm=l.sm),l.sb&&(n.sb=l.sb),l.st&&(n.st=l.st)}}n.y++,n.x=n.rotation_x}else if("object"==typeof t[s])for(var d in 0!=s&&e.deserializeError("keyboard metadata must the be first element",t[s]),r.meta)t[s][d]&&(r.meta[d]=t[s][d]);return r},e.parse=function(t){return e.deserialize(r.parse(t))},e.labelMap=[[0,6,2,8,9,11,3,5,1,4,7,10],[1,7,-1,-1,9,11,4,-1,-1,-1,-1,10],[3,-1,5,-1,9,11,-1,-1,4,-1,-1,10],[4,-1,-1,-1,9,11,-1,-1,-1,-1,-1,10],[0,6,2,8,10,-1,3,5,1,4,7,-1],[1,7,-1,-1,10,-1,4,-1,-1,-1,-1,-1],[3,-1,5,-1,10,-1,-1,-1,4,-1,-1,-1],[4,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,-1]],e}();t.Serial=s},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(6),i=n(7),o=n(8);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|d(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|d(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return B(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return F(this,t,n);case"latin1":case"binary":return k(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function D(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=n;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(l(e,o+f)!==l(t,f)){h=!1;break}if(h)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function w(e,t,n,r){return j(V(t,e.length-n),e,n,r)}function C(e,t,n,r){return j(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function v(e,t,n,r){return C(e,t,n,r)}function A(e,t,n,r){return j(U(t),e,n,r)}function x(e,t,n,r){return j(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function _(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,l=e[i],c=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&l)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return l(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?_(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(r,i),c=e.slice(t,n),h=0;h<s;++h)if(l[h]!==c[h]){o=l[h],a=c[h];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return D(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return D(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return C(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return A(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function F(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function B(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=L(e[o]);return i}function T(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function S(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function I(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function O(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function z(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(e,t,n,r,o){return o||z(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function R(e,t,n,r,o){return o||z(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||S(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||S(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||S(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||S(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||S(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||S(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||S(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||S(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||S(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||S(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||S(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||S(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||S(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||S(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||S(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):O(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):O(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=u.isBuffer(e)?e:V(new u(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function U(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(2))},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=l(e),a=r[0],s=r[1],u=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),c=0,h=s>0?a-4:a;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[c++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(c(e,a,a+16383>s?s:a+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=l}return(d?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+d]=255&a,d+=p,a/=256,l-=8);e[n+d-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(10),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(2))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,u=1,l={},c=!1,h=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){o.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&p(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return l[u]=i,r(u),u++},f.clearImmediate=d}function d(e){delete l[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=l[e];if(t){c=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(2),n(11))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,l=[],c=!1,h=-1;function f(){c&&u&&(c=!1,u.length?l=u.concat(l):h=-1,l.length&&d())}function d(){if(!c){var e=s(f);c=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){e.exports=function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}var t=e((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),n=e((function(e){var t=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=t)})),r=(n.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),i=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e},o=function(e){try{return!!e()}catch(e){return!0}},a=!o((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s=t.document,u=r(s)&&r(s.createElement),l=!a&&!o((function(){return 7!=Object.defineProperty((e="div",u?s.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),c=Object.defineProperty,h={f:a?Object.defineProperty:function(e,t,n){if(i(e),t=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}(t,!0),i(n),l)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},f=a?function(e,t,n){return h.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,n))}:function(e,t,n){return e[t]=n,e},d={}.hasOwnProperty,p=function(e,t){return d.call(e,t)},m=0,g=Math.random(),D=e((function(e){var r=t["__core-js_shared__"]||(t["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})}))("native-function-to-string",Function.toString),y=e((function(e){var r=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++m+g).toString(36))}("src"),i=(""+D).split("toString");n.inspectSource=function(e){return D.call(e)},(e.exports=function(e,n,o,a){var s="function"==typeof o;s&&(p(o,"name")||f(o,"name",n)),e[n]!==o&&(s&&(p(o,r)||f(o,r,e[n]?""+e[n]:i.join(String(n)))),e===t?e[n]=o:a?e[n]?e[n]=o:f(e,n,o):(delete e[n],f(e,n,o)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[r]||D.call(this)}))})),b=function(e,t,n){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},w=function(e,r,i){var o,a,s,u,l=e&w.F,c=e&w.G,h=e&w.S,d=e&w.P,p=e&w.B,m=c?t:h?t[r]||(t[r]={}):(t[r]||{}).prototype,g=c?n:n[r]||(n[r]={}),D=g.prototype||(g.prototype={});for(o in c&&(i=r),i)s=((a=!l&&m&&void 0!==m[o])?m:i)[o],u=p&&a?b(s,t):d&&"function"==typeof s?b(Function.call,s):s,m&&y(m,o,s,e&w.U),g[o]!=s&&f(g,o,u),d&&D[o]!=s&&(D[o]=s)};t.core=n,w.F=1,w.G=2,w.S=4,w.P=8,w.B=16,w.W=32,w.U=64,w.R=128;var C,v=w,A=Math.ceil,x=Math.floor,E=function(e){return isNaN(e=+e)?0:(e>0?x:A)(e)},_=(C=!1,function(e,t){var n,r,i=String(function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}(e)),o=E(t),a=i.length;return o<0||o>=a?C?"":void 0:(n=i.charCodeAt(o))<55296||n>56319||o+1===a||(r=i.charCodeAt(o+1))<56320||r>57343?C?i.charAt(o):n:C?i.slice(o,o+2):r-56320+(n-55296<<10)+65536});v(v.P,"String",{codePointAt:function(e){return _(this,e)}}),n.String.codePointAt;var F=Math.max,k=Math.min,B=function(e,t){return(e=E(e))<0?F(e+t,0):k(e,t)},T=String.fromCharCode,S=String.fromCodePoint;v(v.S+v.F*(!!S&&1!=S.length),"String",{fromCodePoint:function(e){for(var t,n=arguments,r=[],i=arguments.length,o=0;i>o;){if(t=+n[o++],B(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?T(t):T(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}}),n.String.fromCodePoint;var M,I,O,z,P,R,N,L,V,U,j,G,H,$,Y={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},W=function(e){return"string"==typeof e&&Y.Space_Separator.test(e)},Z=function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||"$"===e||"_"===e||Y.ID_Start.test(e))},K=function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"$"===e||"_"===e||""===e||""===e||Y.ID_Continue.test(e))},X=function(e){return"string"==typeof e&&/[0-9]/.test(e)},q=function(e){return"string"==typeof e&&/[0-9A-Fa-f]/.test(e)};function J(){for(U="default",j="",G=!1,H=1;;){$=Q();var e=te[U]();if(e)return e}}function Q(){if(M[z])return String.fromCodePoint(M.codePointAt(z))}function ee(){var e=Q();return"\n"===e?(P++,R=0):e?R+=e.length:R++,e&&(z+=e.length),e}var te={default:function(){switch($){case"\t":case"\v":case"\f":case" ":case"":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void ee();case"/":return ee(),void(U="comment");case void 0:return ee(),ne("eof")}if(!W($))return te[I]();ee()},comment:function(){switch($){case"*":return ee(),void(U="multiLineComment");case"/":return ee(),void(U="singleLineComment")}throw ue(ee())},multiLineComment:function(){switch($){case"*":return ee(),void(U="multiLineCommentAsterisk");case void 0:throw ue(ee())}ee()},multiLineCommentAsterisk:function(){switch($){case"*":return void ee();case"/":return ee(),void(U="default");case void 0:throw ue(ee())}ee(),U="multiLineComment"},singleLineComment:function(){switch($){case"\n":case"\r":case"\u2028":case"\u2029":return ee(),void(U="default");case void 0:return ee(),ne("eof")}ee()},value:function(){switch($){case"{":case"[":return ne("punctuator",ee());case"n":return ee(),re("ull"),ne("null",null);case"t":return ee(),re("rue"),ne("boolean",!0);case"f":return ee(),re("alse"),ne("boolean",!1);case"-":case"+":return"-"===ee()&&(H=-1),void(U="sign");case".":return j=ee(),void(U="decimalPointLeading");case"0":return j=ee(),void(U="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return j=ee(),void(U="decimalInteger");case"I":return ee(),re("nfinity"),ne("numeric",1/0);case"N":return ee(),re("aN"),ne("numeric",NaN);case'"':case"'":return G='"'===ee(),j="",void(U="string")}throw ue(ee())},identifierNameStartEscape:function(){if("u"!==$)throw ue(ee());ee();var e=ie();switch(e){case"$":case"_":break;default:if(!Z(e))throw ce()}j+=e,U="identifierName"},identifierName:function(){switch($){case"$":case"_":case"":case"":return void(j+=ee());case"\\":return ee(),void(U="identifierNameEscape")}if(!K($))return ne("identifier",j);j+=ee()},identifierNameEscape:function(){if("u"!==$)throw ue(ee());ee();var e=ie();switch(e){case"$":case"_":case"":case"":break;default:if(!K(e))throw ce()}j+=e,U="identifierName"},sign:function(){switch($){case".":return j=ee(),void(U="decimalPointLeading");case"0":return j=ee(),void(U="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return j=ee(),void(U="decimalInteger");case"I":return ee(),re("nfinity"),ne("numeric",H*(1/0));case"N":return ee(),re("aN"),ne("numeric",NaN)}throw ue(ee())},zero:function(){switch($){case".":return j+=ee(),void(U="decimalPoint");case"e":case"E":return j+=ee(),void(U="decimalExponent");case"x":case"X":return j+=ee(),void(U="hexadecimal")}return ne("numeric",0*H)},decimalInteger:function(){switch($){case".":return j+=ee(),void(U="decimalPoint");case"e":case"E":return j+=ee(),void(U="decimalExponent")}if(!X($))return ne("numeric",H*Number(j));j+=ee()},decimalPointLeading:function(){if(X($))return j+=ee(),void(U="decimalFraction");throw ue(ee())},decimalPoint:function(){switch($){case"e":case"E":return j+=ee(),void(U="decimalExponent")}return X($)?(j+=ee(),void(U="decimalFraction")):ne("numeric",H*Number(j))},decimalFraction:function(){switch($){case"e":case"E":return j+=ee(),void(U="decimalExponent")}if(!X($))return ne("numeric",H*Number(j));j+=ee()},decimalExponent:function(){switch($){case"+":case"-":return j+=ee(),void(U="decimalExponentSign")}if(X($))return j+=ee(),void(U="decimalExponentInteger");throw ue(ee())},decimalExponentSign:function(){if(X($))return j+=ee(),void(U="decimalExponentInteger");throw ue(ee())},decimalExponentInteger:function(){if(!X($))return ne("numeric",H*Number(j));j+=ee()},hexadecimal:function(){if(q($))return j+=ee(),void(U="hexadecimalInteger");throw ue(ee())},hexadecimalInteger:function(){if(!q($))return ne("numeric",H*Number(j));j+=ee()},string:function(){switch($){case"\\":return ee(),void(j+=function(){switch(Q()){case"b":return ee(),"\b";case"f":return ee(),"\f";case"n":return ee(),"\n";case"r":return ee(),"\r";case"t":return ee(),"\t";case"v":return ee(),"\v";case"0":if(ee(),X(Q()))throw ue(ee());return"\0";case"x":return ee(),function(){var e="",t=Q();if(!q(t))throw ue(ee());if(e+=ee(),t=Q(),!q(t))throw ue(ee());return e+=ee(),String.fromCodePoint(parseInt(e,16))}();case"u":return ee(),ie();case"\n":case"\u2028":case"\u2029":return ee(),"";case"\r":return ee(),"\n"===Q()&&ee(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw ue(ee())}return ee()}());case'"':return G?(ee(),ne("string",j)):void(j+=ee());case"'":return G?void(j+=ee()):(ee(),ne("string",j));case"\n":case"\r":throw ue(ee());case"\u2028":case"\u2029":!function(e){console.warn("JSON5: '"+he(e)+"' in strings is not valid ECMAScript; consider escaping")}($);break;case void 0:throw ue(ee())}j+=ee()},start:function(){switch($){case"{":case"[":return ne("punctuator",ee())}U="value"},beforePropertyName:function(){switch($){case"$":case"_":return j=ee(),void(U="identifierName");case"\\":return ee(),void(U="identifierNameStartEscape");case"}":return ne("punctuator",ee());case'"':case"'":return G='"'===ee(),void(U="string")}if(Z($))return j+=ee(),void(U="identifierName");throw ue(ee())},afterPropertyName:function(){if(":"===$)return ne("punctuator",ee());throw ue(ee())},beforePropertyValue:function(){U="value"},afterPropertyValue:function(){switch($){case",":case"}":return ne("punctuator",ee())}throw ue(ee())},beforeArrayValue:function(){if("]"===$)return ne("punctuator",ee());U="value"},afterArrayValue:function(){switch($){case",":case"]":return ne("punctuator",ee())}throw ue(ee())},end:function(){throw ue(ee())}};function ne(e,t){return{type:e,value:t,line:P,column:R}}function re(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if(Q()!==r)throw ue(ee());ee()}}function ie(){for(var e="",t=4;t-- >0;){var n=Q();if(!q(n))throw ue(ee());e+=ee()}return String.fromCodePoint(parseInt(e,16))}var oe={start:function(){if("eof"===N.type)throw le();ae()},beforePropertyName:function(){switch(N.type){case"identifier":case"string":return L=N.value,void(I="afterPropertyName");case"punctuator":return void se();case"eof":throw le()}},afterPropertyName:function(){if("eof"===N.type)throw le();I="beforePropertyValue"},beforePropertyValue:function(){if("eof"===N.type)throw le();ae()},beforeArrayValue:function(){if("eof"===N.type)throw le();"punctuator"!==N.type||"]"!==N.value?ae():se()},afterPropertyValue:function(){if("eof"===N.type)throw le();switch(N.value){case",":return void(I="beforePropertyName");case"}":se()}},afterArrayValue:function(){if("eof"===N.type)throw le();switch(N.value){case",":return void(I="beforeArrayValue");case"]":se()}},end:function(){}};function ae(){var e;switch(N.type){case"punctuator":switch(N.value){case"{":e={};break;case"[":e=[]}break;case"null":case"boolean":case"numeric":case"string":e=N.value}if(void 0===V)V=e;else{var t=O[O.length-1];Array.isArray(t)?t.push(e):t[L]=e}if(null!==e&&"object"==typeof e)O.push(e),I=Array.isArray(e)?"beforeArrayValue":"beforePropertyName";else{var n=O[O.length-1];I=null==n?"end":Array.isArray(n)?"afterArrayValue":"afterPropertyValue"}}function se(){O.pop();var e=O[O.length-1];I=null==e?"end":Array.isArray(e)?"afterArrayValue":"afterPropertyValue"}function ue(e){return fe(void 0===e?"JSON5: invalid end of input at "+P+":"+R:"JSON5: invalid character '"+he(e)+"' at "+P+":"+R)}function le(){return fe("JSON5: invalid end of input at "+P+":"+R)}function ce(){return fe("JSON5: invalid identifier character at "+P+":"+(R-=5))}function he(e){var t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){var n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function fe(e){var t=new SyntaxError(e);return t.lineNumber=P,t.columnNumber=R,t}return{parse:function(e,t){M=String(e),I="start",O=[],z=0,P=1,R=0,N=void 0,L=void 0,V=void 0;do{N=J(),oe[I]()}while("eof"!==N.type);return"function"==typeof t?function e(t,n,r){var i=t[n];if(null!=i&&"object"==typeof i)for(var o in i){var a=e(i,o,r);void 0===a?delete i[o]:i[o]=a}return r.call(t,n,i)}({"":V},"",t):V},stringify:function(e,t,n){var r,i,o,a=[],s="",u="";if(null==t||"object"!=typeof t||Array.isArray(t)||(n=t.space,o=t.quote,t=t.replacer),"function"==typeof t)i=t;else if(Array.isArray(t)){r=[];for(var l=0,c=t;l<c.length;l+=1){var h=c[l],f=void 0;"string"==typeof h?f=h:("number"==typeof h||h instanceof String||h instanceof Number)&&(f=String(h)),void 0!==f&&r.indexOf(f)<0&&r.push(f)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),"number"==typeof n?n>0&&(n=Math.min(10,Math.floor(n)),u="          ".substr(0,n)):"string"==typeof n&&(u=n.substr(0,10)),d("",{"":e});function d(e,t){var n=t[e];switch(null!=n&&("function"==typeof n.toJSON5?n=n.toJSON5(e):"function"==typeof n.toJSON&&(n=n.toJSON(e))),i&&(n=i.call(t,e,n)),n instanceof Number?n=Number(n):n instanceof String?n=String(n):n instanceof Boolean&&(n=n.valueOf()),n){case null:return"null";case!0:return"true";case!1:return"false"}return"string"==typeof n?p(n):"number"==typeof n?String(n):"object"==typeof n?Array.isArray(n)?function(e){if(a.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");a.push(e);var t=s;s+=u;for(var n,r=[],i=0;i<e.length;i++){var o=d(String(i),e);r.push(void 0!==o?o:"null")}if(0===r.length)n="[]";else if(""===u){var l=r.join(",");n="["+l+"]"}else{var c=",\n"+s,h=r.join(c);n="[\n"+s+h+",\n"+t+"]"}return a.pop(),s=t,n}(n):function(e){if(a.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");a.push(e);var t=s;s+=u;for(var n,i,o=r||Object.keys(e),l=[],c=0,h=o;c<h.length;c+=1){var f=h[c],p=d(f,e);if(void 0!==p){var g=m(f)+":";""!==u&&(g+=" "),g+=p,l.push(g)}}if(0===l.length)n="{}";else if(""===u)i=l.join(","),n="{"+i+"}";else{var D=",\n"+s;i=l.join(D),n="{\n"+s+i+",\n"+t+"}"}return a.pop(),s=t,n}(n):void 0}function p(e){for(var t={"'":.1,'"':.2},n={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},r="",i=0;i<e.length;i++){var a=e[i];switch(a){case"'":case'"':t[a]++,r+=a;continue;case"\0":if(X(e[i+1])){r+="\\x00";continue}}if(n[a])r+=n[a];else if(a<" "){var s=a.charCodeAt(0).toString(16);r+="\\x"+("00"+s).substring(s.length)}else r+=a}var u=o||Object.keys(t).reduce((function(e,n){return t[e]<t[n]?e:n}));return u+(r=r.replace(new RegExp(u,"g"),n[u]))+u}function m(e){if(0===e.length)return p(e);var t=String.fromCodePoint(e.codePointAt(0));if(!Z(t))return p(e);for(var n=t.length;n<e.length;n++)if(!K(String.fromCodePoint(e.codePointAt(n))))return p(e);return e}}}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"loadKeyboardFromPath",(function(){return kt})),n.d(t,"getKBPathFromIdx",(function(){return Tt})),n.d(t,"loadNextKeyboard",(function(){return St})),n.d(t,"loadPrevKeyboard",(function(){return Mt}));const r={renderData:{keys:{},cases:{},mats:{},uiOutlines:{}},pcbData:{},keyAssets:{}},i={keyDims:[18,18],switchCutout:[14,14],base1U:[19.05,19.05],bezelGap:1.05,bezelCornerFillet:1,screwTypes:{m2_simple:{minBoss:1.5,screwHoleRadius:1.15,standoffRadius:1.6},m2_5_hex_standoffs:{minBoss:1.5,screwHoleRadius:1.45,hexSize:4.5},m3_tallnut:{minBoss:1.5,screwHoleRadius:1.65,nutRadius:2.1}},screwSideBuffer:0,keyShape:"square",drawCase:!0,drawBezel:!0,drawPlate:!0,drawPCB:!0,drawCaseFoam:!0,drawPlateFoam:!0,bezelThickness:{min:5.5,max:30},caseCornerFillet:{min:.5,max:15},defaultCase:{bezelThickness:10,bezelConcavity:1,caseCornerFillet:6,screwSideBuffer:0,maxScrewSpan:150,screwBezelBias:.5,forceSymmetrical:!1,hasUSBPort:!1,usbPortPos:1.85,usbPortCentered:!0,forcePCBSymmetrical:!1,material:"pom_white"},caseMats:{ac_clear:{metallic:0,roughness:.2,baseColor:[190/255,190/255,190/255],albedoColor:[1,1,1],alpha:.6},ac_blue:{metallic:0,roughness:.2,baseColor:[12/255,237/255,239/255],albedoColor:[1,1,1],alpha:.75},ac_smoke:{metallic:0,roughness:.2,baseColor:[12/255,12/255,12/255],albedoColor:[.5,.5,.5],alpha:.75},ac_purple:{metallic:0,roughness:.2,baseColor:[98/255,7/255,147/255],albedoColor:[1,1,1],alpha:.82},ac_yellow:{metallic:0,roughness:.2,baseColor:[1,247/255,71/255],albedoColor:[1,1,1],alpha:.84},pc_cl:{metallic:0,roughness:.8,baseColor:[200/255,200/255,200/255],albedoColor:[1,1,1],alpha:.85},aluminium:{alpha:1,metallic:1,roughness:.2,albedoColor:[.5,.5,.5]},brass:{alpha:1,metallic:1,roughness:.2,albedoColor:[181/255,166/255,66/255]},pom_white:{alpha:1,metallic:0,roughness:.4,albedoColor:[.9,.9,.9]},pom_black:{alpha:1,metallic:0,roughness:.4,albedoColor:[.02,.02,.02]},steel:{alpha:1,metallic:1,roughness:.05,albedoColor:[.3,.3,.3]},fr4:{alpha:1,metallic:0,roughness:.15,albedoColor:[45/255,90/255,10/255]},foam_white:{alpha:1,metallic:0,roughness:.8,albedoColor:[.85,.85,.85]},foam_black:{alpha:1,metallic:0,roughness:.8,albedoColor:[.1,.1,.1]}}};var o=n(0);const a={};function s(e,t){let n=r.renderData.mats;n[e]||(n[e]=new o.PBRMetallicRoughnessMaterial(e,r.scene),n[e].metallic=0,n[e].transparencyMode=o.PBRMaterial.PBRMATERIAL_OPAQUE,n[e].roughness=.6,n[e].baseColor=t)}function u(e,t){let n=r.renderData.mats,a=i.caseMats[t];n[e]||(n[e]=new o.PBRMaterial(e,r.scene));let s=n[e];for(const[e,t]of Object.entries(a))Array.isArray(t)?s[e]=new o.Color3(t[0],t[1],t[2]):s[e]=t;s.alpha<=.99?(s.subSurface.isRefractionEnabled=!0,s.subSurface.refractionIntensity=.9,s.subSurface.indexOfRefraction=1.13,s.subSurface.tintColor=s.baseColor,s.subSurface.linkRefractionWithTransparency=!1,s.subSurface.isTranslucencyEnabled=!0,s.subSurface.useAlbedoToTintRefraction=!0):(s.subSurface.isRefractionEnabled=!1,s.subSurface.isTranslucencyEnabled=!1,s.transparencyMode=o.PBRMaterial.PBRMATERIAL_OPAQUE)}function l(e){const t=[1e5,1e5],n=[-1e5,-1e5];for(const[e,i]of Object.entries(r.renderData.cases))for(let e=0;e<2;e++)t[e]=Math.min(t[e],i.bounds.mins[e]),n[e]=Math.max(n[e],i.bounds.maxs[e]);ke();const i=n[0]-t[0]+60,a=n[1]-t[1]+60,s=Math.max(i,a);let u=r.camera;u.setTarget(new o.Vector3(t[0]+(n[0]-t[0])/2,0,t[1]+(n[1]-t[1])/2));let l=-Math.PI/3.5,c=Math.PI/3.5;u.inputs.attached.keyboard.detachControl(),u.inputs.attached.pointers.detachControl(),"top"!=e&&(u.inputs.attachInput(u.inputs.attached.pointers),u.inputs.attachInput(u.inputs.attached.keyboard)),u.fov=.3,u.lowerRadiusLimit=75,u.upperRadiusLimit=1500,"top"==e?(l=-Math.PI/2,c=0,u.fov=.1,u.upperRadiusLimit=7500):"front"==e?(l=-Math.PI/2,c=Math.PI/4):"rear"==e?(l=-Math.PI/3.5+Math.PI,c=Math.PI/2.3):"split"==e&&(l=-Math.PI/3.5,c=Math.PI/2.25),u.radius=.5*s/Math.tan(.5*u.fov);let h=new o.QuinticEase;h.setEasingMode(o.EasingFunction.EASINGMODE_EASEOUT),o.Animation.CreateMergeAndStartAnimation("camAlpha",u,"alpha",30,12,u.alpha,l,o.Animation.ANIMATIONLOOPMODE_CONSTANT,h),o.Animation.CreateMergeAndStartAnimation("camBeta",u,"beta",30,12,u.beta,c,o.Animation.ANIMATIONLOOPMODE_CONSTANT,h)}const c={};function h(e,t,n){c[e]&&r.scene.removeMesh(c[e]),c[e]=o.MeshBuilder.CreateLineSystem(e,{lines:t,colors:n},r.scene)}function f(e,t,n,r,i){let a=[],s=[];n=n||new o.Color4(1,0,0,1),r=r||new o.Color4(0,0,1,1);let u=i?t.length:t.length-1;for(let e=0;e<u;e++)a.push([t[e],t[(e+1)%t.length]]),s.push([n,r]);h(e,a,s)}function d(e){if(a.shadowGenerator){a.shadowGenerator.addShadowCaster(e),e.receiveShadows=!0;for(const t of e.getChildMeshes())t.receiveShadows=!0}}function p(e){e.parent=null,r.scene.removeMesh(e),a.shadowGenerator&&a.shadowGenerator.removeShadowCaster(e),e.dispose()}const m=[o.Color3.FromHexString("#bef4ff"),o.Color3.FromHexString("#ffdcbe"),o.Color3.FromHexString("#f6ef7c"),o.Color3.FromHexString("#879171"),o.Color3.FromHexString("#c98a68"),o.Color3.FromHexString("#d3a8b2"),o.Color3.FromHexString("#73a8b2"),o.Color3.FromHexString("#e4d4cd"),o.Color3.FromHexString("#eabc68"),o.Color3.FromHexString("#739484"),o.Color3.FromHexString("#a08a8c"),o.Color3.FromHexString("#a79070")],g=new o.Color3,D=new o.Color3;const y={container:null,details:null},b={KAT:{},DSA:{},KAM:{},KRK:{}};function w(e,t,n,r){const i=b[e];if(!i)return null;let a=o.Matrix.Identity();"KAM"==e?(r.vertical?(t=n,n=1,a=o.Matrix.RotationY(Math.PI/2)):a=o.Matrix.RotationY(Math.PI),a=a.multiply(o.Matrix.Scaling(-1,1,1))):"KAT"==e?a=o.Matrix.RotationY(Math.PI):"KRK"==e&&r.vertical&&(2===n?r.h=n:(t=n,n=1,a=o.Matrix.RotationY(Math.PI/2)));const s=i[t];if(!s)return null;let u=null,l=-100,c=null;for(const[e,t]of Object.entries(s)){const e=t.container,n=t.details;let i=5;for(const[e,t]of Object.entries(r))n[e]==t&&(i+=1);for(const[e,t]of Object.entries(n))r[e]||(i-=2);i>l&&(u=e,l=i,c=n)}return{container:u,preXform:a}}const C={"0r_1u.glb":{r:0,w:1},"1r_1u.glb":{r:1,w:1},"1r_2u.glb":{r:1,w:2},"2r_1u.glb":{r:2,w:1},"2r_2u_VERTICAL.glb":{r:2,h:2,w:1,vertical:!0},"2r_1_5u.glb":{r:2,w:1.5},"2r_1_75u.glb":{r:2,w:1.75},"3r_1u.glb":{r:3,w:1},"3r_1u_nub.glb":{r:3,w:1,nub:!0},"3r_1u_scoop.glb":{r:3,w:1,scooped:!0},"3r_1_25u.glb":{r:3,w:1.25},"3r_1_5u.glb":{r:3,w:1.5},"3r_1_75u.glb":{r:3,w:1.75},"3r_1_75u_STEPPED.glb":{r:3,w:1.5,stepped:!0},"3r_2_25u.glb":{r:3,w:2.25},"4r_1u.glb":{r:4,w:1},"4r_1_75u.glb":{r:4,w:1.75},"4r_2u_VERTICAL.glb":{r:4,h:2,w:1,vertical:!0},"4r_2_25u.glb":{r:4,w:2.25},"4r_2_75u.glb":{r:4,w:2.75},"5r_1u.glb":{r:5,w:1},"5r_1_5u.glb":{r:5,w:1.5},"5r_1_25u.glb":{r:5,w:1.25},"5r_1u_c.glb":{r:5,w:1,convex:!0},"5r_1_25u_c.glb":{r:5,w:1.25,convex:!0},"5r_1_5u_c.glb":{r:5,w:1.5,convex:!0},"5r_1_75u_c.glb":{r:5,w:1.75,convex:!0},"5r_2u_c.glb":{r:5,w:2,convex:!0},"5r_2_25u_c.glb":{r:5,w:2.25,convex:!0},"5r_2_75u_c.glb":{r:5,w:2.75,convex:!0},"5r_3u_c.glb":{r:5,w:3,convex:!0},"5r_6u_c.glb":{r:5,w:6,convex:!0},"5r_6_25u_c.glb":{r:5,w:6.25,convex:!0},"5r_7u_c.glb":{r:5,w:7,convex:!0},"ISO_enter.glb":{r:"special",w:1.25,special:"ISO"},"BAE.glb":{r:"special",w:1.5,special:"BAE"}};function v(e){r.canvas=document.getElementById("renderCanvas"),r.debugCanvas=document.getElementById("debugCanvas"),r.engine=new o.Engine(r.canvas,!0),r.scene=function(){const e=r.engine;var t=new o.Scene(e),n=new o.ArcRotateCamera("Camera",-Math.PI/2,0,100,new o.Vector3(0,0,0),t);n.setTarget(o.Vector3.Zero()),n.alpha=-Math.PI/3.5,n.beta=Math.PI/3.5,n.fov=.3,n.lowerRadiusLimit=75,n.upperRadiusLimit=1500,n.attachControl(r.canvas,!1),r.camera=n,t.clearColor=m[7];let i=0,a=Math.floor(Math.random()*m.length),s=Math.floor(a+.5*m.length)%m.length;return t.clearColor=g,t.registerBeforeRender((function(){o.Color3.LerpToRef(m[a],m[(a+1)%m.length],i,g),o.Color3.LerpToRef(m[s],m[(s+1)%m.length],i,D),i+=25e-5,i>=1&&(i=0,a=(a+1)%m.length,s=(s+1)%m.length)})),r.engine.runRenderLoop((function(){t.render()})),t}();let t=[];r.scene.getOutlineRenderer().zOffset=11,r.scene.environmentIntensity=.7;let n=new o.DirectionalLight("DirectionalLight",new o.Vector3(-.5,-.3,.28),r.scene);n.autoCalcShadowZBounds=!0,n.intensity=2,a.dirLight=n;t.push("MX_SWITCH_box.glb"),o.SceneLoader.LoadAssetContainer("assets/","MX_SWITCH_box.glb",r.scene,(function(n){y.container=n;let r=t.indexOf("MX_SWITCH_box.glb");r>=0&&t.splice(r,1),0===t.length&&e()}));for(const[n,i]of Object.entries(C))t.push(n),o.SceneLoader.LoadAssetContainer("assets/KRK/",n,r.scene,(function(r){b.KRK[i.w]||(b.KRK[i.w]=[]),b.KRK[i.w].push({container:r,details:i});let o=t.indexOf(n);o>=0&&t.splice(o,1),0===t.length&&e()}));!function(){let e=r.renderData.mats,t="keySel";if(e[t]||(e[t]=new o.StandardMaterial(t,r.scene),e[t].diffuseColor=new o.Color3(0,0,0),e[t].emissiveColor=new o.Color3(1,0,0),e[t].specularColor=new o.Color3(0,0,0)),t="rotHandle",e[t]||(e[t]=new o.StandardMaterial(t,r.scene),e[t].diffuseColor=new o.Color3(0,0,0),e[t].emissiveColor=new o.Color3(.7,.9,.4),e[t].alpha=.7,e[t].specularColor=new o.Color3(0,0,0)),t="layoutFrame",e[t]||(e[t]=new o.StandardMaterial(t,r.scene),e[t].diffuseColor=new o.Color3(0,0,0),e[t].emissiveColor=new o.Color3(.8,.8,.8),e[t].alpha=0,e[t].specularColor=new o.Color3(0,0,0)),t="gridMaterial",!e[t]){const n=new o.GridMaterial("gridMaterial",r.scene);n.majorUnitFrequency=4,n.minorUnitVisibility=0,n.gridRatio=4.7625,n.backFaceCulling=!1,n.mainColor=new o.Color3(1,1,1),n.lineColor=new o.Color3(1,1,1),n.opacity=.6,e[t]=n}for(const[e,t]of Object.entries(i.caseMats))u(e,e);e.switch||(e.switch=new o.PBRMaterial("switch",r.scene),e.switch.metallic=0,e.switch.transparencyMode=o.PBRMaterial.PBRMATERIAL_OPAQUE,e.switch.roughness=.7,e.switch.baseColor=new o.Color3(.1,.1,.1)),e.fr4||(e.fr4=new o.PBRMetallicRoughnessMaterial("fr4",r.scene),e.fr4.metallic=0,e.fr4.transparencyMode=o.PBRMaterial.PBRMATERIAL_OPAQUE,e.fr4.roughness=.2,e.fr4.baseColor=new o.Color3(45/255,90/255,10/255)),e.foam||(e.foam=new o.PBRMetallicRoughnessMaterial("foam",r.scene),e.foam.metallic=0,e.foam.transparencyMode=o.PBRMaterial.PBRMATERIAL_OPAQUE,e.foam.roughness=.9,e.foam.baseColor=new o.Color3(10/255,10/255,10/255)),s("key",new o.Color3(.9,.9,.9))}(),a.ground=o.MeshBuilder.CreateGround("ground1",{width:1e4,height:1e4},r.scene),a.ground.material=r.renderData.mats.gridMaterial,a.ground.isVisible=!1,a.frameHolder=o.MeshBuilder.CreateBox("frameHolder",{},r.scene),a.frameHolder.material=r.renderData.mats.layoutFrame,a.frameHolder.isVisible=!1}let A=0;function x(e){this.points=e,this.id=A++,this.overlappingPolys={},this.type="rect"}function E(e,t,n){return new x([o.Vector3.TransformCoordinates(new o.Vector3(-e,0,-t),n),o.Vector3.TransformCoordinates(new o.Vector3(e,0,-t),n),o.Vector3.TransformCoordinates(new o.Vector3(e,0,t),n),o.Vector3.TransformCoordinates(new o.Vector3(-e,0,t),n)])}function _(e){this.type=0,this.point=e}function F(e,t,n,r){this.type=1,this.center=e,this.radius=t,this.rotRadians=n,this.endRot=r}function k(e,t){this.type=2,this.center=e,this.radius=t}function B(e,t,n,r){let i=t.x*r.z-r.x*t.z;if(Math.abs(i)<o.Epsilon)return null;let a=e.x*t.x+e.z*t.z,s=n.x*r.x+n.z*r.z;return new o.Vector3((r.z*a-t.z*s)/i,0,(t.x*s-r.x*a)/i)}function T(e,t,n){let r=n.subtract(e),i=o.Vector3.Dot(r,t);return e.add(t.scale(i))}function S(e,t,n,r,i,a){const s=o.TmpVectors.Vector3[9];a.subtractToRef(i,s);let u={intersection:B(e,r,i,new o.Vector3(s.z,0,-s.x).normalize()),type:"unknown"};if(u.intersection){const r=o.TmpVectors.Vector3[0];u.intersection.subtractToRef(i,r);let l=o.Vector3.Dot(r,s);u.intersection.subtractToRef(a,r);let c=o.Vector3.Dot(r,s);u.intersection.subtractToRef(e,r);let h=o.Vector3.Dot(r,n);u.intersection.subtractToRef(t,r);let f=o.Vector3.Dot(r,n);h>-o.Epsilon&&f<o.Epsilon&&l>-o.Epsilon&&c<-o.Epsilon?u.type="in_segment":u.type="off_segment"}else if(function(e,t,n){let r=T(e,t.normalizeToNew(),n);return n.subtractToRef(r,o.TmpVectors.Vector3[0]),o.TmpVectors.Vector3[0].lengthSquared()}(e,n,i)<o.Epsilon){u.type="colinear",i.subtractToRef(e,o.TmpVectors.Vector3[0]),a.subtractToRef(e,o.TmpVectors.Vector3[1]),e.subtractToRef(i,o.TmpVectors.Vector3[2]),t.subtractToRef(i,o.TmpVectors.Vector3[3]),i.subtractToRef(t,o.TmpVectors.Vector3[4]),a.subtractToRef(t,o.TmpVectors.Vector3[5]),e.subtractToRef(a,o.TmpVectors.Vector3[6]),t.subtractToRef(a,o.TmpVectors.Vector3[7]);let r=o.Vector3.Dot(o.TmpVectors.Vector3[0],n)>-o.Epsilon&&o.Vector3.Dot(o.TmpVectors.Vector3[4],n)<o.Epsilon,l=o.Vector3.Dot(o.TmpVectors.Vector3[1],n)>-o.Epsilon&&o.Vector3.Dot(o.TmpVectors.Vector3[5],n)<o.Epsilon,c=o.Vector3.Dot(o.TmpVectors.Vector3[2],s)>-o.Epsilon&&o.Vector3.Dot(o.TmpVectors.Vector3[6],s)<o.Epsilon,h=o.Vector3.Dot(o.TmpVectors.Vector3[3],s)>-o.Epsilon&&o.Vector3.Dot(o.TmpVectors.Vector3[7],s)<o.Epsilon;(r||c||l||h)&&(u.isOverlapping=!0,u.x0In=c,u.y0In=r,u.x1In=h,u.y1In=l)}else u.type="parallel";return u}function M(e,t,n){let r=[];const i=o.TmpVectors.Vector3[7];t.subtractToRef(e,i);const a=o.TmpVectors.Vector3[8];a.x=i.z,a.y=0,a.z=-i.x,a.normalize();o.TmpVectors.Vector3[3];for(let o=0;o<n.length;o++){let s=S(e,t,i,a,n[o],n[(o+1)%n.length]);"in_segment"==s.type&&s.intersection?r.push(s.intersection):"colinear"==s.type&&r.push(n[o])}return r}function I(e,t){const n=o.TmpVectors.Vector3[6],r=o.TmpVectors.Vector3[7],i=o.TmpVectors.Vector3[8];r.y=0;for(let a=0;a<t.length;a++){let s=t[a];if(t[(a+1)%t.length].subtractToRef(s,n),n.normalize(),r.x=n.z,r.z=-n.x,e.subtractToRef(s,i),i.normalize(),o.Vector3.Dot(i,r)>o.Epsilon)return!1}return!0}function O(e,t){let n=(e,t)=>{const n=e.points,r=o.TmpVectors.Vector3[8];for(let e=0;e<n.length;e++){const i=n[e],a=n[(e+1)%n.length];r.x=a.z-i.z,r.z=i.x-a.x;let s=!0,u=!0;const l=t.points,c=o.TmpVectors.Vector3[1];for(let t=0;t<l.length;t++){l[t].subtractToRef(n[e],c);let i=o.Vector3.Dot(r,c);u&=i>o.Epsilon,s&=i<-o.Epsilon}if(u)return!1}return!0},r=n(e,t);return r&&(r=n(t,e)),r}function z(e){let t=Math.acos(e.x);return e.z<0&&(t=2*Math.PI-t),t}function P(e){return new o.Vector3(Math.cos(e),0,Math.sin(e))}function R(e){var t=[],n={xl:1e6,xr:-1e6,zt:1e6,zb:-1e6};for(const i of e)r=i,t.push(r),n.xl=Math.min(r.x,n.xl),n.xr=Math.max(r.x,n.xr),n.zt=Math.min(r.z,n.zt),n.zb=Math.max(r.z,n.zb);var r;n.xl-=1e4,n.zt-=1e4,n.xr+=1e4,n.zb+=1e4;return(new Voronoi).compute(t,n)}function N(e,t,n,r,i,a){let s=[],u=[],l=e,c=t,h=n,f=r;s.push(l[0]),u.push(t[0]);let d=l[0],p=c[0],m=l[1],g=c[1],D=2,y=!1;do{let e=m.subtract(d);const t=new o.Vector3(e.z,0,-e.x).normalize();let n=1e9,r=null,b=0,w=1e9,C=null;const v=e.lengthSquared()-o.Epsilon;for(let i=0;i<h.length;i++){const s=(i+1)%h.length,u=[h[i],h[s]],l=u[1].subtract(u[0]),c=new o.Vector3(l.z,0,-l.x).normalize();let f=S(d,m,e,t,u[0],u[1]);if("in_segment"===f.type&&f.intersection){let t=f.intersection.subtract(d).lengthSquared();if(t>o.Epsilon&&t<v){o.Vector3.Dot(c,e)<0^a?t<n&&(n=t,r=f.intersection,b=(i+1)%h.length):t<w&&(w=t,C=f.intersection)}}else if("colinear"===f.type&&f.isOverlapping){let t=u[1],i=(s+1)%h.length;o.Vector3.Dot(l,e)&&(f.y1In||(t=m,i=s));const a=o.TmpVectors.Vector3[6];t.subtractToRef(d,a);let c=a.lengthSquared();c>o.Epsilon*o.Epsilon&&c<=n-o.Epsilon&&(n=c,r=t,b=i)}}if(r||C){if(w<n)s.pop(),u.pop(),d=C,p=i;else{d=r,p=i;let e=h;h=l,l=e,e=f,f=c,c=e,D=b,m=l[D],g=c[D],D=(D+1)%l.length}y||(s=[],u=[],y=!0)}else d=m,p=g,m=l[D],g=c[D],D=(D+1)%l.length;if(s.push(d),u.push(p),s.length>1e4){console.log("boolean output overflow"),s=[],u=[];break}}while(s.length<=1||d.subtract(s[0]).lengthSquared()>o.Epsilon*o.Epsilon);return s.pop(),u.pop(),{outline:s,fillets:u}}function L(e,t,n){let r={},i=e.length;new o.Color4(1,0,0,1),new o.Color4(0,0,1,1),new o.Color4(0,1,0,1),new o.Color4(1,1,0,1);const a=o.TmpVectors.Vector3[0],s=o.TmpVectors.Vector3[1];for(let i=e.length-1;i>=0;i--){let u=e[i];const l=e[(i+1)%e.length];l.subtractToRef(u,a);const c=e[(i-1+e.length)%e.length];u.subtractToRef(c,s);let h=a.length(),f=s.length(),d=a.normalizeFromLength(h),p=s.normalizeFromLength(f),m=o.Vector3.Dot(p,d);if(m>.9999||m<-.9)e.splice(i,1),n&&n.splice(i,1);else if(h<.25||f<.25)e.splice(i,1),n&&n.splice(i,1);else if(t){let a=new o.Vector3(d.z,0,-d.x),s=new o.Vector3(p.z,0,-p.x),u=B(c.add(s.scale(t)),s,l.add(a.scale(t)),a);null!==u?r[i]=u:(console.log("no intersection (why?)"),e.splice(i,1),n&&n.splice(i,1))}}let u=[];for(let e=0;e<i;e++)r[e]&&u.push(r[e]);let l=[...u];if(t&&e.length>4){const t=o.TmpVectors.Vector3[2],n=o.TmpVectors.Vector3[3],r=o.TmpVectors.Vector3[6],i=o.TmpVectors.Vector3[4],a=o.TmpVectors.Vector3[5];for(let s=e.length-1;s>=0;s--){let c=e[s],h=(s+1)%e.length;e[h].subtractToRef(c,t),t.normalize();let f=(s-1+e.length)%e.length;c.subtractToRef(e[f],n),n.normalize();let d=u[s];u[h].subtractToRef(d,i),i.normalize(),d.subtractToRef(u[f],a),a.normalize(),d.subtractToRef(c,r),(o.Vector3.Dot(i,a)<-.95||r.lengthSquared()<.5)&&l.splice(s,1)}}return{fixedOutline:e,offsetOutline:l}}function V(e,t,n){let r=[];n=n||[];for(let i=0;i<e.length;i++){let a=e[i],s=e[(i+1)%e.length],u=e[(i-1+e.length)%e.length],l=s.subtract(a).normalize(),c=a.subtract(u).normalize(),h=new o.Vector3(l.z,0,-l.x),f=new o.Vector3(c.z,0,-c.x),d=B(a.add(f.scale(t)),f,a.add(h.scale(t)),h);null!==d?r.push(d):n.push(i)}return r}function U(e,t,n,r,i,a){let s=i||0,u=a||0;const l=r.subtract(n),c=l.length(),h=l.normalizeFromLength(c),f=n.subtract(t),d=f.length(),p=f.normalizeFromLength(d),m=new o.Vector3(h.z,0,-h.x),g=new o.Vector3(p.z,0,-p.x),D=o.Vector3.Dot(h,p);if(Math.abs(D)<.99){o.Vector3.Dot(g,h)>0&&(e=-e,s=-s,u=-u);let t=B(n.add(g.scale(s-e)),g,n.add(m.scale(u-e)),m);if(t)return{center:t,entry:t.add(g.scale(e)),exit:t.add(m.scale(e))}}return null}function j(e,t,n){let r=z(e)+2*Math.PI,i=z(t)+2*Math.PI;if(n)for(r+=Math.PI,i+=Math.PI;r<i;)r+=2*Math.PI;else for(;i<r;)i+=2*Math.PI;return{total:i-r,end:i}}function G(e,t,n,r){const i=n&&Array.isArray(n);let a,s=new o.Color4(1,0,0,1),u=new o.Color4(0,0,1,1),l=new o.Color4(0,1,0,1),c=new o.Color4(1,1,0,1),h={fixedOutline:[...e],fillets:n};for(;a!=h.fixedOutline.length;)a=h.fixedOutline.length,h=L(h.fixedOutline,t,i?h.fillets:null);r&&h.offsetOutline.length>0&&f("outline_fixed_1",h.offsetOutline,u,c,!0);const d=function(e,t,n,r){let i=[],a=n?[]:null,s=null,u=0;for(let t=0;t<e.length;t++){const n=e[t];(!s||n.x<s.x||Math.abs(n.x-s.x)<o.Epsilon&&n.z<=s.z)&&(s=n,u=t)}let l=(u+1)%e.length,c=e[l];i.push(s);let h=null,d=null;n&&(h=n[l],d=n[u],a.push(d));let p=new o.Color4(1,0,0,1);new o.Color4(0,0,1,1),new o.Color4(0,1,0,1),new o.Color4(1,1,0,1);do{if(u>=0)for(let t=u+1;t<e.length;t++)if(t!==u){if(o.Vector3.DistanceSquared(s,e[t])<1){e.splice(u,t-u),u%=e.length,s=e[u].add(s).scale(.5),l=(u+1)%e.length,c=e[l];break}}let t=c.subtract(s);const m=new o.Vector3(t.z,0,-t.x).normalize();let g=1e9,D=null,y=0;const b=t.lengthSquared()-o.Epsilon;for(let n=0;n<e.length;n++){const r=(n+1)%e.length;if(n===u||n===l||r===u||r===l)continue;const i=[e[n],e[r]],a=i[1].subtract(i[0]),h=(new o.Vector3(a.z,0,-a.x).normalize(),i[0]),f=i[1];let d=S(s,c,t,m,h,f);if("in_segment"===d.type&&d.intersection){let e=d.intersection.subtract(s).lengthSquared();e>o.Epsilon*o.Epsilon&&e<b&&e<g&&d.intersection.subtract(f).lengthSquared()>o.Epsilon*o.Epsilon&&(g=e,D=d.intersection,y=r)}else if("colinear"===d.type&&d.isOverlapping){let n=f,i=(r+1)%e.length;o.Vector3.Dot(a,t)&&(d.y1In||(n=c,i=r));const u=o.TmpVectors.Vector3[6];n.subtractToRef(s,u);let l=u.lengthSquared();l>o.Epsilon*o.Epsilon&&l<=g-o.Epsilon&&(g=l,D=n,y=i)}}if(D?(s=D,d=r,u=-1,l=y):(s=c,n&&(d=h),u=l,l=(l+1)%e.length),c=e[l],c||console.log("nulltarg!"),i.push(s),n&&(h=n[l],a.push(d)),i.length>1e3){console.log("boolean output overflow"),f("outline_output",i,p,p,!1),i=[],a=[];break}}while(s.subtract(i[0]).lengthSquared()>o.Epsilon*o.Epsilon);if(i.pop(),i.length>4){const e=o.TmpVectors.Vector3[2],t=o.TmpVectors.Vector3[3];for(let n=i.length-1;n>=0;n--){let r=i[n],a=(n+1)%i.length;i[a].subtractToRef(r,e),e.normalize();let s=(n-1+i.length)%i.length;r.subtractToRef(i[s],t),t.normalize(),o.Vector3.Dot(e,t)<-.8&&(console.log(`parsing at ${n}, points ${i[s]} ${r} ${i[a]} vecs are ${e}, ${t}`),i.splice(n,1),n++)}}return n&&a.pop(),{outline:i,fillets:a}}(h.offsetOutline,h.fixedOutline,n,n?n[0]:.5).outline;return i||(n=new Array(d.length).fill(n)),r&&d.length>0&&f("outline_orig",d,s,l,!1),{outline:d,fillets:n}}function H(e,t,n,r){const i=V(e,t);if(n&&!Array.isArray(n)&&(n=new Array(i.length).fill(n)),n)return function(e,t,n){let r=[],i=[].fill(null,0,e.length);[].fill(null,0,e.length),[].fill(null,0,e.length),[].fill(null,0,e.length),t&&!Array.isArray(t)&&(t=new Array(e.length).fill(t));for(let n=0;n<e.length;n++){const r=e[n];if(!t)continue;let o=t[n];const a=e[(n+1)%e.length],s=e[(n-1+e.length)%e.length];i[n]=U(o,s,r,a)}let a=null,s=null;for(let n=0;n<e.length;n++){const u=e[n];if(!i[n]){r.push(new _(u));continue}const l=i[n],c=l.center,h=l.entry,f=l.exit,d=(n-1+e.length)%e.length,p=e[d],m=i[d]?i[d].exit:p,g=(n+1)%e.length,D=e[g],y=i[g]?i[g].entry:D,b=u.subtract(p),w=b.length(),C=b.normalizeFromLength(w),v=D.subtract(u),A=v.length(),x=v.normalizeFromLength(A);if(o.Vector3.Dot(m.subtract(p),C)<=o.Vector3.Dot(h.subtract(p),C)&&(null!==a&&console.log(`CRAP OVERWRITING INDEX ${a} with ${n}`),a=n),o.Vector3.Dot(y.subtract(u),x)<o.Vector3.Dot(f.subtract(u),x))n==e.length-1&&null!==s&&console.log("oh boy we're at the end and have a dangling index!");else if(a===n){let e=t[n];const i=new o.Vector3(x.z,0,-x.x),s=new o.Vector3(C.z,0,-C.x);const u=j(s,i,o.Vector3.Dot(s,x)>0);r.push(new _(h)),r.push(new F(c,e,u.total,u.end)),a=null}else if(null!==a){const i=e[(a-1+e.length)%e.length],s=e[a],u=e[n],l=e[g];let c=t[a],h=t[n];const f=s.subtract(i),d=f.length(),p=f.normalizeFromLength(d),m=new o.Vector3(p.z,0,-p.x),D=u.subtract(s),y=D.length(),b=D.normalizeFromLength(y),w=new o.Vector3(b.z,0,-b.x),C=l.subtract(u),v=C.length(),A=C.normalizeFromLength(v),x=new o.Vector3(A.z,0,-A.x),E=o.Vector3.Dot(A,p);let k=U(c,i,s,u),B=U(h,s,u,l);if(k&&B){const e=k.exit.subtract(s).length(),t=B.entry.subtract(s).length();let n=o.Vector3.Dot(m,b)>0,a=o.Vector3.Dot(w,A)>0,f=w,d=w;if(E>o.Epsilon&&t<e){const e=k.exit.add(B.entry).scale(.5),t=k.exit.subtract(e).length(),r=c-Math.sqrt(c*c-t*t);k=U(c,i,s,u,0,r),k.exit=e,B=U(h,s,u,l,r,0),B.entry=e,f=n?k.center.subtract(k.exit).normalize():k.exit.subtract(k.center).normalize(),d=a?B.center.subtract(B.entry).normalize():B.entry.subtract(B.center).normalize()}const p=j(m,f,n);r.push(new _(k.entry)),r.push(new F(k.center,c,p.total,p.end));const g=j(d,x,a);r.push(new _(B.entry)),r.push(new F(B.center,h,g.total,g.end))}else r.push(new _(s)),r.push(new _(u));a=null}else console.log("dangler!  gonna have to clean that up"),s=n}return n&&r.push(r[0]),r}(i,n,r);{let e=[];for(const t of i)e.push(new _(t));return e}}function $(e,t){let n=[];t||(t=4);for(let r=0;r<e.length;r++){let i=e[r];switch(i.type){case 0:n.push(i.point);break;case 1:let e=i.rotRadians/t,r=i.endRot;for(let o=t-1;o>=0;o--)n.push(i.center.add(P(r-e*o).scale(i.radius)))}}return n}function Y(e){let t=new o.Vector3(1e7,1e8,1e9),n=new o.Vector3(-1e7,-1e7,-1e7);for(let r=0;r<e.length;r++){let i=e[r];switch(i.type){case 0:t.minimizeInPlace(i.point),n.maximizeInPlace(i.point);break;case 1:let e=i.center.add(new o.Vector3(-1,0,-1).scale(i.radius)),r=i.center.add(new o.Vector3(1,0,1).scale(i.radius));t.minimizeInPlace(e),n.maximizeInPlace(r)}}return{mins:t,maxs:n}}function W(e,t,n,r,i){return $(H(e,t,n,r),i)}function Z(e,t,n){let r=[];n||(n=10);let i=2*Math.PI/n;for(let o=0;o<n;o++)r.push(e.center.add(P(i*o).scale(e.radius+t)));return r}class K{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let n=this.length++;for(this.ids[n]=e,this.values[n]=t;n>0;){const e=n-1>>1,r=this.values[e];if(t>=r)break;this.ids[n]=this.ids[e],this.values[n]=r,n=e}this.ids[n]=e,this.values[n]=t}pop(){if(0===this.length)return;const e=this.ids[0];if(this.length--,this.length>0){const e=this.ids[0]=this.ids[this.length],t=this.values[0]=this.values[this.length],n=this.length>>1;let r=0;for(;r<n;){let e=1+(r<<1);const n=e+1;let i=this.ids[e],o=this.values[e];const a=this.values[n];if(n<this.length&&a<o&&(e=n,i=this.ids[n],o=a),o>=t)break;this.ids[r]=i,this.values[r]=o,r=e}this.ids[r]=e,this.values[r]=t}return e}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}}const X={mx:{pthDefs:{switchPin:{radius:.735,ring:.39},stemPin:{radius:1.994,ring:0},sidePin:{radius:.875,ring:0}},bounds:[9,6.75],pthList:[{pin:1,loc:[-3.81,2.54],defName:"switchPin"},{pin:2,loc:[2.54,5.08],defName:"switchPin"},{pin:0,loc:[0,0],defName:"stemPin"},{pin:0,loc:[-5.08,0],defName:"sidePin"},{pin:0,loc:[5.08,0],defName:"sidePin"}],pins:["1","2"]},mx_hotswap:{pthDefs:{switchPin:{radius:1.5,ring:.05},stemPin:{radius:1.994,ring:0},sidePin:{radius:.875,ring:0}},bounds:[9,6.75],pthList:[{pin:1,loc:[-3.81,2.54],defName:"switchPin"},{pin:2,loc:[2.54,5.08],defName:"switchPin"},{pin:0,loc:[0,0],defName:"stemPin"},{pin:0,loc:[-5.08,0],defName:"sidePin"},{pin:0,loc:[5.08,0],defName:"sidePin"}],padList:[{pin:1,poly:[[-3.81,2.54],[-6.085,3.79],[-8.635,3.79],[-8.635,1.29],[-6.085,1.29]],loc:[-6.085-1.275,2.54]},{pin:2,poly:[[2.54,5.08],[2.54+2.275,6.33],[2.54+2.275+2.55,6.33],[2.54+2.275+2.55,3.83],[2.54+2.275,3.83]],loc:[6.09,5.08]}],pins:["1","2"]},oled:{bounds:[15,6.75]},ec11:{bounds:[7.5,6]},stab:{pthDefs:{smallPin:{radius:1.524,ring:0},bigPin:{radius:1.9939,ring:0}},bounds:[3,9],pthList:[{pin:0,loc:[0,-6.985],defName:"smallPin"},{pin:0,loc:[0,8.255],defName:"bigPin"}]},UFQFPN48:{bounds:[7.3/3,3.65],padList:function(e,t,n,r,i,o){let a=[];const s=[{x:0,y:1},{x:0,y:0},{x:1,y:0},{x:1,y:1}];let u=1;for(let l=-1;l<=1;l+=2)for(let c=0;c<=1;c++)for(let h=0;h<n;h++){let n=-t/2+h*o,f=[],d=[0,0];for(const t of s){let o=n+t.x*i,a=e+t.y*r,s=0==c?o*l:a*l,u=1==c?o*l:a*l;f.push([s,u]),d[0]+=s,d[1]+=u}d[0]/=s.length,d[1]/=s.length,a.push({pin:u,poly:f,loc:d}),u+=1}return a}(3.1,5.8,12,.55,.3,.5),pins:[]}};function q(e,t,n,i){const a=r.pcbData[i];a.devices[e]||(a.devices[e]={footprints:[],type:t,id:e,caseIdx:i});let s=a.devices[e],u=X[t],l={pths:[],pads:[]};if(u.bounds){l.box=E(u.bounds[0],u.bounds[1],n),l.bounds={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(let e of l.box.points)l.bounds.mins[0]=Math.min(l.bounds.mins[0],e.x),l.bounds.maxs[0]=Math.max(l.bounds.maxs[0],e.x),l.bounds.mins[1]=Math.min(l.bounds.mins[1],e.z),l.bounds.maxs[1]=Math.max(l.bounds.maxs[1],e.z)}if(u.pins){l.pins={};for(const e of u.pins)l.pins[e]={name:e}}if(u.pthList)for(const e of u.pthList){const t=u.pthDefs[e.defName],r={type:"pth",radius:t.radius,ring:t.ring};e.pin&&(r.pin=l.pins[e.pin]),r.location=o.Vector3.TransformCoordinates(new o.Vector3(e.loc[0],0,e.loc[1]),n),l.pths.push(r)}if(u.padList)for(const e of u.padList){let t=[];for(const r of e.poly){const e=o.Vector3.TransformCoordinates(new o.Vector3(r[0],0,r[1]),n);t.push(e)}const r={type:"pad",poly:t,location:o.Vector3.TransformCoordinates(new o.Vector3(e.loc[0],0,e.loc[1]),n)};e.pin&&(r.pin=l.pins[e.pin]),l.pads.push(r)}s.footprints.push(l)}function J(e){const t=window.performance.now(),n=(function(e){let t=Math.min(26,Math.ceil((e.outlineBounds.maxs[0]-e.outlineBounds.mins[0])/i.base1U[0])),n=Math.min(26,Math.ceil((e.outlineBounds.maxs[1]-e.outlineBounds.mins[1])/i.base1U[1])),r=[];console.log(`Max matrix: ${t} cols ${n} rows`);for(let e=0;e<n;e++)r.push(new Array(t));for(let[o,a]of Object.entries(e.devices))for(let o of a.footprints)if(o.pins){let a=Math.floor((o.bounds.mins[0]-e.outlineBounds.mins[0])/i.base1U[0])%t,s=Math.floor((o.bounds.mins[1]-e.outlineBounds.mins[1])/i.base1U[1])%n;for(console.log(`initial guess: row ${s} col ${a}`);r[s][a];)a+=1,console.log(`bumping to: row ${s} col ${a}`);r[s][a]=o,o.matrixPos={row:s,col:a}}}(e),window.performance.now()),a=e.outlineBounds.mins[0],s=e.outlineBounds.mins[1];let u=Math.ceil(1.25*(e.outlineBounds.maxs[0]-e.outlineBounds.mins[0])),l=Math.ceil(1.25*(e.outlineBounds.maxs[1]-e.outlineBounds.mins[1])),c=[[],[]],h=[];console.log(`occupancy: ${u} cols ${l} rows`);const f=o.TmpVectors.Vector3[11];f.x=e.outlineBounds.mins[0]-100,f.y=0;const d=o.TmpVectors.Vector3[12];d.x=e.outlineBounds.maxs[0]+100,d.y=0;let p={type:"out"};for(let t=0;t<l;t++){c[0].push(new Array(u)),c[1].push(new Array(u)),h.push({});const n=e.outlineBounds.mins[1]+.8*(t+.5);f.z=d.z=n;const r=M(f,d,e.outline);r.sort((e,t)=>e.x-t.x);let i=!0,o=0;for(let n=0;n<u;n++){if(r.length>o){const t=i?e.outlineBounds.mins[0]+.8*(n-1.5):e.outlineBounds.mins[0]+.8*(n+1.5);let a=r[o];for(;r.length>o&&a.x<t;)i=!i,o+=1,a=r[o]}i&&(c[0][t][n]=p,c[1][t][n]=p)}}for(let[t,n]of Object.entries(e.devices))for(let t of n.footprints){for(const n of t.pths){let r=n.pin;r&&!r.net&&(1==r.name?(r.net="mRow"+t.matrixPos.row,r.subnet=-1):2==r.name&&(r.net="mCol"+t.matrixPos.col,r.subnet=-1)),r&&r.net&&(e.nets[r.net]||(e.nets[r.net]={members:[],connectivity:[]}),-1==r.subnet&&(r.subnet=e.nets[r.net].connectivity.length,e.nets[r.net].connectivity.push([r.subnet])),e.nets[r.net].members.push(n));const i=[1.25*(n.location.x-a),1.25*(n.location.z-s)],o=n.radius+n.ring+.8,h=Math.ceil(1.25*o);for(let e=-h;e<=h;e++){const t=i[0]+e;if(!(t<0||t>=u))for(let r=-h;r<=h;r++){const o=i[1]+r;o<0||o>=l||e*e+r*r<h*h&&(c[0][Math.floor(o)][Math.floor(t)]=n,c[1][Math.floor(o)][Math.floor(t)]=n)}}}for(const n of t.pads){let r=n.pin;r&&!r.net&&(1==r.name?(r.net="mRow"+t.matrixPos.row,r.subnet=-1):2==r.name&&(r.net="mCol"+t.matrixPos.col,r.subnet=-1)),r&&r.net&&(e.nets[r.net]||(e.nets[r.net]={members:[],connectivity:[]}),-1==r.subnet&&(r.subnet=e.nets[r.net].connectivity.length,e.nets[r.net].connectivity.push([r.subnet])),e.nets[r.net].members.push(n));const i=n.poly;let s=[1e5,1e5],u=[-1e5,-1e5];for(const e of i)s[0]=Math.min(s[0],e.x),s[1]=Math.min(s[1],e.z),u[0]=Math.max(u[0],e.x),u[1]=Math.max(u[1],e.z);let l=Math.floor(1.25*(s[1]-e.outlineBounds.mins[1]))-1,h=Math.ceil(1.25*(u[1]-s[1]))+2,f=new Array(h);for(let e=0;e<h;e++)f[e]=[];const d=o.TmpVectors.Vector3[10];for(let t=0;t<i.length;t++){const n=i[t],r=i[(t+1)%i.length];r.subtractToRef(n,d);let a=Math.floor(1.25*(Math.min(n.z,r.z)-e.outlineBounds.mins[1]))-1,s=a-l,u=Math.ceil(1.25*(Math.max(n.z,r.z)-e.outlineBounds.mins[1]))+1-a,c=Math.min(n.x,r.x),h=Math.max(n.x,r.x);const p=new Array(u);for(let t=0;t<u;t++){const r=.8*(t+a)+e.outlineBounds.mins[1];d.z<o.Epsilon?p[t]=0==t?c:h:p[t]=Math.min(Math.max(c,(r-n.z)/d.z*d.x+n.x),h)}for(let e=0;e<u-1;e++){const t=f[e+s],n=Math.max(p[e],p[e+1]),r=Math.min(p[e],p[e+1]);t.length>1?(t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],n)):(t[0]=r,t[1]=n)}}const p=0;for(let e=0;e<h;e++){const t=f[e],r=e+l;for(let e=0;e<t.length;e+=2){const i=Math.floor(1.25*(t[e]-a))-1,o=Math.ceil(1.25*(t[e+1]-a))+1;for(let e=i;e<=o;e++)c[p][r][e]||(c[p][r][e]=n)}}}}const m=window.performance.now();function g(e,t,n){let r=e.connectivity[t],i=e.connectivity[n];for(const t of i)r.includes(t)||r.push(t),e.connectivity[t]=r}e.topRoutes=[],e.bottomRoutes=[],e.vias=[];e:for(const[t,n]of Object.entries(e.nets))for(;n.connectivity[0].length!=n.connectivity.length;){const t=n.members[0];if(n.connectivity[0].length==n.connectivity.length)break;let r=[Math.floor(1.25*(t.location.x-a)),Math.floor(1.25*(t.location.z-s)),0],i=0;const f={};f[r[2]*u*l+r[1]*u+r[0]]="START";const d=new K;let p=!1;for(;!p;){let e=r[2]*u*l+r[1]*u+r[0];for(let o=0;o<5;o++){let h=0==o?-1:1==o?1:0,m=2==o?-1:3==o?1:0,D=4==o?1^r[2]:r[2],y=[r[0]+h,r[1]+m,D];if(y[0]>=0&&y[0]<u&&y[1]>=0&&y[1]<l){let o=c[y[2]][y[1]][y[0]];const h=y[2]*u*l+y[1]*u+y[0];if(!f[h]){if(!(o&&o!=t&&(!o.pin||o.pin.net!=t.pin.net||D!=r[2]&&"pad"==o.type))){f[h]=e;let c=y[2]!=r[2]?80:10,m=function(){let e=1e8;for(const r of n.members)if(!n.connectivity[r.pin.subnet].includes(t.pin.subnet)){let t=[Math.floor(1.25*(r.location.x-a)),Math.floor(1.25*(r.location.z-s))],n=Math.sqrt(Math.pow(Math.abs(t[0]-y[0]),2)+Math.pow(Math.abs(t[1]-y[1]),2));"pad"==r.type&&0!=y[2]&&(n+=8),n*=7,e=Math.min(e,n)}return e};if(o){if(!n.connectivity[o.pin.subnet].includes(t.pin.subnet)){if(console.log("found a route"),console.log(t),console.log(o),o.location){let t=[Math.floor(1.25*(o.location.x-a)),Math.floor(1.25*(o.location.z-s))],n=y[2]*u*l+t[1]*u+t[0];f[n]=e,p=n}else p=h;g(n,o.pin.subnet,t.pin.subnet);break}c=0}d.push({node:y,dist:i+c},i+c+m())}}}}if(0==d.length){console.log("could not reach destination!"),console.log(t);break e}const o=d.pop();i=o.dist,r=o.node}if(p){let n=p,r=Math.floor(n/(u*l)),i=new o.Vector3(.8*(n%(u*l)%u+.5)+a,0,.8*Math.floor(n%(u*l)/u+.5)+s),d=i,m=0;for(;f[n]&&"START"!=f[n];){n=f[n];let p=Math.floor(n/(u*l)),g=n%(u*l),D=new o.Vector3(.8*(g%u+.5)+a,0,.8*Math.floor(g/u+.5)+s);if(c[p][Math.floor(g/u)][g%u]||(c[p][Math.floor(g/u)][g%u]={type:"route",pin:{net:t.pin.net,subnet:t.pin.subnet}}),p!=r||Math.abs(i.x-D.x)>o.Epsilon&&Math.abs(i.z-D.z)>o.Epsilon){let n=[i,d];(1==r?e.topRoutes:e.bottomRoutes).push(n),p!=r&&(console.log("placing a via at step "+m),e.vias.push(D),h[Math.floor(g/u)][g%u]={net:t.pin.net,subnet:t.pin.subnet}),i=d,r=p}m+=1,d=D}console.log(`route took a total of ${m} steps`),(1==r?e.topRoutes:e.bottomRoutes).push([i,d])}}const D=window.performance.now();var y=r.debugCanvas.getContext("2d");r.debugCanvas.width=u,r.debugCanvas.height=2*l;var b=y.createImageData(u,2*l);function w(e,t,n,r,i,o,a){const s=b.width;b.data[(n*l+t)*(4*s)+4*e+0]=r,b.data[(n*l+t)*(4*s)+4*e+1]=i,b.data[(n*l+t)*(4*s)+4*e+2]=o,b.data[(n*l+t)*(4*s)+4*e+3]=a}for(let e=0;e<2;e++)for(let t=0;t<l;t++)for(let n=0;n<u;n++){const r=c[e][l-t-1][n];r?"out"==r.type?w(n,t,e,0,0,0,255):"pth"==r.type||"pad"==r.type?r.pin?w(n,t,e,0,0,255,255):w(n,t,e,76,0,0,255):w(n,t,e,255,0,0,255):w(n,t,e,0,64,0,255)}y.putImageData(b,0,0),console.log(`creating matrix took ${n-t} ms`),console.log(`creating occupancy took ${m-n} ms`),console.log(`route pathing took ${D-m} ms`)}function Q(e,t,n){const i=r.pcbData[t];i.outline=V(e,-1.25),i.outlineBounds={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(let e of i.outline)i.outlineBounds.mins[0]=Math.min(i.outlineBounds.mins[0],e.x),i.outlineBounds.maxs[0]=Math.max(i.outlineBounds.maxs[0],e.x),i.outlineBounds.mins[1]=Math.min(i.outlineBounds.mins[1],e.z),i.outlineBounds.maxs[1]=Math.max(i.outlineBounds.maxs[1],e.z);i.trackWidth=.2032}function ee(e){const t=r.pcbData[e];!function(e){var t=window.performance.now();const n=10*e.trackWidth,r=1/n,i=e.outlineBounds.mins[0],a=e.outlineBounds.mins[1];let s=Math.ceil((e.outlineBounds.maxs[0]-e.outlineBounds.mins[0])*r),u=Math.ceil((e.outlineBounds.maxs[1]-e.outlineBounds.mins[1])*r);if(console.log(`SDF: ${s} cols ${u} rows`),s<=0||u<=0)return void console.log("No PCB SDF");let l=[];for(let e=0;e<u;e++)l.push(new Array(s).fill(1e5));for(let[t,n]of Object.entries(e.devices))for(let e of n.footprints)for(const t of e.pths){const e=[(t.location.x-i)*r,(t.location.z-a)*r],n=t.radius+t.ring,o=Math.floor(e[0]),c=Math.floor(e[1]);for(let t=-1;t<=1;t++)for(let r=-1;r<=1;r++){const i=c-t,a=o-r;if(a>=0&&a<s&&i>=0&&i<u){const t=Math.pow(e[0]-a,2)+Math.pow(e[1]-i,2),r=Math.sqrt(t)-n;l[i][a]=Math.min(l[i][a],r)}}}const c=[{d:[1,0],pX:[s-1,-1,-1],pY:[0,u,1]},{d:[-1,0],pX:[0,s,1],pY:[0,u,1]},{d:[0,1],pX:[0,s,1],pY:[u-1,-1,-1]},{d:[0,-1],pX:[0,s,1],pY:[0,u,1]}];for(const e of c)for(let t=e.pY[0];t!=e.pY[1];t+=e.pY[2]){const n=t+e.d[1];for(let r=e.pX[0];r!=e.pX[1];r+=e.pX[2]){const i=r+e.d[0];l[t][r]=i>=0&&i<s&&n>=0&&n<u?Math.min(l[t][r],l[n][i]+1):Math.min(l[t][r],1)}}let h=-1e4,f=[0,0];for(let e=0;e<u;e++)for(let t=0;t<s;t++)l[e][t]>h&&(h=l[e][t],f[0]=t,f[1]=e);console.log("SDF locating took "+(window.performance.now()-t));let d=[f[0]*n+i,f[1]*n+a];console.log(`empty zone: ${d[0]} ${d[1]} clearance ${h*n}`);let p=o.Matrix.RotationY(45*Math.PI/180);p=p.multiply(o.Matrix.Translation(d[0],0,d[1])),q("MCU","UFQFPN48",p,e.caseIdx)}(t);J(t)}const te=[];function ne(){let e=r.renderData.keys;for(const t of te)if(e[t]){let n=e[t];n.keycap.renderOverlay=!1;for(const e of n.keycap.getChildMeshes())e.renderOverlay=!1}else console.log("picked nonexistant key");te.length=0}function re(e){let t=r.renderData.keys;if(t[e]){let n=t[e];if(te.indexOf(e)<0){n.keycap.renderOverlay=!0;for(const e of n.keycap.getChildMeshes())e.renderOverlay=!0;te.push(e)}}else console.log("picked nonexistant key")}function ie(e,t,n,r,a,s,u){let l=[.5*i.switchCutout[0],.5*i.switchCutout[1]],c=r;6===t&&ie(e,666,n,o.Matrix.Translation(9.525,0,0).multiply(c),a,s,u),666!==t&&(s.push(E(l[0],l[1],c)),q(e,"mx_hotswap",c,u));let h=t;n>=1.75&&(h=n,c=o.Matrix.RotationY(Math.PI/2).multiply(c)),a&&(c=o.Matrix.RotationY(Math.PI).multiply(c));let f=[3.5,7.5];if(h>=2&&666!=h){let t=0,n=0;h<=2.75?t=n=11.938:h<=3?t=n=19.05:h<=4?t=n=28.575:h<=4.5?t=n=34.671:h<=5.5?t=n=42.8625:666===h?(t=57.15,n=38.1):t=n=h<=6?47.5:h<=6.25?50:h<=6.5?52.38:h<=7?57.15:66.675;let r=[o.Matrix.Translation(-t,0,2).multiply(c),o.Matrix.Translation(n,0,2).multiply(c)],i=[o.Matrix.Translation(-t,0,0).multiply(c),o.Matrix.Translation(n,0,0).multiply(c)];for(let t=0;t<r.length;t++)s.push(E(f[0],f[1],r[t])),q(e,"stab",i[t],u)}}function oe(){const e=r.scene,t=ke();if(function(){r.pcbData={};const e=ke();for(const[t,n]of Object.entries(e.cases))r.pcbData[t]={outline:[],devices:{},nets:{},caseIdx:t}}(),!t.layout)return;let n=r.renderData.keys;for(const[a,s]of Object.entries(t.layout.keys)){n[a]||(n[a]={id:a,mins:[1e5,1e5],maxs:[-1e5,-1e5],switchCut:[],bezelHoles:[],caseIdx:s.caseIdx||0});let t=n[a];t.mins=[1e5,1e5],t.maxs=[-1e5,-1e5],t.switchCut.length=0,t.bezelHoles.length=0;const u=r.renderData.cases[t.caseIdx].rootXform;if("oled"===s.type){let n=[(38.1+i.bezelGap)/2,(14.1+i.bezelGap)/2],l=o.Matrix.Translation(s.x,0,-s.y);0!=s.rotation_angle&&(l=l.multiply(o.Matrix.RotationY(s.rotation_angle*Math.PI/180)));let c=[E(n[0],n[1],l)];if(t.bezelHoles.push(E(n[0]+i.bezelGap,n[1]+i.bezelGap,l)),t.switchCut.push(E(n[0]+i.bezelGap,n[1]+i.bezelGap,l)),q(s.id,s.type,l,t.caseIdx),t.outline=ae(c),t.keycap&&p(t.keycap),t.switch&&p(t.switch),i.keyShape){const n=[];if(n[0]=new o.Vector4(0,0,1,1),n[1]=new o.Vector4(0,0,0,0),n[2]=new o.Vector4(0,0,0,0),t.keycap=o.MeshBuilder.CreatePolygon(a,{shape:W(t.outline,0,.25),faceUV:n,depth:2,smoothingThreshold:.1,updatable:!1},e),te.indexOf(a)>=0&&(t.keycap.renderOverlay=!0),t.keycap.parent=u,t.keycap.heightOffset=4.5,t.keycap.position.y=t.keycap.heightOffset,d(t.keycap),s.matName&&r.renderData.mats[s.matName]){let n=r.renderData.mats[s.matName].clone(),i=new o.DynamicTexture(s.id,{width:128,height:32},e,!0);i.drawText("kbgb",32,24,"bold 24px monospace","white","black",!0,!0),n.baseTexture=i,n.roughness=.1,n.baseColor=new o.Color3(1,1,1),t.keycap.material=n}}}else if("ec11"===s.type){let n=s.encoder_knob_size/2,l=o.Matrix.Translation(s.x,0,-s.y);0!=s.rotation_angle&&(l=l.multiply(o.Matrix.RotationY(s.rotation_angle*Math.PI/180)));let c=o.Vector3.TransformCoordinates(new o.Vector3(0,0,0),l),h=[new x(Z(new k(c,n),0,19))];const f=new x(Z(new k(c,n),i.bezelGap,50));t.bezelHoles.push(f);let m=[7.5,7.75];t.switchCut.push(E(m[0],m[1],l)),q(s.id,s.type,l,t.caseIdx),t.outline=ae(h),t.keycap&&p(t.keycap),t.switch&&p(t.switch),i.keyShape&&(t.keycap=o.MeshBuilder.CreatePolygon(a,{shape:W(t.outline,0,0),depth:15,bevel:.5,smoothingThreshold:-2,updatable:!1},e),te.indexOf(a)>=0&&(t.keycap.renderOverlay=!0),t.keycap.parent=u,t.keycap.heightOffset=18.5,t.keycap.position.y=t.keycap.heightOffset,d(t.keycap),s.matName&&r.renderData.mats[s.matName]&&(t.keycap.material=r.renderData.mats[s.matName]))}else{let n=[(i.keyDims[0]+i.base1U[0]*(s.width-1))/2,(i.keyDims[1]+i.base1U[1]*(s.height-1))/2],l=o.Matrix.Translation(s.x,0,-s.y);0!=s.rotation_angle&&(l=o.Matrix.RotationY(s.rotation_angle*Math.PI/180).multiply(l));let c=[E(n[0],n[1],l)];if(t.bezelHoles.push(E(n[0]+i.bezelGap,n[1]+i.bezelGap,l)),s.width2>0&&s.height2>0&&(s.width!==s.width2||s.height!==s.height2||0!==s.x2||0!==s.y2)){let e=[(i.keyDims[0]+i.base1U[0]*(s.width2-1))/2,(i.keyDims[1]+i.base1U[1]*(s.height2-1))/2],r=[s.x2*i.base1U[0]-n[0]+e[0],-(s.y2*i.base1U[1]-n[1]+e[1])],a=o.Matrix.Translation(r[0],0,r[1]).multiply(l);c.push(E(e[0],e[1],a)),c[0].overlappingPolys[c[1].id]=c[1],c[1].overlappingPolys[c[0].id]=c[0];const u=E(e[0]+i.bezelGap,e[1]+i.bezelGap,a);t.bezelHoles.push(u)}if(ie(s.id,s.width,s.height,l,s.flipStab,t.switchCut,t.caseIdx),!t.switch){const e=y.container;if(e){t.switch=e.instantiateModelsToScene(e=>a,!1).rootNodes[0],t.switch.parent=u,t.switch.setPreTransformMatrix(o.Matrix.RotationY(Math.PI).multiply(o.Matrix.Scaling(-1,1,1)));for(const e of t.switch.getChildMeshes())e.setPreTransformMatrix(o.Matrix.RotationY(Math.PI).multiply(o.Matrix.Scaling(-1,1,1)));d(t.switch)}}if(t.switch){const e=l.multiply(o.Matrix.Scaling(-1,1,1));t.switch.setPreTransformMatrix(e)}if(t.outline=ae(c),i.keyShape&&(!t.keycap||t.keycap.isProceduralCap||t.keycap.text!=s.txt||t.keycap.width!=s.width||t.keycap.row!=s.row)){t.keycap&&p(t.keycap);let n=s.width,i={vertical:s.vertical,special:s.special,stepped:s.stepped,nub:s.nub,r:s.row};s.special&&"standard"!==s.special&&(i.r=s.special);const l="KRK",c=w(l,n,s.height,i);if(c){if(t.keycap=c.container.instantiateModelsToScene(e=>a,!1).rootNodes[0],"KRK"===l){for(const e of t.keycap.getChildMeshes())for(let t=0;t<e.morphTargetManager.numTargets;t++){let n=e.morphTargetManager.getTarget(t);n.name==Be().profile?n.influence=1:n.influence=0}t.keycap.heightOffset=5.9}else t.keycap.heightOffset=3.5;t.keycap.parent=u,t.keycap.preXform=c.preXform,t.keycap.postXform=o.Matrix.Scaling(-1,1,1),d(t.keycap)}else t.keycap=o.MeshBuilder.CreatePolygon(a,{shape:W(t.outline,0,.25),depth:7,smoothingThreshold:.1,updatable:!1},e),t.keycap.isProceduralCap=!0,t.keycap.parent=u,t.keycap.preXform=null,t.keycap.heightOffset=10.5,d(t.keycap);if(t.keycap.width=s.width,t.keycap.row=s.row,s.matName&&r.renderData.mats[s.matName]){let n=r.renderData.mats[s.matName];if(s.txt&&"KRK"===l){let i=s.txt.split(" ").join("\n");n=r.renderData.mats[s.matName].clone();let a=256;t.keycap.text=s.txt;let u=new o.DynamicTexture(s.id,{width:a*s.width,height:a*s.height},e,!0),l=a/4,c=`bold ${l}px Helvetica`;u.getContext().font=c,u.getContext().measureText(i).width>=128&&(l/=2,c=`bold ${l}px Helvetica`),u.drawText(i,.25*a,.4*a,c,"black","white",!0,!0),n.baseTexture=u}for(const e of t.keycap.getChildMeshes())e.material=n;t.keycap.material=n}if(te.indexOf(a)>=0){t.keycap.renderOverlay=!0;for(const e of t.keycap.getChildMeshes())e.renderOverlay=!0}}if(t.keycap){if(t.keycap.preXform){const e=t.keycap.preXform.multiply(l).multiply(t.keycap.postXform);t.keycap.setPreTransformMatrix(e)}t.keycap.position.y=t.keycap.heightOffset}}for(let e of t.outline)t.mins[0]=Math.min(t.mins[0],e.x),t.maxs[0]=Math.max(t.maxs[0],e.x),t.mins[1]=Math.min(t.mins[1],e.z),t.maxs[1]=Math.max(t.maxs[1],e.z)}!function(){const e=ke(),t=r.renderData.keys;r.renderData.layoutData={};for(const[n,i]of Object.entries(e.cases)){let e="bezelHoles",a=se(t,e,n),s={};if(!(Object.keys(a).length>0))continue;for(const[e,t]of Object.entries(a)){let n=ae(t);s[e]=n}let u=s;if(i.forceSymmetrical){let r="bezelHolesMirrored";const i={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(const[r,o]of Object.entries(t))if(o.caseIdx==n)for(const t of o[e])for(let e of t.points)i.mins[0]=Math.min(i.mins[0],e.x),i.maxs[0]=Math.max(i.maxs[0],e.x),i.mins[1]=Math.min(i.mins[1],e.z),i.maxs[1]=Math.max(i.maxs[1],e.z);let a=.5*(i.maxs[0]-i.mins[0])+i.mins[0];for(const[i,s]of Object.entries(t))if(s.caseIdx==n){s[r]=[];for(const t of s[e]){const e=[],n=[];for(let r of t.points)e.push(new o.Vector3(a-(r.x-a),r.y,r.z)),n.push(r);e.reverse(),s[r].push(new x(e)),s[r].push(new x(n))}}e=r;let u=se(t,e,n);if(s={},!(Object.keys(u).length>0))continue;for(const[e,t]of Object.entries(u)){let n=ae(t);s[e]=n}}let l=[],c=0,f=0,d={};for(const[e,t]of Object.entries(s)){for(let e=0;e<t.length;e++){const n=t[e];n.delaunayPoints=[],n.pointIdx=c+e,n.outlineIdx=f,n.outlinePoints=[c+(e+t.length-1)%t.length,c+(e+1)%t.length],l.push(n)}d[f]=[f],f+=1,c+=t.length}const p=R(l);new o.Color4(1,0,0,1),new o.Color4(0,1,0,1);for(const e of p.edges)if(e.lSite&&e.rSite){if(e.lSite.pointIdx>l.length||e.rSite.pointIdx>l.length){console.log("couldn't find points");continue}let t=e.lSite,n=e.rSite,r=!1;const i=t.subtract(n);let a=i.length();if(a<o.Epsilon)continue;if(t.outlinePoints.includes(n.pointIdx))r=!0;else{let e=function(e,t){const n=e.subtract(l[e.outlinePoints[0]]),r=l[e.outlinePoints[1]].subtract(e),i=new o.Vector3(n.z,0,-n.x),a=new o.Vector3(r.z,0,-r.x),s=o.Vector3.Dot(i,r)>o.Epsilon,u=o.Vector3.Dot(t,i),c=o.Vector3.Dot(t,a);return u>o.Epsilon&&(!s||c>o.Epsilon)||u<o.Epsilon&&!s&&c>o.Epsilon},r=e(n,i);if(t.outlineIdx!==n.outlineIdx){const i=n.subtract(t);r&=e(t,i)}if(!r)continue}const s=t.add(n).scale(.5);let u=function(e,t,n){const r=(e+t+n)*(t+n-e)*(n+e-t)*(e+t-n),i=Math.sqrt(r);return r<0||i<o.Epsilon?1e7:e*t*n/i};n.subtract(t);const c=new o.Vector3(i.z,0,-i.x).normalizeToNew();let h=a/2,f=1e6,d=a/2,p=1e6;for(const e of l){if(e.pointIdx===t.pointIdx||e.pointIdx===n.pointIdx)continue;const r=e.subtract(n);let i=e.subtract(t).length(),l=r.length();if(i<o.Epsilon||l<o.Epsilon)continue;const m=s.subtract(e).length();let g=o.Vector3.Dot(c,r),D=u(i,l,a);if(2*m<=a?g>=0?(h=Math.max(h,D),p=0):(d=Math.max(d,D),f=0):g>=0?p=Math.min(p,D):f=Math.min(f,D),p-d<o.Epsilon&&f-h<o.Epsilon)break}let m=h,g=f;p>=f&&(m=d,g=p),m=Math.round(1e5*m)/1e5,g=Math.round(1e5*g)/1e5,g=Math.min(g,1e4),r&&(m=0),t.delaunayPoints.push({p:n,dist:a,minTheta:m,maxTheta:g}),n.delaunayPoints.push({p:t,dist:a,minTheta:m,maxTheta:g})}const m=[];let g={};for(const e of l){const t=e.subtract(l[e.outlinePoints[0]]).normalize(),n=e.subtract(l[e.outlinePoints[1]]).normalize(),r=z(t),i=2*Math.PI-r+o.Epsilon;z(n);for(const t of e.delaunayPoints)if(t.maxTheta>9e3){e.isOnConvexHull=!0;break}e.delaunayPoints.sort((t,n)=>(z(e.subtract(t.p).normalize())+i)%(2*Math.PI)-(z(e.subtract(n.p).normalize())+i)%(2*Math.PI));for(const t of e.delaunayPoints){if(e.outlineIdx!==t.p.outlineIdx){const n=`${Math.min(e.outlineIdx,t.p.outlineIdx)}_${Math.max(e.outlineIdx,t.p.outlineIdx)}`;g[n]||(g[n]=[]),g[n].push({p:e,dp:t})}m.includes(t.minTheta)||m.push(t.minTheta),m.includes(t.maxTheta)||m.push(t.maxTheta)}}const D=[];for(const[e,t]of Object.entries(g)){t.sort((e,t)=>e.dp.dist>t.dp.dist);let e=[],n=[];const r=2,i=19.05;for(const o of t){if(e.length>=4&&o.dp.dist>t[0].dp.dist+r&&o.dp.dist>i)break;e.includes(o.p.pointIdx)||e.includes(o.dp.p.pointIdx)||(e.push(o.p.pointIdx),e.push(o.dp.p.pointIdx),n.push(o))}let o=-1,a=null;for(const e of n)for(const t of n)if(e.p.pointIdx!==t.p.pointIdx){const n=l[e.p.pointIdx].add(l[e.dp.p.pointIdx]).scale(.5),r=l[t.p.pointIdx].add(l[t.dp.p.pointIdx]).scale(.5);let i=n.subtract(r).lengthSquared();i>o&&(o=i,a=[e,t])}a&&D.push({outline1:Math.min(a[0].p.outlineIdx,a[0].dp.p.outlineIdx),outline2:Math.max(a[0].p.outlineIdx,a[0].dp.p.outlineIdx),maxDist:o,edgeLength:a[0].dp.dist+a[1].dp.dist,bestEdges:a})}D.sort((e,t)=>e.edgeLength-t.edgeLength);for(const e of D){let t=function(e,t){for(const n of e)t.includes(n)||t.push(n);for(const n of t)e.includes(n)||e.push(n)};if(e.edgeLength<20||!d[e.outline1].includes(e.outline2)){t(d[e.outline1],d[e.outline2]);const n=e.bestEdges;for(const e of n){e.p.linkingEdges||(e.p.linkingEdges=[]),e.p.linkingEdges.push(e.dp);const t=l[e.dp.p.pointIdx];for(const n of t.delaunayPoints)if(n.p.pointIdx===e.p.pointIdx){t.linkingEdges||(t.linkingEdges=[]),t.linkingEdges.push(n);break}}}}let y=[];for(const e of l)if(e.linkingEdges&&e.linkingEdges.length>1){const t=e.subtract(l[e.outlinePoints[0]]).normalize(),n=(e.subtract(l[e.outlinePoints[1]]).normalize(),z(t)),r=2*Math.PI-n+o.Epsilon;e.linkingEdges.sort((t,n)=>(z(e.subtract(t.p).normalize())+r)%(2*Math.PI)-(z(e.subtract(n.p).normalize())+r)%(2*Math.PI))}let b=null;for(const e of l)e.isOnConvexHull&&!e.linkingEdges&&(b=e);let w=b,C=w,v=[],A=[];do{if(w.isOnConvexHull&&y.push(w),v.push(w),A.includes(w.pointIdx)){console.log("oh boy loop detected");break}A.push(w.pointIdx);let e=C.pointIdx===w.outlinePoints[0],t=!1;if(w.linkingEdges)for(const n of w.linkingEdges)C.pointIdx===n.p.pointIdx?e=!0:e&&!A.includes(n.p.pointIdx)&&(C=w,w=n.p,t=!0);t||(C=w,w=l[w.outlinePoints[1]])}while(w.pointIdx!=b.pointIdx);m.sort((e,t)=>e-t);const E={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(let e of y)E.mins[0]=Math.min(E.mins[0],e.x),E.maxs[0]=Math.max(E.maxs[0],e.x),E.mins[1]=Math.min(E.mins[1],e.z),E.maxs[1]=Math.max(E.maxs[1],e.z);let _=0,F=[],k=[];for(let e=0;e<y.length;e++){const t=y[e],n=y[(e+1)%y.length];t.concavityDepth=0;let r=(e,t)=>{const n=t.pointIdx,i=v[e];let o=null,a=null,s=e+1;for(;s<v.length&&v[s].pointIdx!=n;){const e=v[s];e.concavityDepth?e.concavityDepth+=1:e.concavityDepth=1;for(const t of e.delaunayPoints)t.p.pointIdx===i.pointIdx&&(o=s),null===a&&t.p.pointIdx===n&&(a=s);s+=1}const u=t.subtract(i);if(null!==o&&null!==a&&o!=a)v[o].lerpTarget=i.add(u.scale(1/3)).subtract(v[o]),v[a].lerpTarget=i.add(u.scale(2/3)).subtract(v[a]),o-e>1&&r(e,v[o]),a-o>1&&r(o,v[a]),s-a>1&&r(a,t);else if(null!==o||null!==a){let n=null!==o?o:a;v[n].lerpTarget=i.add(u.scale(.5)).subtract(v[n]),n-e>1&&r(e,v[n]),s-n>1&&r(n,t)}return s};_=r(_,n,0)}h("edgeVoronois",F,k),console.log("finished?"),r.renderData.layoutData[n]={bounds:E,keyGroups:a,convexHull:y,kgOutlines:u,minOutline:v,kPs:l,thetaValues:m}}}()}function ae(e,t){for(const t of e){t.outlineLines=[],t.parsedOutlineLines={};let e=t.points;for(let n=0;n<e.length;n++){let r=e[n],i=e[(n+1)%e.length];t.outlineLines.push([r,i])}}let n=o.Epsilon,r=(e,t,n,r,i,a,s)=>{let u=Math.max(a-n,0)/t,l=a/t;u<1-o.Epsilon&&l>o.Epsilon&&(u>o.Epsilon&&s.push([r[0],r[0].add(i.scale(a-n))]),l<1-o.Epsilon&&s.push([r[0].add(i.scale(a)),r[1]]),s.splice(e,1))};for(const i of e){let a=t?e:i.overlappingPolys;for(const[e,t]of Object.entries(a))if(t.id!==i.id)for(let e=i.outlineLines.length-1;e>=0;e--){let a=i.outlineLines[e],s=a[1].subtract(a[0]),u=s.length(),l=s.normalizeFromLength(u);for(let s=t.outlineLines.length-1;s>=0;s--){let c=t.outlineLines[s],h=c[1].subtract(c[0]),f=h.length(),d=h.normalizeFromLength(f),p=o.Vector3.Dot(d,l);if(Math.abs(p)>1-o.Epsilon){let h=a[0].subtract(c[0]);if(h.lengthSquared()<o.Epsilon&&p>0){if(f>=u-o.Epsilon){i.outlineLines.splice(e,1);break}a[0]=c[1];break}let m=o.Vector3.Dot(h,d);if(c[0].add(d.scale(m)).subtract(a[0]).lengthSquared()<n)if(p<o.Epsilon-1)r(s,f,u,c,d,m,t.outlineLines),r(e,u,f,a,l,m,i.outlineLines);else if(p>1-o.Epsilon){if(m>o.Epsilon){let t=f-m;if(t>o.Epsilon){if(u-t<o.Epsilon){i.outlineLines.splice(e,1);break}a[0]=a[0].add(l.scale(t))}}if(m<o.Epsilon){let t=-m;if(t<u-o.Epsilon){if(t<o.Epsilon){i.outlineLines.splice(e,1);break}a[1]=a[0].add(l.scale(t))}}}}}}}for(const n of e){let r=t?e:n.overlappingPolys;for(const[e,t]of Object.entries(r))if(n.id!==t.id)for(let e=n.outlineLines.length-1;e>=0;e--){let r=n.outlineLines[e],i=r[1].subtract(r[0]),a=new o.Vector3(i.z,0,-i.x).normalize(),s=[],u=!1,l=t.points;for(let e=0;e<l.length;e++){let t=S(r[0],r[1],i,a,l[e],l[(e+1)%l.length]);if("in_segment"===t.type&&t.intersection)s.push(t.intersection);else if("colinear"===t.type){u=!0;break}}if(u)continue;let c=I(r[0],l),h=I(r[1],l);if(c&&h&&s.length<=1)n.outlineLines.splice(e,1);else if(1===s.length)c?r[0]=s[0]:r[1]=s[0],r[1].subtract(r[0]).lengthSquared()<o.Epsilon*o.Epsilon&&n.outlineLines.splice(e,1);else if(s.length>1){s.sort((e,t)=>e.subtract(r[0]).lengthSquared()-t.subtract(r[0]).lengthSquared());let t=r[1];r[1]=s[0],r[1].subtract(r[0]).lengthSquared()<o.Epsilon*o.Epsilon&&n.outlineLines.splice(e,1);for(let e=2;e<s.length;e+=2)s[e-1].subtract(s[e]).lengthSquared()>o.Epsilon*o.Epsilon&&n.outlineLines.push([s[e-1],s[e]]);s.length%2==0&&s[s.length-1].subtract(t).lengthSquared()>o.Epsilon*o.Epsilon&&n.outlineLines.push([s[s.length-1],t])}}}let i=null,a=0;for(;;){let n=null,r=-1,o=!1;for(const t of e){for(let e=0;e<t.outlineLines.length;e++)if(!t.parsedOutlineLines[e]){n=t,r=e;break}if(r>=0)break}if(-1===r)break;let s=[];for(;null!=n&&r>=0;){n.parsedOutlineLines[r]=!0;let i=n.outlineLines[r];if(o){let e=i[0];i[0]=i[1],i[1]=e}s.push(i[0]),r=-1;let a=20,u=(e,t,s)=>{let u=i[1].subtract(e[0]).lengthSquared();u<a&&(a=u,n=t,r=s,o=!1),u=i[1].subtract(e[1]).lengthSquared(),u<a&&(a=u,n=t,r=s,o=!0)};for(let e=0;e<n.outlineLines.length;e++)n.parsedOutlineLines[e]||u(n.outlineLines[e],n,e);let l=t?e:n.overlappingPolys;for(const[e,t]of Object.entries(l))if(n.id!==t.id)for(let e=0;e<t.outlineLines.length;e++)t.parsedOutlineLines[e]||u(t.outlineLines[e],t,e)}s.length>a&&(i=s,a=s.length)}return i}function se(e,t,n){let r=0,i={};for(const[i,o]of Object.entries(e))if(o.caseIdx==n)for(const[n,a]of Object.entries(o[t])){for(const[s,u]of Object.entries(e))if(u.caseIdx==o.caseIdx)for(const[o,l]of Object.entries(u[t]))if((s!==i||n!==o)&&O(a,l))if(a.overlappingPolys[l.id]=l,l.overlappingPolys[a.id]=a,a.overlapGroupId&&l.overlapGroupId){let n=a.overlapGroupId,r=l.overlapGroupId;for(const[i,o]of Object.entries(e))for(const e of o[t])e.overlapGroupId===r&&(e.overlapGroupId=n)}else a.overlapGroupId?l.overlapGroupId=a.overlapGroupId:l.overlapGroupId?a.overlapGroupId=l.overlapGroupId:a.overlapGroupId=l.overlapGroupId=r++;a.overlapGroupId||(a.overlapGroupId=r++)}for(const[r,o]of Object.entries(e))if(o.caseIdx==n)for(const[e,n]of o[t].entries())i[n.overlapGroupId]||(i[n.overlapGroupId]=[]),i[n.overlapGroupId].push(n);return i}function ue(e,t){ke();let n=e.screwType?e.screwType:"m2_simple",r=i.screwTypes[n],o=r.screwHoleRadius;return t!==e.topLayer&&t!==e.bottomLayer&&r.standoffRadius&&(o=r.standoffRadius),o}function le(e,t){const n=Se;(!e.topLayer||n[t].stackOrder&&n[t].stackOrder>n[e.topLayer].stackOrder)&&(e.topLayer=t),(!e.bottomLayer||n[t].stackOrder&&n[t].stackOrder<n[e.bottomLayer].stackOrder)&&(e.bottomLayer=t)}function ce(e,t,n,r,a,s,u){const l=function(){const e=ke(),t=e.screwType?e.screwType:"m2_simple";return i.screwTypes[t].minBoss}(),c=ue({}),h=c+l;let f=V(a,(n-2*h)*t.screwBezelBias+h-n);t.screws=[];let d=2*h;if(d>o.Epsilon){let e=[];for(let t=f.length-1;t>=0;t--){let n=f[t],r=(t+f.length-1)%f.length,i=f[r];if(n.subtract(i).lengthSquared()<d*d)e.includes(t)||e.push(t),e.includes(r)||e.push(r);else if(e.length){let t=f[(e[0]+1)%f.length],n=f[(e[e.length-1]+f.length-1)%f.length],r=1e8,i=0;for(const o of e){let e=f[o],a=Math.abs(t.subtract(e).lengthSquared()-n.subtract(e).lengthSquared());a<r&&(r=a,i=o)}for(const t of e)t!=i&&f.splice(t,1);e.length=0}}}const p=t.maxScrewSpan;for(let e=f.length-1;e>=0;e--){let t=f[e],n=f[(e+f.length-1)%f.length],r=t.subtract(n),i=r.length();if(i>p){r=r.normalizeFromLength(i);const t=Math.floor(i/p),o=i/(t+1);for(let i=t;i>0;i--){let t=n.add(r.scale(i*o));f.splice(e,0,t)}}}let m={};for(const[e,t]of Object.entries(Se))t.shape&&(m[t.shape]||(m[t.shape]=[]),m[t.shape].push(e));new o.Vector3(20,0,-3500);for(let e=f.length-1;e>=0;e--){let n={location:f[e],shapes:[],topLayer:null,bottomLayer:null};for(const[e,t]of Object.entries(m)){n.shapes.push(e);for(const e of t)le(n,e)}t.screws.push(n)}}function he(e,t,n,i,a){const s=r.scene,u=n.rootXform,l=r.renderData.mats;let c=n.feet;const h=Me(i,e,"bezelThickness"),f=Math.min(h,Me(i,e,"caseCornerFillet"));n.layers[e]={name:e,outlines:[],meshes:[],outlineBounds:{mins:new o.Vector3(1e7,1e6,1e6),maxs:new o.Vector3(-1e7,-1e6,-1e6)}};for(const r of c){const a=r.screws[0],c=r.screws[1],p=a.location.x>=c.location.x?a.location:c.location,m=a.location.x>=c.location.x?c.location:a.location,g=h/2,D=Math.min(p.z,m.z)-g*t.chin,y=H([new o.Vector3(p.x+g,0,D-g),new o.Vector3(p.x+g,0,p.z+g),new o.Vector3(m.x-g,0,m.z+g),new o.Vector3(m.x-g,0,D-g)],0,Math.min(f,h/2),!1);n.layers[e].outlines.push(y);let b=[];for(const t of r.screws){let r=new k(t.location,ue(t,e));n.layers[e].outlines.push(r),b.push(Z(r,0,19))}let w=$(y,8);const C=o.MeshBuilder.CreatePolygon(e,{shape:w,depth:t.height,smoothingThreshold:.1,holes:b},s);C.parent=u,C.position.y=me[e]||t.offset,C.material=l[Me(i,e,"material")],d(C);C.getBoundingInfo();n.layers[e].meshes.push(C);const v=Y(y);n.layers[e].outlineBounds.mins.minimizeInPlace(v.mins),n.layers[e].outlineBounds.maxs.maximizeInPlace(v.maxs)}}function fe(e,t,n){const r=e.bounds;let a=[7.5,2*n],s=t.usbPortPos*i.base1U[0];t.usbPortCentered&&(s=r.mins[0]+(r.maxs[0]-r.mins[0])/2);let u=[s,r.maxs[1]+n/2],l=o.Matrix.Translation(u[0],0,u[1]);e.portCut=[new x([o.Vector3.TransformCoordinates(new o.Vector3(-a[0],0,-a[1]),l),o.Vector3.TransformCoordinates(new o.Vector3(a[0],0,-a[1]),l),o.Vector3.TransformCoordinates(new o.Vector3(a[0],0,a[1]),l),o.Vector3.TransformCoordinates(new o.Vector3(-a[0],0,a[1]),l)])]}function de(e,t,n){let r=n.screws,i=[];if(!n.hasFeet)return void(t.feet=i);let o=t.bounds,a=(o.mins[1],o.maxs[1],o.mins[1],-1e4);for(const e of r)a=Math.max(a,e.location.z);let s=[];for(const e of r)a-e.location.z<20&&s.push(e);s.sort((e,t)=>e.location.x-t.location.x),s.length%2&&s.splice(Math.floor(s.length/2),1);for(let e=0;e<s.length;e+=2){const t=s[e],n=s[e+1],r={screws:[t,n]};i.push(r);for(const[e,r]of Object.entries(Se))r.customShape===he&&(le(t,e),le(n,e))}t.feet=i}function pe(){const e=ke();for(const[t,n]of Object.entries(e.cases)){r.renderData.cases[t];const e=r.renderData.layoutData[t];e&&Q(e.minOutline,t)}}const me={};function ge(){const e=r.scene,t=ke(),n=r.renderData.keys,a=r.renderData.mats;!function(){r.scene;const e=ke();for(const[t,n]of Object.entries(e.cases)){r.renderData.cases[t]||r.renderData.cases.push({layers:{}});const e=r.renderData.cases[t];for(const[t,n]of Object.entries(e.layers))if(n.mesh&&(me[t]=mesh.position.y,p(n.mesh)),n.meshes){for(const e of n.meshes)me[t]=e.position.y,p(e);n.meshes.length=0}e.layers={}}}();for(const[s,u]of Object.entries(t.cases)){r.renderData.cases[s]||r.renderData.cases.push({layers:{}});const l=r.renderData.cases[s],c=l.rootXform;c.position.x=50*s;const h=r.renderData.layoutData[s];if(!h||Object.keys(h.keyGroups).length<=0)continue;let f=h.kgOutlines,p={},m={};p.bezel=[],m.bezel=[],l.bounds=h.bounds;for(const[e,t]of Object.entries(f)){let e=H(t,0,i.bezelCornerFillet,!1);p.bezel.push(e),m.bezel.push($(e))}let g=se(n,"switchCut",s);p.switchCuts=[],m.switchCuts=[];for(const[e,t]of Object.entries(g)){let e=H(ae(t),0,.5,!1);p.switchCuts.push(e);const n=$(e);m.switchCuts.push(n)}if(u.hasUSBPort){let e=0;for(const[t,n]of Object.entries(Se))if(n.portCut){const n=Me(u,t,"bezelThickness");e=Math.max(e,n)}fe(l,u,e)}let D=r.pcbData[s].outlineBounds,y=l.bounds;const b=[new o.Vector3(Math.min(y.mins[0],D.mins[0]),0,Math.min(y.mins[1],D.mins[1])),new o.Vector3(Math.max(y.maxs[0],D.maxs[0]),0,Math.min(y.mins[1],D.mins[1])),new o.Vector3(Math.max(y.maxs[0],D.maxs[0]),0,Math.max(y.maxs[1],D.maxs[1])),new o.Vector3(Math.min(y.mins[0],D.mins[0]),0,Math.max(y.maxs[1],D.maxs[1]))];let w=h.convexHull,C=[1e6,1e6,1e6,1e6],v=[-1,-1,-1,-1];for(let e=0;e<w.length;e++){const t=w[e];for(let n=0;n<4;n++){let r=o.Vector3.DistanceSquared(t,b[n]);r<C[n]&&(v[n]=e,C[n]=r)}}let A={},x=4;for(let e=0;e<x;e++){let t=v[e],n=v[(e+1)%x];n<t&&(n+=w.length);let r=b[e],i=b[(e+1)%x].subtract(r),o=i.length();i.normalizeFromLength(o);for(let e=t+1;e<n;e++)A[w[e%w.length].pointIdx]=T(r,i,w[e%w.length]);A[w[t].pointIdx]=r}l.convexHull=[...w],l.outlineTargets=A;let E=1e5,_=0,F=-1,B=null;for(const[e,t]of Object.entries(Se)){const n={name:e,outlines:[],meshes:[]};l.layers[e]=n;const r=Me(u,e,"bezelConcavity");let i=0;for(const e of h.minOutline)i=Math.max(i,e.concavityDepth);const o=(1+i)*r,a=Math.floor(o),s=o-a;n.outline=[];for(const e of h.minOutline)e.concavityDepth<a?n.outline.push(e):e.concavityDepth==a&&(0===e.concavityDepth?n.outline.push(e.scale(s).add(l.outlineTargets[e.pointIdx].scale(1-s))):n.outline.push(e.add(e.lerpTarget.scale(1-s))));null!==t.tuneable&&r>F&&(F=r,B=n);const c=Me(u,e,"bezelThickness"),f=Math.min(c,Me(u,e,"caseCornerFillet"));null!==t.tuneable&&(_=Math.max(_,f),E=Math.min(E,c)),n.outline=G(n.outline,c,null).outline}ce(0,u,E,0,B.outline),de(0,l,u);for(const[n,f]of Object.entries(Se)){const g=l.layers[n],D=Me(u,n,"bezelThickness"),y=Math.min(Me(u,n,"caseCornerFillet"));p.cavityInner=H(h.minOutline,0,i.bezelCornerFillet,!1),m.cavityInner=$(p.cavityInner,8),p.cavityInnerEdge=[p.cavityInner],m.cavityInnerEdge=[m.cavityInner];if(u.hasUSBPort&&f.portCut){let e=ae(l.portCut),t=new Array(e.length).fill(0),n=V(g.outline,-D),r=1,o=N(n,new Array(n.length).fill(i.bezelCornerFillet),e,t,r),a=o.outline,s=o.fillets;a.reverse(),s.reverse();let u=new Array(g.outline.length).fill(y);o=N(V(g.outline,0),u,a,s,r,!0),a=o.outline;let c=o.fillets;p.caseFrame=H(a,0,c,!1),m.caseFrame=$(p.caseFrame,8),p.cavityInnerEdge.length=0,m.cavityInnerEdge.length=0}else p.caseFrame=H(g.outline,0,y,!1),m.caseFrame=$(p.caseFrame,8);if(p.pcbOutline=H(r.pcbData[s].outline,0,2,!1),m.pcbOutline=$(p.pcbOutline),p[f.shape]&&g.outlines.push(p[f.shape]),i[f.visFilter])if(f.customShape)f.customShape(n,f,l,u,t);else{if(f.holes.includes("screwHoles")){let e=[];for(const t of u.screws)e.push(new k(t.location,ue(t,n)));p.screwHoles=e,m.screwHoles=p.screwHoles.map(e=>Z(e,0,19))}const t=m[f.shape];let r=[];for(const e of f.holes)null!=p[e]&&(l.layers[n].outlines=l.layers[n].outlines.concat(p[e])),null!=m[e]&&(r=r.concat(m[e]));const i=o.MeshBuilder.CreatePolygon(n,{shape:t,depth:f.height,smoothingThreshold:.1,holes:r},e);i.parent=c,i.position.y=me[n]||f.offset,i.material=a[Me(u,n,"material")],d(i),l.layers[n].meshes.push(i),l.layers[n].outlineBounds=Y(p[f.shape])}}if(u.hasFeet){let e=1e6,t=1e6,n=15;for(const n of l.layers.feet.meshes){const r=n.getBoundingInfo();e=Math.min(e,r.minimum.y),t=Math.min(t,r.minimum.z)}const r=l.layers.bottom.meshes[0].getBoundingInfo();r.minimum.y;let i=r.minimum.z;console.log(`foot: ${t} base: ${i}`),u.typingAngle=Math.atan2(-n,t-i)}else u.typingAngle=0;ye(l,u),console.log("typing angle: "+180*u.typingAngle/Math.PI)}}function De(){oe(),pe(),ge()}function ye(e,t){let n=e.rootXform,r=t.typingAngle||0;"flat"===e.viewRotation&&(r=0);let i=new o.QuinticEase;i.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT),o.Animation.CreateMergeAndStartAnimation("expand",n,"rotation.x",30,20,n.rotation.x,r,o.Animation.ANIMATIONLOOPMODE_CONSTANT,i)}function be(e,t){e.viewRotation="flat",ye(e,t)}function we(e,t){e.viewRotation="natural",ye(e,t)}function Ce(){for(const[e,t]of Object.entries(r.renderData.cases))we(t,ke().cases[e])}function ve(e){const t=ke();let n=Object.keys(t.layout.keys).length;for(;t.layout.keys["key"+n];)n+=1;const r={color:"#e8e7e3",matName:"#cccccc",labels:[],textColor:[],textSize:[],default:{textColor:"#5c5c5c",textSize:7},x:0,y:-1,row:0,width:1,height:1,rotation_x:0,rotation_y:0,rotation_angle:0,decal:!1,ghost:!1,stepped:!1,nub:!1,id:"key"+n};if(e)for(const[t,n]of Object.entries(e))r[t]=n;t.layout.keys[r.id]=r}function Ae(e){const t=r.renderData.keys[e];t&&(t.keycap&&p(t.keycap),t.switch&&p(t.switch),delete r.renderData.keys[e])}function xe(e){!function(){for(const[e,t]of Object.entries(r.renderData.keys))t.keycap&&p(t.keycap),t.switch&&p(t.switch);r.renderData.keys={};for(const[e,t]of Object.entries(r.renderData.cases))for(const[e,n]of Object.entries(t.layers))if(n.mesh&&p(n.mesh),n.meshes){for(const e of n.meshes)p(e);n.meshes.length=0}}();let t=r.renderData.mats;!function(e){if(e.kbdVersion)if("0.0.2"===e.kbdVersion){for(const[t,n]of Object.entries(e.cases))n.material="pom_white";Te(e)}else if("0.0.3"===e.kbdVersion){const t={min:5.5,max:50},n={min:.5,max:30};for(const[r,i]of Object.entries(e.cases)){i.bezelThickness=o.Scalar.Lerp(t.min,t.max,i.bezelThickness),i.caseCornerFillet=o.Scalar.Lerp(n.min,n.max,i.caseCornerFillet);for(const[e,r]of Object.entries(i.layers))void 0!==r.bezelThickness&&(r.bezelThickness=o.Scalar.Lerp(t.min,t.max,r.bezelThickness)),void 0!==r.caseCornerFillet&&(r.caseCornerFillet=o.Scalar.Lerp(n.min,n.max,r.caseCornerFillet))}Te(e)}else e.kbdVersion&&Te(e);else{let t={};t.meta=e.meta,t.cases=e.cases?e.cases:{},t.hasFeet=!0,t.layout={keys:{}};let n=0;for(let r of e.keys){let e={id:"key"+n++,special:"standard",x:r.x,y:r.y,caseIdx:r.caseIdx||0,width:r.width,height:r.height,rotation_angle:r.rotation_angle,nub:r.nub,stepped:r.stepped,type:r.type,encoder_knob_size:r.encoder_knob_size},a=3;if(r.labels)for(const t of r.labels)if(t){console.log("checking label "+t);let n=_e[t.toLowerCase()];if(n){console.log("row guess "+n.row),a=n.row,e.txt=t;break}}e.row=a;let s=(e=>{switch(e){case"oled":{let e=[(38.1+i.bezelGap)/2,(14.1+i.bezelGap)/2];return[r.x*i.base1U[0]+e[0],-(r.y*i.base1U[1]+e[1])]}case"ec11":return[(r.x+.5)*i.base1U[0],-(r.y+.5)*i.base1U[1]];default:{const e=[(i.base1U[0]+i.base1U[0]*(r.width-1))/2,(i.base1U[1]+i.base1U[1]*(r.height-1))/2];return[r.x*i.base1U[0]+e[0],-(r.y*i.base1U[1]+e[1])]}}})(r.type),u=o.Matrix.Translation(s[0],0,s[1]);0!=r.rotation_angle&&(u=u.multiply(o.Matrix.Translation(-r.rotation_x*i.base1U[0],0,r.rotation_y*i.base1U[1])),u=u.multiply(o.Matrix.RotationY(r.rotation_angle*Math.PI/180)),u=u.multiply(o.Matrix.Translation(r.rotation_x*i.base1U[0],0,-r.rotation_y*i.base1U[1])));let l=o.Vector3.TransformCoordinates(new o.Vector3(0,0,0),u);e.x=l.x,e.y=-l.z,t.cases[e.caseIdx]||(t.cases[e.caseIdx]=Object.assign({},i.defaultCase)),e.matName=r.color,1===r.width&&r.height>1&&(e.vertical=!0),r.width2===r.width&&r.height2===r.height&&0===r.x2&&0===r.y2||(1.5===r.width2&&1===r.height2&&1.25===r.width&&2===r.height&&-.25===r.x2?(e.row="special",e.special="ISO"):2.25===r.width2&&1===r.height2&&1.5===r.width&&2===r.height&&-.75===r.x2?(e.row="special",e.special="BAE"):1.75===r.width2&&1===r.height2&&1.25===r.width&&r.x2,e.width2=r.width2,e.height2=r.height2,e.x2=r.x2,e.y2=r.y2),!1===r.decal&&!1===r.ghost&&(t.layout.keys[e.id]=e)}t.kbdVersion="0.0.2",Te(t)}}(e),Be()||(Fe.keycapDefaults={profile:"KAM"});for(const e of Object.values(ke().layout.keys))e.matName||(e.matName=e.color),t[e.matName]||s(e.matName,o.Color3.FromHexString(e.matName));r.renderData.cases={};for(const[e,t]of Object.entries(ke().cases)){const n={layers:{},rootXform:new o.TransformNode(`case${e}Root`)};r.renderData.cases[e]=n,we(n,t)}De(),l("angle")}function Ee(){return function(){const e=ke();return e.kbdVersion="0.0.4",JSON.stringify(e)}()}const _e={esc:{usage:"func",row:0},escape:{usage:"func",row:0},f1:{usage:"func",row:0},f2:{usage:"func",row:0},f3:{usage:"func",row:0},f4:{usage:"func",row:0},f5:{usage:"func",row:0},f6:{usage:"func",row:0},f7:{usage:"func",row:0},f8:{usage:"func",row:0},f9:{usage:"func",row:0},f10:{usage:"func",row:0},f11:{usage:"func",row:0},f12:{usage:"func",row:0},print:{usage:"func",row:0},printscr:{usage:"func",row:0},prtsc:{usage:"func",row:0},scr:{usage:"func",row:0},"scroll lock":{usage:"func",row:0},scroll:{usage:"func",row:0},pause:{usage:"func",row:0},break:{usage:"func",row:0},ins:{usage:"func",row:1},insert:{usage:"func",row:1},hom:{usage:"func",row:1},home:{usage:"func",row:1},pgup:{usage:"func",row:1},"page up":{usage:"func",row:1},del:{usage:"func",row:2},delete:{usage:"func",row:2},end:{usage:"func",row:2},pgdn:{usage:"func",row:2},"page down":{usage:"func",row:2},"`":{usage:"punc",row:1},"~":{usage:"punc",row:1},1:{usage:"num_row",row:1},2:{usage:"num_row",row:1},3:{usage:"num_row",row:1},4:{usage:"num_row",row:1},5:{usage:"num_row",row:1},6:{usage:"num_row",row:1},7:{usage:"num_row",row:1},8:{usage:"num_row",row:1},9:{usage:"num_row",row:1},0:{usage:"num_row",row:1},"-":{usage:"punc",row:1},"+":{usage:"punc",row:1},tab:{usage:"mod",row:2},q:{usage:"alph",row:2},w:{usage:"alph",row:2},e:{usage:"alph",row:2},r:{usage:"alph",row:2},t:{usage:"alph",row:2},y:{usage:"alph",row:2},u:{usage:"alph",row:2},i:{usage:"alph",row:2},o:{usage:"alph",row:2},p:{usage:"alph",row:2},"[":{usage:"punc",row:2},"]":{usage:"punc",row:2},"\\":{usage:"punc",row:2},a:{usage:"alph",row:3},s:{usage:"alph",row:3},d:{usage:"alph",row:3},f:{usage:"alph",row:3},g:{usage:"alph",row:3},h:{usage:"alph",row:3},j:{usage:"alph",row:3},k:{usage:"alph",row:3},l:{usage:"alph",row:3},";":{usage:"punc",row:3},"'":{usage:"punc",row:3},z:{usage:"alph",row:4},x:{usage:"alph",row:4},c:{usage:"alph",row:4},v:{usage:"alph",row:4},b:{usage:"alph",row:4},n:{usage:"alph",row:4},m:{usage:"alph",row:4},",":{usage:"punc",row:4},".":{usage:"punc",row:4},"/":{usage:"punc",row:4}};let Fe={};function ke(){return Fe}function Be(){return Fe.keycapDefaults}function Te(e){Fe=e}const Se={pcbMesh:{height:1.6,offset:-5.1,stackOrder:null,visFilter:"drawPCB",shape:"pcbOutline",holes:[],material:"fr4",physicalMat:"FR4",tuneable:null},plateFoam:{height:3.5,offset:-1.5,stackOrder:null,visFilter:"drawPlateFoam",shape:"pcbOutline",holes:["switchCuts"],material:"foam_white",physicalMat:"FOAM",tuneable:null},caseFoam:{height:3.5,offset:-7.5,stackOrder:null,visFilter:"drawCaseFoam",shape:"cavityInner",holes:[],material:"foam_white",physicalMat:"FOAM",tuneable:null},bezel:{height:3,offset:6,stackOrder:2,visFilter:"drawBezel",shape:"caseFrame",holes:["bezel","screwHoles"],mat:"case",physicalMat:"acrylic"},bezel1:{height:3,offset:3,stackOrder:1,visFilter:"drawBezel",shape:"caseFrame",holes:["bezel","screwHoles"],mat:"case",physicalMat:"acrylic"},plate:{height:1.5,offset:0,stackOrder:0,visFilter:"drawPlate",shape:"caseFrame",holes:["screwHoles","switchCuts"],mat:"plate",physicalMat:"alu"},edge:{height:3,offset:-1.5,stackOrder:-1,visFilter:"drawCase",shape:"caseFrame",portCut:!0,holes:["screwHoles","cavityInnerEdge"],mat:"case",physicalMat:"acrylic"},edge2:{height:3,offset:-4.5,stackOrder:-2,visFilter:"drawCase",shape:"caseFrame",portCut:!0,holes:["screwHoles","cavityInnerEdge"],mat:"case",physicalMat:"acrylic"},edge3:{height:3,offset:-7.5,stackOrder:-3,visFilter:"drawCase",shape:"caseFrame",portCut:!0,holes:["screwHoles","cavityInnerEdge"],mat:"case",physicalMat:"acrylic"},bottom:{height:3,offset:-10.5,stackOrder:-4,visFilter:"drawCase",shape:"caseFrame",holes:["screwHoles"],mat:"case",physicalMat:"acrylic"},feet4:{height:3,offset:-13.5,stackOrder:-5,visFilter:"drawCase",mat:"case",customShape:he,chin:4,physicalMat:"acrylic",tuneable:null},feet3:{height:3,offset:-16.5,stackOrder:-6,visFilter:"drawCase",mat:"case",customShape:he,chin:3,physicalMat:"acrylic",tuneable:null},feet2:{height:3,offset:-19.5,stackOrder:-7,visFilter:"drawCase",mat:"case",customShape:he,chin:2,physicalMat:"acrylic",tuneable:null},feet1:{height:3,offset:-22.5,stackOrder:-8,visFilter:"drawCase",mat:"case",customShape:he,chin:1,physicalMat:"acrylic",tuneable:null},feet:{height:3,offset:-25.5,stackOrder:-9,visFilter:"drawCase",mat:"case",customShape:he,chin:0,physicalMat:"acrylic",tuneable:null}};function Me(e,t,n){return e.layers&&e.layers[t]&&void 0!==e.layers[t][n]?e.layers[t][n]:Se[t]&&void 0!==Se[t][n]?Se[t][n]:e[n]}function Ie(e,t,n,r){e.layers||(e.layers={}),e.layers[t]||(e.layers[t]={}),e.layers[t][n]=r}const Oe=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:4});function ze(e){return Oe.format(e)}function Pe(e,t,n){const r=[];function i(...e){r.push.apply(r,e)}i('<?xml version="1.0" standalone="no"?>');let o=e.outlineBounds.maxs.x-e.outlineBounds.mins.x+10,a=-e.outlineBounds.mins.z+e.outlineBounds.maxs.z+10;if(i(`<svg width="${ze(o)}mm" height="${ze(a)}mm" viewBox="${ze(e.outlineBounds.mins.x-5)} ${ze(-e.outlineBounds.maxs.z-5)} ${ze(o)} ${ze(a)}" xmlns="http://www.w3.org/2000/svg" version="1.1">`),i(`<title>${t} ${e.name}  ${n} layer</title>`),i(`<desc>The ${t} ${e.name} ${n} layer</desc>`),e.outlines){let t='<path fill="red" fill-rule="evenodd" stroke="blue" stroke-width="1" d="';for(let n of e.outlines)if(Array.isArray(n)){let e=!1;if(n.length>1){let r=n[0];switch(r.type){case 0:t+=`M${ze(r.point.x)},${ze(-r.point.z)}`;break;case 1:let e=r.center.add(P(r.endRot-r.rotDegrees).scale(r.radius));t+=`M${ze(e.x)},${ze(-e.z)}`}for(let r=0;r<=n.length;r++){let i=n[r%n.length];switch(i.type){case 0:e||(t+="L",e=!0),t+=`${ze(i.point.x)},${ze(-i.point.z)} `;break;case 1:e=!1;let n=i.center.add(P(i.endRot).scale(i.radius)),r=i.rotRadians>0?0:1;t+=`A${ze(i.radius)},${ze(i.radius)} 0 0,${r} ${ze(n.x)},${ze(-n.z)} `}}}}else 2==n.type&&(t+=`M${ze(n.center.x+n.radius)},${ze(-n.center.z)}`,t+=`A${ze(n.radius)},${ze(n.radius)} 0 1,0 ${ze(n.center.x-n.radius)},${ze(-n.center.z)} `,t+=`A${ze(n.radius)},${ze(n.radius)} 0 1,0 ${ze(n.center.x+n.radius)},${ze(-n.center.z)} `);t+='z"/>',i(t)}return i("</svg>"),r.join("\n")}const Re=new Intl.NumberFormat("en-US",{minimumFractionDigits:4,maximumFractionDigits:4});function Ne(e){return Re.format(e)}const Le=new Intl.NumberFormat("en-US",{minimumFractionDigits:6,maximumFractionDigits:6});function Ve(e){return Le.format(e)}function Ue(e){return Number(1e6*e).toFixed(0)}function je(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}let Ge=je();function He(e,t){function n(...t){e.push.apply(e,t)}n("G04 #@! TF.GenerationSoftware,TangentSpace,KBGB,(0.0.1)*"),n(`G04 #@! TF.CreationDate,${(new Date).toISOString()}*`),n(`G04 #@! TF.ProjectId,${ke().meta.name},${Ge},rev?*`),n(`G04 #@! TF.SameCoordinates,${Ge}*`),n(`G04 #@! TF.FileFunction,${t.fileFunction}*`),t.polarity&&n(`G04 #@! TF.FilePolarity,${t.polarity}*`),n("%FSLAX46Y46*%"),n("G04 Gerber Fmt 4.6, Leading zero omitted, Abs format (unit mm)*"),n("G04 Created by Tangent Space - KBGB (0.0.1)*"),n("%MOMM*%"),n("%LPD*%")}function $e(e,t,n){const r=[];function i(...e){r.push.apply(r,e)}let o={};"copper"==t?(o.polarity="Positive",o.fileFunction="top"==n?"Copper,L1,Top":"Copper,L2,Bot"):"mask"==t&&(o.polarity="Negative",o.fileFunction="top"==n?"Soldermask,Top":"Soldermask,Bot"),He(r,o),i("G01*"),i("G04 APERTURE LIST*");let a={};for(let[t,r]of Object.entries(e.devices))for(let e of r.footprints){for(const t of e.pths){let e=2*(t.radius+t.ring);a[e]||(a[e]={locs:[],usage:"ComponentPad",diameter:e}),a[e].locs.push(t.location)}if("bot"==n)for(const t of e.pads)a.pads||(a.pads={locs:[],polys:[],usage:"ComponentPad",diameter:.1}),a.pads.polys.push(t.poly)}e.vias.length>0&&"copper"==t&&(a.via={locs:e.vias,usage:"ViaPad",diameter:.6});let s=10;for(let[e,n]of Object.entries(a))n.name="D"+s,"copper"==t&&i(`G04 #@! TA.AperFunction,${n.usage}*`),i(`%AD${n.name}C,${Ve(n.diameter)}*%`),"copper"==t&&i("G04 #@! TD*"),s+=1;let u="D"+s;i("G04 #@! TA.AperFunction,Conductor*"),i(`%AD${u}C,${Ve(e.trackWidth)}*%`),i("G04 #@! TD*"),i("G04 APERTURE END LIST*");for(let[e,t]of Object.entries(a))if(t.locs.length>0){i(t.name+"*");for(const e of t.locs)i(`X${Ue(e.x)}Y${Ue(e.z)}D03*`)}if(a.pads&&a.pads.polys.length>0){i(a.pads.name+"*");for(const e of a.pads.polys){i("G36*");const t=e[e.length-1];i(`X${Ue(t.x)}Y${Ue(t.z)}D02*`);for(const t of e)i(`X${Ue(t.x)}Y${Ue(t.z)}D01*`);i("G37*")}}if(i(u+"*"),"copper"==t&&"top"==n)for(let t of e.topRoutes)i(`X${Ue(t[0].x)}Y${Ue(t[0].z)}D02*`),i(`X${Ue(t[1].x)}Y${Ue(t[1].z)}D01*`);if("copper"==t&&"bot"==n)for(let t of e.bottomRoutes)i(`X${Ue(t[0].x)}Y${Ue(t[0].z)}D02*`),i(`X${Ue(t[1].x)}Y${Ue(t[1].z)}D01*`);return i("M02*"),r.join("\n")}function Ye(e){const t=[H(e.outline,0,2,!1)],n=[];function r(...e){n.push.apply(n,e)}He(n,{fileFunction:"Profile,NP"}),r("G04 APERTURE LIST*"),r("G04 #@! TA.AperFunction,Profile*"),r("%ADD10C,0.200000*%"),r("G04 #@! TD*"),r("G04 APERTURE END LIST*"),r("D10*");for(let e of t)if(Array.isArray(e)){let t=!1;if(e.length>1)for(let n=0;n<=e.length;n++){let i=e[n%e.length];switch(i.type){case 0:let e=n>0?"D01":"D02";t||(r("G01*"),t=!0),r(`X${Ue(i.point.x)}Y${Ue(i.point.z)}${e}*`);break;case 1:t=!1,r("G75*"),i.rotRadians<0?r("G02*"):r("G03*");let o=i.center.add(P(i.endRot).scale(i.radius)),a=P(i.endRot-i.rotRadians).scale(i.radius);r(`X${Ue(o.x)}Y${Ue(o.z)}I${Ue(-a.x)}J${Ue(-a.z)}D01*`)}}}else 2==e.type&&console.log("SKIPPING CIRCLE");return r("M02*"),n.join("\n")}function We(e){ke();const t=[];function n(...e){t.push.apply(t,e)}n("M48"),n("; DRILL file {KBGB (0.0.1)} date Monday, January 04, 2021 at 10:50:19 PM"),n("; FORMAT={-:-/ absolute / inch / decimal}"),n("; #@! TF.CreationDate,"+(new Date).toISOString()),n("; #@! TF.GenerationSoftware,TangentSpace,KBGB,(0.0.1)"),n("FMAT,2"),n("INCH");let r={};for(let[t,n]of Object.entries(e.devices))for(let e of n.footprints)for(const t of e.pths)r[t.radius]||(r[t.radius]={locs:[],rad:t.radius}),r[t.radius].locs.push(t.location);e.vias.length>0&&(r.via={locs:e.vias,rad:.15});let i=1;for(let[e,t]of Object.entries(r))t.name="T"+i,n(`${t.name}C${Ne(.2*t.rad/2.54)}`),i+=1;n("%"),n("G90"),n("G05");for(let[e,t]of Object.entries(r)){n(""+t.name);for(const e of t.locs)n(`X${Ne(.1*e.x/2.54)}Y${Ne(.1*e.z/2.54)}`)}return n("T0"),n("M30"),t.join("\n")}const Ze={keydown:{}},Ke={};let Xe=!1;function qe(e,t,n){Ze[e][t]&&console.log(`rebinding event ${e} key ${t}`),Ze[e][t]=n}function Je(e,t){Ke[e]&&console.log("rebinding pointer event "+e),Ke[e]=t}function Qe(e){Ke[e]=null}function et(e){window.addEventListener("keydown",e=>function(e){!Xe&&Ze.keydown[e.key]?Ze.keydown[e.key](e):console.log("unbound key "+e.key)}(e)),e.onPointerObservable.add(e=>{Ke[e.type]&&Ke[e.type](e)})}var tt=n(1),nt=n(3),rt=n.n(nt);function it(e,t,n){var r=document.createElement("a"),i=new Blob([e],{type:n});r.href=URL.createObjectURL(i),r.download=t,r.click()}const ot=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:4});function at(e){return ot.format(e)}const st=m[5].toHexString();function ut(e,t,n){n=n||{};var r=tt.Button.CreateSimpleButton("button",e);return r.top="0px",r.left="0px",r.width=n.width?n.width:"50px",r.height=n.height?n.height:"50px",r.cornerRadius=2,r.thickness=2,r.children[0].color="#FFFFFF",r.children[0].fontSize=24,r.color="#000000",r.background=st,r.onPointerClickObservable.add((e,n)=>{t&&t(e,n),n.skipNextObservers=!0}),r}function lt(){let e=tt.Button.CreateSimpleButton("screenBlock","");return e.background="#000000",e.alpha=.8,e.cornerRadius=0,e.thickness=0,e.top="0px",e.left="0px",e.width="1",e.height="1",e.pointerEnterAnimation=null,e.pointerOutAnimation=null,e.pointerDownAnimation=null,e.pointerUpAnimation=null,e}function ct(e,t,n,r){let i=n.findIndex(e=>e.val===t);return i<0&&(i=0),ut(n[i].txt,(t,i)=>{!function(e,t,n,r,i){let o=e=>(t,n)=>{e&&e(t,n),a.dispose(),s.dispose(),n.skipNextObservers=!0},a=lt();a.onPointerClickObservable.add(o(r));let s=new tt.ScrollViewer("dropdown");s.zIndex=a.zIndex+1,s.width="165px";const u=Math.min(400,50*t.length);s.height=u+"px",s.barSize=15,s.thickness=0,s.horizontalAlignment=tt.Control.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_TOP,s.leftInPixels=i.centerX-.5*i.widthInPixels,s.topInPixels=Math.max(0,i.centerY-.5*i.heightInPixels-u);let l=new tt.StackPanel;l.isPointerBlocker=!0,l.isVertical=!0;for(const e of t)l.addControl(ut(e.txt,o((t,r)=>{n&&n(e,t,r),i.textBlock.text=e.txt}),{width:150}));s.addControl(l),e.addControl(a),e.addControl(s)}(e,n,r,()=>{},i.target)},{width:"150px"})}let ht=function(e,t,n,r,i,o){let a=xt.addLabel(t+n);var s=new tt.Slider;s.minimum=r,s.maximum=i,s.value=n,s.height="15px",s.width="100px",s.step=.1,s.onValueChangedObservable.add((function(e){a.text=t+e,o(e,a)})),e.addControl(a),e.addControl(s)},ft={activeMode:null,enterModePosition:null,getLocFromInfo:function(e){const t=e.pickInfo.ray,n=-t.origin.y/t.direction.y;return t.origin.add(t.direction.scale(n))},setMode:function(e,t){ft.activeMode&&ft.modes[ft.activeMode].exit&&ft.modes[ft.activeMode].exit(t),ft.activeMode=e,e&&(ft.enterModePosition=this.getLocFromInfo(t),ft.modes[e].enter(t))},processMove:function(e){let t=ft.modes[ft.activeMode];t&&t.move&&t.move(e)},processUp:function(e){let t=ft.modes[ft.activeMode];t&&t.up&&t.up(e)},modes:{keyMove:{keyInfo:{},enter:function(e){for(let e of te){let t=ke().layout.keys[e];ft.modes.keyMove.keyInfo[e]={x:t.x,y:t.y}}ft.alignHoverTimeoutId=null,wt(!1)},move:function(e){let t=ft.getLocFromInfo(e);const n=e.event;let o=r.renderData.keys,a=null;for(const[e,n]of Object.entries(o))if(te.includes(e))console.log("discarding hover check for "+e);else{for(const[r,i]of Object.entries(n.bezelHoles))if(I(t,i.points)){a=e;break}if(null!==a)break}if(ft.alignHoverKeyId!==a&&(ft.alignHoverTimeoutId&&(clearTimeout(ft.alignHoverTimeoutId),ft.alignHoverTimeoutId=null),null!==a)){ft.alignHoverKeyId=a;const e=e=>{let t=ke().layout.keys[e];for(let e of te){let n=ke().layout.keys[e];const r=ft.modes.keyMove.keyInfo[n.id],o=4*(t.x-t.width*i.base1U[0]*.5-r.x)/i.base1U[0],a=4*(t.y-t.height*i.base1U[1]*.5-r.y)/i.base1U[0];r.x=r.x-(o-Math.trunc(o))*i.base1U[0]*.125,r.y=r.y+(a-Math.trunc(a))*i.base1U[1]*.125}};ft.alignHoverTimeoutId=setTimeout(()=>e(a),1e3)}xt.keyAction(e=>{const r=ft.modes.keyMove.keyInfo[e.id];r&&(n.shiftKey?(e.x=r.x+(t.x-ft.enterModePosition.x),e.y=r.y-(t.z-ft.enterModePosition.z)):(e.x=r.x+Math.floor(4*(t.x-ft.enterModePosition.x)/i.base1U[0])*i.base1U[0]*.125,e.y=r.y-Math.floor(4*(t.z-ft.enterModePosition.z)/i.base1U[1])*i.base1U[1]*.125))})},up:function(e){ft.alignHoverTimeoutId&&(clearTimeout(ft.alignHoverTimeoutId),ft.alignHoverTimeoutId=null),ft.setMode(null,e),wt(!0),console.log("pointer up.... mode is "+ft.activeMode)}},keyRotation:{keyInfo:{},enter:function(e){ft.modes.keyMove.rotBump=0;for(let e of te){let t=ke().layout.keys[e];ft.modes.keyMove.keyInfo[e]={rotation_angle:t.rotation_angle,x:t.x,y:t.y}}ft.alignHoverTimeoutId=null,wt(!0)},move:function(e){let t=ft.getLocFromInfo(e);const n=e.event;let i=r.renderData.keys,a=null;for(const[e,n]of Object.entries(i))if(te.includes(e))console.log("discarding hover check for "+e);else{for(const[r,i]of Object.entries(n.bezelHoles))if(I(t,i.points)){a=e;break}if(null!==a)break}let s=180*(z(ft.enterModePosition.subtract(new o.Vector3(bt.x,0,bt.z)).normalize())-z(t.subtract(new o.Vector3(bt.x,0,bt.z)).normalize()))/Math.PI;if(n.shiftKey||(s-=s%15),Math.abs(ft.modes.keyMove.rotBump-s)>o.Epsilon){ft.modes.keyMove.rotBump=s;let e=new o.Vector3;xt.keyAction(t=>{const n=ft.modes.keyMove.keyInfo[t.id];if(n){let r=o.Matrix.Translation(n.x-bt.x,0,-n.y-bt.z);r=r.multiply(o.Matrix.RotationY(s*Math.PI/180)),r=r.multiply(o.Matrix.Translation(bt.x,0,bt.z)),o.Vector3.TransformCoordinatesToRef(o.Vector3.ZeroReadOnly,r,e),t.x=e.x,t.y=-e.z,t.rotation_angle=n.rotation_angle+s}})}},up:function(e){ft.alignHoverTimeoutId&&(clearTimeout(ft.alignHoverTimeoutId),ft.alignHoverTimeoutId=null),ft.setMode(null,e),wt(!0),console.log("pointer up.... mode is "+ft.activeMode)}},selection:{enter:function(e){},move:function(e){let t=ft.getLocFromInfo(e);pt(ft.enterModePosition,t)},up:function(e){const t=e.event;t.metaKey||t.ctrlKey||ne();const n=ft.getLocFromInfo(e),i=ft.enterModePosition,a={x:Math.min(i.x,n.x),z:Math.min(i.z,n.z)},s={x:Math.max(i.x,n.x),z:Math.max(i.z,n.z)},u=new x([new o.Vector3(a.x,0,a.z),new o.Vector3(s.x,0,a.z),new o.Vector3(s.x,0,s.z),new o.Vector3(a.x,0,s.z)]);let l=r.renderData.keys;for(const[e,t]of Object.entries(l))for(const[n,r]of Object.entries(t.bezelHoles))O(u,r)&&re(e);pt(),ft.setMode(null,e),xt.refresh()}}}},dt=null;function pt(e,t){let n=r.renderData.mats;if(dt&&(r.scene.removeMesh(dt),dt.dispose()),e&&t){const i={x:Math.min(e.x,t.x),z:Math.min(e.z,t.z)},a={x:Math.max(e.x,t.x),z:Math.max(e.z,t.z)};if(a.x-i.x>o.Epsilon&&a.z-i.z>o.Epsilon){let e=[new o.Vector3(i.x,0,i.z),new o.Vector3(a.x,0,i.z),new o.Vector3(a.x,0,a.z),new o.Vector3(i.x,0,a.z)];dt=o.MeshBuilder.CreateRibbon("selectionOutline",{pathArray:[W(e,.1,.1,!0),W(e,.5,.5,!0)]},r.scene),dt.material=n.keySel,dt.translate(new o.Vector3(0,25.5,0),1,o.Space.LOCAL)}}}let mt=[],gt=[];function Dt(e,t,n){let i=r.renderData.mats;for(const e of mt)r.scene.removeMesh(e),e.dispose();for(const e of gt)r.scene.removeMesh(e),e.dispose();if(t&&n){const a={x:Math.min(t[0],n[0]),z:Math.min(t[1],n[1])},s={x:Math.max(t[0],n[0]),z:Math.max(t[1],n[1])};if(s.x-a.x>o.Epsilon&&s.z-a.z>o.Epsilon){let t=[new o.Vector3(a.x,0,a.z),new o.Vector3(s.x,0,a.z),new o.Vector3(s.x,0,s.z),new o.Vector3(a.x,0,s.z)];const n=o.MeshBuilder.CreateRibbon("frameOutline"+e,{pathArray:[W(t,20,1,!0),W(t,25.5,5.5,!0)]},r.scene);n.material=i.layoutFrame;const u=o.MeshBuilder.CreatePolygon("gridMatCover"+e,{shape:W(t,20,1,!0)},r.scene);u.material=i.gridMaterial,n.translate(new o.Vector3(0,.3,0),1,o.Space.LOCAL),u.translate(new o.Vector3(0,.2,0),1,o.Space.LOCAL),mt.push(n),gt.push(u)}}}let yt=null,bt={};function wt(e){if(yt&&(r.scene.removeMesh(yt),yt.dispose()),e&&te.length>0){let e=r.renderData.mats,t=r.renderData.keys,n=[1e5,1e5],i=[-1e5,-1e5];for(const e of te){const r=t[e];n[0]=Math.min(n[0],r.mins[0]),n[1]=Math.min(n[1],r.mins[1]),i[0]=Math.max(i[0],r.maxs[0]),i[1]=Math.max(i[1],r.maxs[1])}bt={x:(n[0]+i[0])/2,z:(n[1]+i[1])/2};const a=Math.sqrt(Math.pow(Math.abs(i[0]-bt.x),2)+Math.pow(Math.abs(i[1]-bt.z),2))+15;a>o.Epsilon&&(yt=o.MeshBuilder.CreateTorus("rotHandle",{diameter:2*a,thickness:5,tessellation:64},r.scene),yt.material=e.rotHandle,yt.translate(new o.Vector3(bt.x,30.5,bt.z),1,o.Space.LOCAL))}}const Ct=[{txt:"1U",width:1},{txt:"1.25U",width:1.25},{txt:"1.5U",width:1.5},{txt:"1.75U",width:1.75},{txt:"2U",width:2},{txt:"2.25U",width:2.25},{txt:"2.75U",width:2.75},{txt:"3U",width:3},{txt:"6U",width:6},{txt:"6.25U",width:6.25},{txt:"7U",width:7},{txt:"OLED",type:"oled"},{txt:"EC11-18",type:"ec11",encoder_knob_size:18},{txt:"EC11-19",type:"ec11",encoder_knob_size:19.05},{txt:"EC11-30",type:"ec11",encoder_knob_size:30},{txt:"ISO",type:"special",special:"ISO",width:1.25,height:2,width2:1.5,height2:1,x2:-.25,y2:0},{txt:"1.75U STEPPED",width:1.75,stepped:!0},{txt:"BAE",type:"special",special:"BAE",width:1.5,height:2,width2:2.25,height2:1,x2:-.75,y2:1}],vt={width:1,height:1,width2:null,height2:null,x2:0,y2:0,nub:null,type:"standard",special:null,encoder_knob_size:null};function At(){oe();for(const[e,t]of Object.entries(r.renderData.layoutData))Dt(e,t.bounds.mins,t.bounds.maxs)}const xt={addLabel:function(e){var t=new tt.TextBlock;return t.width="80px",t.height=".9",t.text=e,t.color="white",t.fontSize=24,t},keyAction:function(e){for(let t of te){e(ke().layout.keys[t])}At()},addKeyActionKeycode:function(e,t){qe("keydown",t,()=>{this.keyAction(e)})},addActionButton:function(e,t,n){return n&&qe("keydown",n,t),ut(e,t)},addCaseSelection:function(e){let t=[];for(const[e,n]of Object.entries(ke().cases))xt.activeCase||(xt.activeCase=e),t.push({txt:e,val:e});const n=ct(r.screengui,xt.activeCase,t,(e,t,n)=>{xt.activeCase=e.val});e.addControl(n),t.length<=1&&(n.isVisible=!1)},mData:{},modes:{key:{cameraMode:"top",add:function(){Je(o.PointerEventTypes.POINTERDOWN,e=>{const t=e.pickInfo,n=t.ray,r=-n.origin.y/n.direction.y;n.origin.add(n.direction.scale(r));let i=!0;if(console.log("pickResult is"),console.log(t),t&&t.pickedMesh){const n=t.pickedMesh.parent;let r=t.pickedMesh.name;"rotHandle"===r?(console.log("entering rotation!"),i=!1,ft.setMode("keyRotation",e)):(n&&ke().layout.keys[n.name]&&(r=n.name),te.indexOf(r)>=0&&(i=!1,ft.setMode("keyMove",e)))}i&&ft.setMode("selection",e)}),Je(o.PointerEventTypes.POINTERMOVE,e=>{ft.processMove(e)}),Je(o.PointerEventTypes.POINTERUP,e=>{ft.processUp(e),xt.refresh()}),Je(o.PointerEventTypes.POINTERTAP,e=>{ft.processUp(e),xt.refresh()});let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM;let t=new tt.StackPanel;t.height="50px",t.isPointerBlocker=!0,t.isVertical=!1,t.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM;t.addControl(ct(r.screengui,ke().keycapProfile,[{txt:"KAM",val:"KAM"},{txt:"KAT",val:"KAT"},{txt:"SA",val:"SA"},{txt:"DSA",val:"DSA"},{txt:"DCS",val:"DCS"},{txt:"Cherry",val:"CHE"}],(e,t,n)=>{!function(e){Be().profile=e;let t=r.renderData.keys;for(const[n,r]of Object.entries(t))if(r.keycap)for(const t of r.keycap.getChildMeshes())for(let n=0;n<t.morphTargetManager.numTargets;n++){let r=t.morphTargetManager.getTarget(n);r.name==e?r.influence=1:r.influence=0}}(e.val)})),t.addControl(ut("add key",e=>{ve(),At()},{height:"50px",width:"120px"})),xt.addKeyActionKeycode(e=>e.x-=.125*i.base1U[0],"ArrowLeft"),xt.addKeyActionKeycode(e=>e.y-=.125*i.base1U[1],"ArrowUp"),xt.addKeyActionKeycode(e=>e.y+=.125*i.base1U[1],"ArrowDown"),xt.addKeyActionKeycode(e=>e.x+=.125*i.base1U[0],"ArrowRight");let n=new tt.StackPanel;n.height="50px",n.isPointerBlocker=!0,n.isVertical=!1,n.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,n.addControl(xt.addLabel("  "));let s=e=>{for(let t of te){e(ke().layout.keys[t])}},u=(e,t)=>s(n=>{n[e]=t});n.addControl(ut("add mirror",e=>{!function(){let e=ke();const t={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(let n of te){let r=e.layout.keys[n];t.mins[0]=Math.min(t.mins[0],r.x-i.base1U[0]*r.width/2),t.maxs[0]=Math.max(t.maxs[0],r.x+i.base1U[0]*r.width/2),t.mins[1]=Math.min(t.mins[1],r.y-i.base1U[1]*r.height/2),t.maxs[1]=Math.max(t.maxs[1],r.y+i.base1U[1]*r.height/2)}for(let n of te){let r={...e.layout.keys[n]};delete r.id,r.x+=2*(t.maxs[0]-r.x),r.rotation_angle=-r.rotation_angle,ve(r)}}(),At()},{height:"50px",width:"120px"}));var l=new tt.InputText;l.width="150px",l.height="50px",l.text=" ",l.color="white",l.background="#000000",l.onFocusObservable.add(e=>{Xe=!0}),l.onBlurObservable.add(e=>{Xe=!1}),l.onTextChangedObservable.add(e=>{u("txt",e.text),l.text=""+e.text,oe()}),xt.mData.textInput=l,n.addControl(l);xt.mData.keySizeDropdown=ct(r.screengui,0,Ct,(e,t,n)=>{for(const[t,n]of Object.entries(vt))e[t]?u(t,e[t]):u(t,n);At()}),n.addControl(xt.mData.keySizeDropdown);xt.mData.rowDropdown=ct(r.screengui,0,[{txt:"r0",val:0},{txt:"r1",val:1},{txt:"r2",val:2},{txt:"r3",val:3},{txt:"r4",val:4},{txt:"r5",val:5}],(e,t,n)=>{u("row",e.val),At()}),n.addControl(xt.mData.rowDropdown);var c=new tt.Checkbox;c.width="10px",c.height="10px",c.isChecked=!1,c.color="green",c.onIsCheckedChangedObservable.add((function(e){var t;t=e,s(e=>{e.flipStab=t}),At()})),xt.mData.stabLabel=xt.addLabel("STAB: "),n.addControl(xt.mData.stabLabel),xt.mData.stabCheckbox=c,n.addControl(c);let h=e=>s(e=>{1==e.caseIdx?e.caseIdx=0:e.caseIdx=1,Ae(e.id),function(e){const t=ke();if(!t.cases[e]){t.cases[e]=Object.assign({},i.defaultCase);const n={layers:{},rootXform:new o.TransformNode(`case${e}Root`)};r.renderData.cases[e]=n,we(n,t.cases[e])}}(e.caseIdx)});var f=new tt.Checkbox;f.width="10px",f.height="10px",f.isChecked=!1,f.color="blue",f.onIsCheckedChangedObservable.add((function(e){h(),At()})),n.addControl(xt.addLabel("split")),n.addControl(f),n.addControl(xt.addLabel("  ")),n.addControl(xt.addActionButton("del",()=>{xt.keyAction(e=>{var t;Ae(t=e.id),delete ke().layout.keys[t]}),ne(),xt.refresh()},"Backspace")),xt.mData.setCtrls=t,e.addControl(t),xt.mData.keyCtrls=n,e.addControl(n),r.screengui.addControl(e),xt.activeModeCtrl=e,xt.refresh(),function(e){for(const[e,t]of Object.entries(r.renderData.cases))be(t,ke().cases[e])}(),function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEIN),o.Animation.CreateMergeAndStartAnimation("showGrid",a.ground,"material.opacity",30,40,a.ground.material.opacity,.75,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{}),o.Animation.CreateMergeAndStartAnimation("showMinorGrid",a.ground,"material.minorUnitVisibility",30,40,a.ground.material.minorUnitVisibility,.45,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{}),o.Animation.CreateMergeAndStartAnimation("showFrame",a.frameHolder,"material.alpha",30,40/3,a.frameHolder.material.alpha,.9,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{})}(),function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT);for(const[t,n]of Object.entries(r.renderData.cases)){let t=n.layers;for(const[n,r]of Object.entries(Se))if(t[n])for(const r of t[n].meshes)o.Animation.CreateMergeAndStartAnimation("expand",r,"visibility",30,20,r.visibility,0,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e)}}();for(const[e,t]of Object.entries(r.renderData.layoutData))Dt(e,t.bounds.mins,t.bounds.maxs)},refresh:()=>{if(0===te.length)xt.mData.keyCtrls.isVisible=!1,xt.mData.setCtrls.isVisible=!0;else{xt.mData.setCtrls.isVisible=!1,xt.mData.keyCtrls.isVisible=!0;let e=[],t=[],n="";for(let r of te){let i=ke().layout.keys[r];-1!==t.indexOf(i.row)&&t.push(i.row);for(const t of Ct)t.type===i.type&&t.width===i.width&&t.rad===i.rad&&-1===e.indexOf(t)&&e.push(t);n=i.txt,xt.mData.stabCheckbox=i.flipStab}1===e.length?xt.mData.keySizeDropdown.textBlock.text=e[0].txt:e.length>1&&(xt.mData.keySizeDropdown.textBlock.text="**"),1===t.length?xt.mData.rowDropdown.textBlock.text="r"+t[0]:t.length>1&&(xt.mData.rowDropdown.textBlock.text="**"),1!==te.length?xt.mData.textInput.isVisible=!1:(xt.mData.textInput.isVisible=!0,xt.mData.textInput.text=n||"")}wt(!0);for(const[e,t]of Object.entries(r.renderData.layoutData))Dt(e,t.bounds.mins,t.bounds.maxs)},remove:()=>{Qe(o.PointerEventTypes.POINTERDOWN),Qe(o.PointerEventTypes.POINTERMOVE),Qe(o.PointerEventTypes.POINTERUP),Qe(o.PointerEventTypes.POINTERTAP),r.screengui.removeControl(xt.activeModeCtrl),ne(),function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT);for(const[t,n]of Object.entries(r.renderData.cases)){let t=n.layers;for(const[n,r]of Object.entries(Se))if(t[n])for(const r of t[n].meshes)o.Animation.CreateMergeAndStartAnimation("expand",r,"visibility",30,20,r.visibility,1,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e)}}(),pe(),ge(),xt.mData.keySizeDropdown=null,xt.mData.stabCheckbox=null,wt(!1),function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT),o.Animation.CreateMergeAndStartAnimation("hideGrid",a.ground,"material.opacity",30,15,a.ground.material.opacity,0,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{}),o.Animation.CreateMergeAndStartAnimation("hideMinorGrid",a.ground,"material.minorUnitVisibility",30,15,a.ground.material.minorUnitVisibility,0,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{}),o.Animation.CreateMergeAndStartAnimation("hideFrame",a.frameHolder,"material.alpha",30,15,a.frameHolder.material.alpha,0,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{})}();for(const[e,t]of Object.entries(r.renderData.layoutData))Dt(e)}},view:{cameraMode:"front",add:function(){let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,e.addControl(ut("prev",()=>{Mt()},{height:"50px",width:"120px"})),e.addControl(ut("next",()=>{St()},{height:"50px",width:"120px"})),r.screengui.addControl(e),xt.activeModeCtrl=e,Ce()},refresh:()=>{},remove:()=>{r.screengui.removeControl(xt.activeModeCtrl)}},case:{cameraMode:"front",add:function(){let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,xt.addCaseSelection(e);var t=new tt.Checkbox;t.width="10px",t.height="10px",console.log("case: "+xt.activeCase),console.log(ke().cases),t.isChecked=ke().cases[xt.activeCase].forceSymmetrical,t.color="green",t.onIsCheckedChangedObservable.add((function(e){ke().cases[xt.activeCase].forceSymmetrical=e,ge()})),e.addControl(xt.addLabel("SYM: ")),e.addControl(t);var n=new tt.Checkbox;n.width="10px",n.height="10px",n.isChecked=ke().cases[xt.activeCase].hasFeet,n.color="green",n.onIsCheckedChangedObservable.add((function(e){ke().cases[xt.activeCase].hasFeet=e,ge()})),e.addControl(xt.addLabel("FEET: ")),e.addControl(n);let o=!1,a=function(e){xt.rtBar&&r.screengui.removeControl(xt.rtBar);let t=new tt.StackPanel;t.width=".2",t.isPointerBlocker=!0,t.isVertical=!0,t.horizontalAlignment=tt.Control.HORIZONTAL_ALIGNMENT_RIGHT;let n=function(e){const n=ke().cases[xt.activeCase],r=e+"Pin";let i=[],o=null;for(const[t,a]of Object.entries(Se))if(null!==a.tuneable){let a=Me(n,t,r),s=Me(n,t,e);if(a){if(null===o)for(const t of i)Ie(n,t,e,s);else{const t=i.length,r=(s-o)/(t+1);for(let a=0;a<t;a++)Ie(n,i[a],e,o+r*(a+1))}o=s,i=[]}else i.push(t)}if(null!==o)for(const t of i)Ie(n,t,e,o);for(const[r,i]of Object.entries(Se))null!==i.tuneable&&(t[r].slider.value=Me(n,r,e));ge()},a=function(r){const a=ke().cases[xt.activeCase];let s=new tt.StackPanel;s.height="40px",s.isPointerBlocker=!0,s.isVertical=!1,s.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM;let u=xt.addLabel(r);var l=new tt.Slider,c=new tt.Checkbox;u.height="40px",i[e]?(l.minimum=i[e].min,l.maximum=i[e].max):(l.minimum=0,l.maximum=1),l.value=Me(a,r,e),l.height="15px",l.width="100px",l.onValueChangedObservable.add((function(t){o||(o=!0,c.isChecked=!0,Ie(a,r,e+"Pin",!0),Ie(a,r,e,t),n(e),o=!1)})),c.width="10px",c.height="10px",c.isChecked=Me(a,r,e+"Pin"),c.color="red",c.onIsCheckedChangedObservable.add((function(t){o||(o=!0,Ie(a,r,e+"Pin",t),n(e),o=!1)})),t[r]={lock:c,slider:l},s.addControl(u),s.addControl(l),s.addControl(c),t.addControl(s)};for(const[e,t]of Object.entries(Se))null!==t.tuneable&&a(e);r.screengui.addControl(t),xt.rtBar=t};e.addControl(ut("Shape",()=>{a("bezelConcavity")},{height:"50px",width:"120px"})),e.addControl(ut("Thickness",()=>{a("bezelThickness")},{height:"50px",width:"120px"})),e.addControl(ut("Corners",()=>{a("caseCornerFillet")},{height:"50px",width:"120px"})),r.screengui.addControl(e),xt.activeModeCtrl=e,Ce()},refresh:()=>{},remove:()=>{r.screengui.removeControl(xt.activeModeCtrl),xt.rtBar&&r.screengui.removeControl(xt.rtBar)}},pcb:{cameraMode:"rear",add:function(){let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,xt.addCaseSelection(e);let t=e=>{var t=new tt.Checkbox;return t.width="20px",t.height="20px",t.isChecked=ke().cases[xt.activeCase][e],t.color="orange",t.onIsCheckedChangedObservable.add((function(t){ke().cases[xt.activeCase][e]=t,ge()})),t};var n,i;e.addControl(xt.addLabel("USB: ")),e.addControl(t("hasUSBPort")),e.addControl(xt.addLabel("LOC: ")),e.addControl((n="usbPortPos",(i=new tt.InputText).width="80px",i.maxWidth="80px",i.height="40px",i.text=""+ke().cases[xt.activeCase][n],i.color="white",i.background="green",i.onBlurObservable.add(e=>{console.log("usb port moving to "+e.text);let t=parseFloat(e.text);t&&(ke().cases[xt.activeCase][n]=t),i.text=""+ke().cases[xt.activeCase][n],ge()}),i)),e.addControl(xt.addLabel("Center ")),e.addControl(t("usbPortCentered")),ht(e,"Screw span: ",ke().cases[xt.activeCase].maxScrewSpan,40,300,e=>{ke().cases[xt.activeCase].maxScrewSpan=e,ge()}),ht(e,"Screw offset: ",ke().cases[xt.activeCase].screwBezelBias,0,1,e=>{ke().cases[xt.activeCase].screwBezelBias=e,ge()}),r.screengui.addControl(e),xt.activeModeCtrl=e,Ce()},refresh:()=>{},remove:()=>{r.screengui.removeControl(xt.activeModeCtrl)}},details:{cameraMode:"split",add:function(){let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,xt.addCaseSelection(e);const t=[{txt:"smoke",val:"ac_smoke"},{txt:"clear",val:"ac_clear"},{txt:"blue",val:"ac_blue"},{txt:"purp",val:"ac_purple"},{txt:"yello",val:"ac_yellow"},{txt:"alu",val:"aluminium"},{txt:"pom",val:"pom_white"},{txt:"pom(b)",val:"pom_black"},{txt:"stl",val:"steel"},{txt:"pc",val:"pc_cl"}],n=[{txt:"alu",val:"aluminium"},{txt:"pom",val:"pom_white"},{txt:"pom(b)",val:"pom_black"},{txt:"steel",val:"steel"},{txt:"fr4",val:"fr4"},{txt:"brass",val:"brass"},{txt:"pc",val:"pc_cl"}];const i=ke().cases[xt.activeCase];e.addControl(ct(r.screengui,i.material,t,(e,t,r)=>{const i=ke().cases[xt.activeCase];i.material=e.val,n.findIndex(t=>t.val===e.val)>=0?Ie(i,"plate","material",e.val):i.layers.plate&&i.layers.plate.material||Ie(i,"plate","material","pom_white"),ge()}));!function(e){xt.rtBar&&r.screengui.removeControl(xt.rtBar);let i=new tt.StackPanel;i.width=".2",i.isPointerBlocker=!0,i.isVertical=!0,i.horizontalAlignment=tt.Control.HORIZONTAL_ALIGNMENT_RIGHT;let o=function(e){ke().cases[xt.activeCase];let o=new tt.StackPanel;o.height="50px",o.isPointerBlocker=!0,o.isVertical=!1,o.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM;let a=xt.addLabel(e),s=(e=>{let i=(t,n,r)=>{Ie(ke().cases[xt.activeCase],e,"material",t.val),ge()},o=null;let a=Me(ke().cases[xt.activeCase],e,"material");switch(Se[e].mat){case"case":o=ct(r.screengui,a,t,i);break;case"plate":o=ct(r.screengui,a,n,i)}return o})(e);null!==s&&(a.height="40px",i[e]={dropdown:s},o.addControl(a),o.addControl(s),i.addControl(o))};for(const[e,t]of Object.entries(Se))o(e);r.screengui.addControl(i),xt.rtBar=i}(),r.screengui.addControl(e),xt.activeModeCtrl=e,function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT);for(const[t,n]of Object.entries(r.renderData.cases)){let r=n.layers;for(const[t,n]of Object.entries(Se))if(r[t])for(const i of r[t].meshes)o.Animation.CreateMergeAndStartAnimation("expand",i,"position.y",30,20,i.position.y,n.offset+15*n.stackOrder,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e);be(n,ke().cases[t])}let t=r.renderData.keys;for(const[n,r]of Object.entries(t))r.keycap&&o.Animation.CreateMergeAndStartAnimation("expand",r.keycap,"position.y",30,20+10*Math.random(),r.keycap.position.y,203.5,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{r.keycap.setEnabled(!1)}),r.switch&&o.Animation.CreateMergeAndStartAnimation("expand",r.switch,"position.y",30,30+10*Math.random(),r.switch.position.y,200,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e,()=>{r.switch.setEnabled(!1)})}()},refresh:()=>{},remove:()=>{!function(){let e=new o.QuinticEase;e.setEasingMode(o.EasingFunction.EASINGMODE_EASEINOUT);for(const[t,n]of Object.entries(r.renderData.cases)){let t=n.layers;for(const[n,r]of Object.entries(Se))if(t[n])for(const i of t[n].meshes)o.Animation.CreateMergeAndStartAnimation("collapse",i,"position.y",30,20,i.position.y,r.offset,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e)}let t=r.renderData.keys;for(const[n,r]of Object.entries(t))r.keycap&&(o.Animation.CreateMergeAndStartAnimation("expand",r.keycap,"position.y",30,30+10*Math.random(),r.keycap.position.y,r.keycap.heightOffset,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e),r.keycap.setEnabled(!0)),r.switch&&(o.Animation.CreateMergeAndStartAnimation("expand",r.switch,"position.y",30,20+10*Math.random(),r.switch.position.y,0,o.Animation.ANIMATIONLOOPMODE_CONSTANT,e),r.switch.setEnabled(!0))}(),r.screengui.removeControl(xt.activeModeCtrl),r.screengui.removeControl(xt.rtBar)}},files:{cameraMode:"front",add:function(){let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_BOTTOM,e.addControl(ut("DEBUG",()=>{!function(){let e={shouldExportNode:function(e){return console.log(e),!0}};o.GLTF2Export.GLBAsync(r.scene,"fileName",e).then(e=>{e.downloadFiles()})}()},{height:"50px",width:"120px"})),e.addControl(ut("export SVGs",()=>{!function(){var e=new rt.a;const t=ke();let n="Layer Name,Material,Thickness(mm),Part Width(mm),PartHeight(mm)\n";for(const[i,o]of Object.entries(r.renderData.cases))for(const[r,a]of Object.entries(Se)){let s=o.layers[r];e.file(`${r}_${i}.svg`,Pe(s,t.meta.name,i)),n+=`${r}_${i},${a.physicalMat},${a.height},`,n+=at(s.outlineBounds.maxs.x-s.outlineBounds.mins.x)+",",n+=at(s.outlineBounds.maxs.z-s.outlineBounds.mins.z)+"\n"}e.file("caseBOM.csv",n),e.generateAsync({type:"blob"}).then((function(e){it(e,t.meta.name+"_layers.zip","text/plain")}))}()},{height:"50px",width:"120px"})),e.addControl(ut("export GBRs",()=>{!function(){var e=new rt.a;const t=ke();for(const[t,n]of Object.entries(r.renderData.cases)){ee(t);const n=r.pcbData[t];Ge=je();const i="pcb"+t;e.file(i+".gml",Ye(n)),e.file(i+".txt",We(n)),e.file(i+".gtl",$e(n,"copper","top")),e.file(i+".gbl",$e(n,"copper","bot")),e.file(i+".gts",$e(n,"mask","top")),e.file(i+".gbs",$e(n,"mask","bot"))}e.generateAsync({type:"blob"}).then((function(e){it(e,t.meta.name+"_gerbers.zip","text/plain")}))}()},{height:"50px",width:"120px"})),e.addControl(ut("save layout",()=>{it(Ee(),ke().meta.name+".kbd","text/plain")},{height:"50px",width:"120px"})),e.addControl(ut("load layout",()=>{document.getElementById("loadKBD").click()},{height:"50px",width:"120px"})),e.addControl(ut("import kle",e=>{document.getElementById("loadKLE").click()},{height:"50px",width:"120px"}));let t=xt.addLabel("WORK IN PROGRESS");t.width="260px",e.addControl(t),r.screengui.addControl(e),xt.activeModeCtrl=e},refresh:()=>{},remove:()=>{r.screengui.removeControl(xt.activeModeCtrl)}}},setGUIMode:function(e){e!=xt.activeMode?(xt.modes[xt.activeMode]&&xt.modes[xt.activeMode].remove(),xt.modes[e]&&(xt.modes[e].add(),xt.modes[e].refresh(),l(xt.modes[e].cameraMode)),xt.activeMode=e):xt.modes[xt.activeMode]&&xt.modes[xt.activeMode].refresh()},refresh:function(){xt.modes[xt.activeMode]&&xt.modes[xt.activeMode].refresh()},addModeGUI:function(){xt.modeCtrl?(r.screengui.removeControl(xt.modeCtrl),xt.modeCtrl=null):(r.screengui=tt.AdvancedDynamicTexture.CreateFullscreenUI("screenUI"),r.screengui.renderScale=1);let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_TOP,e.addControl(ut("edit",()=>{xt.addEditModeGUI()},{height:"1",width:"120px"})),xt.modeCtrl=e,r.screengui.addControl(e),xt.setGUIMode("view")},addEditModeGUI:function(){xt.modeCtrl&&(r.screengui.removeControl(xt.modeCtrl),xt.modeCtrl=null);let e=new tt.StackPanel;e.height="50px",e.isPointerBlocker=!0,e.isVertical=!1,e.verticalAlignment=tt.Control.VERTICAL_ALIGNMENT_TOP,e.addControl(ut("layout",()=>{xt.setGUIMode("key")},{height:"1",width:"120px"})),e.addControl(ut("layers",()=>{xt.setGUIMode("details")},{height:"1",width:"120px"})),e.addControl(ut("case",()=>{xt.setGUIMode("case")},{height:"1",width:"120px"})),e.addControl(ut("parts",()=>{xt.setGUIMode("pcb")},{height:"1",width:"120px"})),e.addControl(ut("files",()=>{xt.setGUIMode("files")},{height:"1",width:"120px"})),xt.modeCtrl=e,r.screengui.addControl(e)}};var Et=n(4);const _t=["assets/carpentry_shop.env","assets/studio_small.env","assets/photo_studio.env","assets/sculpture_exhibition.env","assets/environment.dds"];let Ft=0;function kt(e){fetch(e).then(e=>e.json()).then(e=>{xe(e)})}const Bt=["testkbs/hy_nova.kbd","testkbs/ansi104.kbd","testkbs/fc660m.kbd","testkbs/fake_alice.kle","testkbs/fake_alice_split.kle","testkbs/atreus.kbd","testkbs/basis-mono-og.kle","testkbs/basis-stagger-3.kle","testkbs/kle-ergodox.kle","testkbs/foggy_sp_knobs.kle","testkbs/reddit-9d-ortho.kle","testkbs/boston-noISO.kle","testkbs/atreus_solo.kle","testkbs/blank.kle","testkbs/onekey.kle","testkbs/twokey.kle","testkbs/threekey.kle","testkbs/threekey_split.kle","testkbs/threekeyoffset.kle","testkbs/one_bigass.kle","testkbs/twoonone.kle","testkbs/three_key_vtest.kle","testkbs/fourkeygap.kle","testkbs/atreus_row.kle","testkbs/keysize_test.kle","testkbs/staggertest.kbd"];function Tt(e){return Bt[e]}function St(){Ft=(Ft+1)%Bt.length,kt(Tt(Ft))}function Mt(){Ft=(Ft+Bt.length-1)%Bt.length,kt(Tt(Ft))}function It(){var e;v(De),e=_t[2],r.hdrTextures||(r.hdrTextures={}),r.hdrTextures[e]||(r.hdrTextures[e]=o.CubeTexture.CreateFromPrefilteredData(e,r.scene)),r.scene.environmentTexture=r.hdrTextures[e],xt.addModeGUI();let t=new URLSearchParams(location.search).get("kbIdx");null!==t&&Tt(t)&&(Ft=t),kt(Tt(Ft)),window.addEventListener("resize",(function(){r.engine.resize()})),document.getElementById("loadKLE").onchange=e=>{var t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=e=>{!function(e){let t=JSON.parse(e);xe(Et.Serial.deserialize(t))}(e.target.result)}},document.getElementById("loadKBD").onchange=e=>{var t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=e=>{var t,n=e.target.result;t=n,xe(JSON.parse(t))}},et(r.scene),qe("keydown","i",e=>(window.BABYLON={...o},void(r.scene.debugLayer.isVisible()?r.scene.debugLayer.hide():r.scene.debugLayer.show()))),qe("keydown","k",e=>{i.keyShape=i.keyShape?null:"square",oe()}),qe("keydown","c",e=>{i.drawCase=!i.drawCase,ge()}),qe("keydown","p",e=>{i.drawPlate=!i.drawPlate,ge()}),qe("keydown","o",e=>{i.drawPCB=!i.drawPCB,ge()}),qe("keydown","f",e=>{i.drawPlateFoam=!i.drawPlateFoam,i.drawCaseFoam=!i.drawCaseFoam,ge()}),qe("keydown","b",e=>{i.drawBezel=!i.drawBezel,ge()}),qe("keydown","r",e=>{St()})}window.addEventListener("DOMContentLoaded",(function(){It()}))}]);