!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e={pickedKeys:[],renderData:{keys:{},case:{},mats:{},outlines:{}}},t={keyDims:[18,18],switchCutout:[14,14],base1U:[19.05,19.05],bezelGap:1.05,bezelThickness:5,bezelCornerFillet:.5,keyShape:"square",drawCase:!0,drawBezel:!0,drawPlate:!0,drawPCB:!0};function n(e,t,n,o){let a=t.x*o.z-o.x*t.z;if(Math.abs(a)<BABYLON.Epsilon)return null;let r=e.x*t.x+e.z*t.z,l=n.x*o.x+n.z*o.z;return new BABYLON.Vector3((o.z*r-t.z*l)/a,0,(t.x*l-o.x*r)/a)}function o(e,t,o,a,r,l){let s=l.subtract(r),i={intersection:n(e,a,r,new BABYLON.Vector3(s.z,0,-s.x).normalize()),type:"unknown"};if(i.intersection){let n=BABYLON.Vector3.Dot(i.intersection.subtract(r),s),a=BABYLON.Vector3.Dot(i.intersection.subtract(l),s),c=BABYLON.Vector3.Dot(i.intersection.subtract(e),o),d=BABYLON.Vector3.Dot(i.intersection.subtract(t),o);n>-BABYLON.Epsilon&&a<BABYLON.Epsilon&&c>-BABYLON.Epsilon&&d<BABYLON.Epsilon?i.type="in_segment":i.type="off_segment"}else(function(e,t,n){let o=n.subtract(e),a=t.normalizeToNew(),r=BABYLON.Vector3.Dot(o,a),l=e.add(a.scale(r));return n.subtract(l).lengthSquared()})(e,o,r)<BABYLON.Epsilon?i.type="colinear":i.type="parallel";return i}function a(e,t){for(let n=0;n<t.length;n++){let o=t[n],a=t[(n+1)%t.length].subtract(o).normalize(),r=new BABYLON.Vector3(a.z,0,-a.x),l=e.subtract(o).normalize();if(BABYLON.Vector3.Dot(l,r)>BABYLON.Epsilon)return!1}return!0}function r(e){let t=Math.acos(e.x);return e.z<0&&(t=2*Math.PI-t),t}function l(e,t,n){var o,a=(e.z-n.z)*(t.x-n.x),r=(e.x-n.x)*(t.z-n.z),l=a-r;if(a>0){if(r<=0)return l;o=a+r}else{if(!(a<0))return l;if(r>=0)return l;o=-(a+r)}var s=33306690738754716e-32*o;return l>=s||l<=-s?l:0}function s(e){var t=e.length;if(t<3){for(var n=new Array(t),o=0;o<t;++o)n[o]=o;return 2===t&&e[0].x===e[1].x&&e[0].z===e[1].z?[0]:n}var a=new Array(t);for(o=0;o<t;++o)a[o]=o;a.sort((function(t,n){var o=e[t].x-e[n].x;return o||e[t].z-e[n].z}));var r=[a[0],a[1]],s=[a[0],a[1]];for(o=2;o<t;++o){for(var i=a[o],c=e[i],d=r.length;d>1&&l(e[r[d-2]],e[r[d-1]],c)<=0;)d-=1,r.pop();for(r.push(i),d=s.length;d>1&&l(e[s[d-2]],e[s[d-1]],c)>=0;)d-=1,s.pop();s.push(i)}n=new Array(s.length+r.length-2);for(var B=0,u=(o=0,r.length);o<u;++o)n[B++]=r[o];for(var h=s.length-2;h>0;--h)n[B++]=s[h];let p=[];for(const t of n)p.unshift(e[t]);return p}function i(e,t,o,a,l){let s=[];l||(l=4);for(let a=0;a<e.length;a++){let c=e[a],d=e[(a+1)%e.length],B=e[(a-1+e.length)%e.length],u=d.subtract(c).normalize(),h=c.subtract(B).normalize(),p=new BABYLON.Vector3(u.z,0,-u.x),L=new BABYLON.Vector3(h.z,0,-h.x),b=c.add(L.scale(t)),f=c.add(p.scale(t)),O=n(b,L,f,p);if(null!==O)if(o){let e=o,t=BABYLON.Vector3.Dot(L,u)>0;t&&(e=-e);let a=n(b.add(L.scale(-e)),L,f.add(p.scale(-e)),p),c=r(L)+2*Math.PI,d=r(p)+2*Math.PI;t?(c+=Math.PI,d+=Math.PI,e=-e,c<d&&(c+=2*Math.PI)):d<c&&(d+=2*Math.PI);let B=(d-c)/l;for(let t=0;t<=l;t++)s.push(a.add((i=c+B*t,new BABYLON.Vector3(Math.cos(i),0,Math.sin(i))).scale(e)))}else s.push(O);else s.push(b),s.push(f)}var i;return a&&s.push(s[0]),s}function c(t,n){let o=e.renderData.mats;o[t]=new BABYLON.PBRMetallicRoughnessMaterial(t,e.scene),o[t].metallic=0,o[t].roughness=.6,o[t].baseColor=n,o[t].environmentTexture=e.hdrTexture}function d(){e.canvas=document.getElementById("renderCanvas"),e.engine=new BABYLON.Engine(e.canvas,!0),e.scene=function(){const t=e.engine;var n=new BABYLON.Scene(t),o=new BABYLON.ArcRotateCamera("Camera",-Math.PI/2,0,10,new BABYLON.Vector3(0,0,0),n);return o.setTarget(BABYLON.Vector3.Zero()),o.attachControl(e.canvas,!1),e.camera=o,e.hdrTexture=BABYLON.CubeTexture.CreateFromPrefilteredData("assets/environment.dds",n),e.currentSkybox=n.createDefaultSkybox(e.hdrTexture,!0,(n.activeCamera.maxZ-n.activeCamera.minZ)/2,.3),n}()}function B(){let t=e.renderData.keys,n=e.renderData.outlines,o=e.renderData.mats;for(const[t,o]of Object.entries(n))e.scene.removeMesh(o);for(const a of e.pickedKeys)if(t[a]){let r=t[a];n[a]=BABYLON.MeshBuilder.CreateRibbon(a+"outline",{pathArray:[i(r.outline,.1,.1,!0),i(r.outline,.5,.5,!0)]},e.scene),n[a].material=o.keySel,n[a].translate(new BABYLON.Vector3(0,10.5,0),1,BABYLON.Space.LOCAL)}else console.log("picked nonexistant key")}function u(e,n,o,a,r){let l=[.5*t.switchCutout[0],.5*t.switchCutout[1]],s=o;6==e&&(s=BABYLON.Matrix.Translation(9.525,0,0).multiply(s)),a.push([BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-l[0],0,-l[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(l[0],0,-l[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(l[0],0,l[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-l[0],0,l[1]),s)]);let i=[9,6.75];r.push([BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-i[0],0,-i[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(i[0],0,-i[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(i[0],0,i[1]),s),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-i[0],0,i[1]),s)]);let c=e;n>=1.75&&(c=n,s=BABYLON.Matrix.RotationY(Math.PI/2).multiply(s));let d=[3.5,7.5];if(c>=2){let e=0,t=0;c<=2.75?e=t=11.938:c<=3?e=t=19.05:c<=4?e=t=28.575:c<=4.5?e=t=34.671:c<=5.5?e=t=42.8625:6==c?(e=57.15,t=38.1):e=t=c<=6?47.5:c<=6.25?50:c<=6.5?52.38:c<=7?57.15:66.675;let n=[BABYLON.Matrix.Translation(-e,0,-2).multiply(s),BABYLON.Matrix.Translation(t,0,-2).multiply(s)],o=[new BABYLON.Vector3(-d[0],0,-d[1]),new BABYLON.Vector3(d[0],0,-d[1]),new BABYLON.Vector3(d[0],0,d[1]),new BABYLON.Vector3(-d[0],0,d[1])],l=[3,9.5],i=[new BABYLON.Vector3(-l[0],0,-7),new BABYLON.Vector3(l[0],0,-7),new BABYLON.Vector3(l[0],0,11),new BABYLON.Vector3(-l[0],0,11)];for(let e=0;e<n.length;e++){let t=[];for(let a=0;a<o.length;a++)t.push(BABYLON.Vector3.TransformCoordinates(o[a],n[e]));a.push(t);let l=[];for(let t=0;t<i.length;t++)l.push(BABYLON.Vector3.TransformCoordinates(i[t],n[e]));r.push(l)}}}function h(e){for(const t of e){t.outlineLines=[],t.parsedOutlineLines={};for(let e=0;e<t.bezelHole.length;e++){let n=t.bezelHole[e],o=t.bezelHole[(e+1)%t.bezelHole.length];t.outlineLines.push([n,o])}}let t=BABYLON.Epsilon,n=(e,t,n,o,a,r,l,s)=>{if(!s[e]){let s=Math.max(r-n,0)/t,i=r/t;s<1-BABYLON.Epsilon&&i>BABYLON.Epsilon&&(s>BABYLON.Epsilon&&l.push([o[0],o[0].add(a.scale(r-n))]),i<1-BABYLON.Epsilon&&l.push([o[0].add(a.scale(r)),o[1]]),l.splice(e,1))}};for(const o of e){o.visitedForOutline=!0;for(const[e,a]of Object.entries(o.overlappingKeys))for(let e=o.outlineLines.length-1;e>=0;e--){let r=o.outlineLines[e],l=r[1].subtract(r[0]),s=l.length();if(s<BABYLON.Epsilon)continue;let i=l.normalizeFromLength(s);for(let l=a.outlineLines.length-1;l>0;l--){let c=a.outlineLines[l],d=c[1].subtract(c[0]),B=d.length();if(B<BABYLON.Epsilon)continue;let u=d.normalizeFromLength(B),h=BABYLON.Vector3.Dot(u,i);if(Math.abs(h)>1-BABYLON.Epsilon){let d=r[0].subtract(c[0]);if(d.lengthSquared()<BABYLON.Epsilon){let t=r[1].subtract(c[1]).lengthSquared();if(t<BABYLON.Epsilon||t>s*s){o.outlineLines.splice(e,1);break}r[0]=c[1];break}let p=BABYLON.Vector3.Dot(d,u);if(c[0].add(u.scale(p)).subtract(r[0]).lengthSquared()<t)if(h<BABYLON.Epsilon-1)n(l,B,s,c,u,p,a.outlineLines,a.parsedOutlineLines),n(e,s,B,r,i,p,o.outlineLines,o.parsedOutlineLines);else if(h>1-BABYLON.Epsilon){if(p>BABYLON.Epsilon){let t=B-p;if(!o.parsedOutlineLines[e]&&t>BABYLON.Epsilon){if(s-t<BABYLON.Epsilon){o.outlineLines.splice(e,1);break}r[0]=r[0].add(i.scale(t))}}if(p<BABYLON.Epsilon){let t=-p;if(!o.parsedOutlineLines[e]&&t<s-BABYLON.Epsilon){if(t<BABYLON.Epsilon){o.outlineLines.splice(e,1);break}r[1]=r[0].add(i.scale(t))}}}}}}}for(const t of e)for(const[e,n]of Object.entries(t.overlappingKeys))for(let e=t.outlineLines.length-1;e>=0;e--){let r=t.outlineLines[e],l=r[1].subtract(r[0]),s=new BABYLON.Vector3(l.z,0,-l.x).normalize(),i=[],c=!1;for(let e=0;e<n.bezelHole.length;e++){let t=o(r[0],r[1],l,s,n.bezelHole[e],n.bezelHole[(e+1)%n.bezelHole.length]);if("in_segment"==t.type&&t.intersection)i.push(t.intersection);else if("colinear"==t.type){c=!0;break}}if(c)continue;let d=a(r[0],n.bezelHole),B=a(r[1],n.bezelHole);if(d&&B&&i.length<=1)t.outlineLines.splice(e,1);else if(1==i.length)d?r[0]=i[0]:r[1]=i[0],r[1].subtract(r[0]).lengthSquared()<BABYLON.Epsilon&&t.outlineLines.splice(e,1);else if(i.length>1){i.sort(((e,t)=>e.subtract(r[0]).lengthSquared()-t.subtract(r[0]).lengthSquared()));let n=r[1];r[1]=i[0],r[1].subtract(r[0]).lengthSquared()<BABYLON.Epsilon&&t.outlineLines.splice(e,1);for(let e=2;e<i.length;e+=2)i[e-1].subtract(i[e]).lengthSquared()>BABYLON.Epsilon&&t.outlineLines.push([i[e-1],i[e]]);i.length%2==0&&i[i.length-1].subtract(n).lengthSquared()>BABYLON.Epsilon&&t.outlineLines.push([i[i.length-1],n])}}let r=null,l=-1,s=!1;for(const t of e){for(let e=0;e<t.outlineLines.length;e++)if(!t.parsedOutlineLines[e]){r=t,l=e;break}if(l>=0)break}let i=[];for(;null!=r&&l>=0;){r.parsedOutlineLines[l]=!0;let e=r.outlineLines[l];if(s){let t=e[0];e[0]=e[1],e[1]=t}i.push(e[0]),l=-1;let t=20,n=(n,o,a)=>{let i=e[1].subtract(n[0]).lengthSquared();i<t&&(t=i,r=o,l=a,s=!1),i=e[1].subtract(n[1]).lengthSquared(),i<t&&(t=i,r=o,l=a,s=!0)};for(let e=0;e<r.outlineLines.length;e++)r.parsedOutlineLines[e]||n(r.outlineLines[e],r,e);for(const[e,t]of Object.entries(r.overlappingKeys))for(let e=0;e<t.outlineLines.length;e++)t.parsedOutlineLines[e]||n(t.outlineLines[e],t,e)}return i}function p(){const n=e.scene,o=e.boardData,a=e.renderData.keys,r=e.renderData.mats;if("convex"==o.caseType){let e=[];for(let[t,n]of Object.entries(a))for(let t of n.outline)e.push(t);for(let t of o.pcbOutline)e.push(t);if(o.outline=s(e),o.forceSymmetrical){let t=.5*(o.layout.bounds.maxs[0]-o.layout.bounds.mins[0])+o.layout.bounds.mins[0];for(let n of o.outline)e.push(new BABYLON.Vector3(t-(n.x-t),n.y,n.z));o.outline=s(e)}}else{let e=o.pcbBounds,t=o.layout.bounds;o.outline=[new BABYLON.Vector3(Math.min(t.mins[0],e.mins[0]),0,Math.min(t.mins[1],e.mins[1])),new BABYLON.Vector3(Math.max(t.maxs[0],e.maxs[0]),0,Math.min(t.mins[1],e.mins[1])),new BABYLON.Vector3(Math.max(t.maxs[0],e.maxs[0]),0,Math.max(t.maxs[1],e.maxs[1])),new BABYLON.Vector3(Math.min(t.mins[0],e.mins[0]),0,Math.max(t.maxs[1],e.maxs[1]))]}let l=e.renderData.case,c=[i(o.outline,t.bezelGap,t.bezelCornerFillet,!1)],d=i(o.outline,t.bezelGap+t.bezelThickness,t.bezelThickness,!1,8);if(l.edge&&n.removeMesh(l.edge),t.drawCase&&(l.edge=BABYLON.MeshBuilder.CreatePolygon("edge",{shape:d,depth:9,holes:c,updatable:!0},n),l.edge.translate(new BABYLON.Vector3(0,-1.5,0),1,BABYLON.Space.LOCAL),l.edge.material=r.case),l.bottom&&n.removeMesh(l.bottom),t.drawCase&&(l.bottom=BABYLON.MeshBuilder.CreatePolygon("bottom",{shape:d,depth:3,updatable:!0},n),l.bottom.translate(new BABYLON.Vector3(0,-10.5,0),1,BABYLON.Space.LOCAL),l.bottom.material=r.case),l.pcbMesh&&n.removeMesh(l.pcbMesh),t.drawPCB){let e=i(o.pcbOutline,0,2,!1);l.pcbMesh=BABYLON.MeshBuilder.CreatePolygon("pcbMesh",{shape:e,depth:1.6,updatable:!0},n),l.pcbMesh.translate(new BABYLON.Vector3(0,-5,0),1,BABYLON.Space.LOCAL),l.pcbMesh.material=r.fr4}let B={},u=[];for(const[e,t]of Object.entries(a))B[t.keyGroupId]||(B[t.keyGroupId]=[]),B[t.keyGroupId].push(t);for(const[e,n]of Object.entries(B)){let e=h(n);u.push(i(e,0,t.bezelCornerFillet,!1))}l.bezel&&n.removeMesh(l.bezel),t.drawBezel&&(l.bezel=BABYLON.MeshBuilder.CreatePolygon("bezel",{shape:d,depth:7.5,holes:u},n),l.bezel.translate(new BABYLON.Vector3(0,7.5,0),1,BABYLON.Space.LOCAL),l.bezel.material=r.case),l.plate&&n.removeMesh(l.plate);let p=[];for(const[e,t]of Object.entries(a))p.push(...t.switchCut);t.drawPlate&&(l.plate=BABYLON.MeshBuilder.CreatePolygon("plate",{shape:d,depth:1.5,holes:p},n),l.plate.material=r.plate)}function L(){!function(){const n=e.scene,o=e.boardData;let a=[1e5,1e5],r=[-1e5,-1e5],l=[],i=e.renderData.keys;for(const[e,t]of Object.entries(i))t.keycap&&n.removeMesh(t.keycap);i=e.renderData.keys=[];let c=0;for(const[s,d]of Object.entries(o.layout.keys)){i[s]||(i[s]={keyGroupId:null,id:s,mins:[1e5,1e5],maxs:[-1e5,-1e5],bezelMins:[1e5,1e5],bezelMaxs:[-1e5,-1e5],overlappingKeys:{}});let B=i[s],h=[(t.keyDims[0]+t.base1U[0]*(d.width-1))/2,(t.keyDims[1]+t.base1U[1]*(d.height-1))/2],p=[d.x*t.base1U[0]+h[0],-(d.y*t.base1U[1]+h[1])],L=(new BABYLON.Vector3(p[0],0,p[1]),BABYLON.Matrix.Identity());L=L.multiply(BABYLON.Matrix.Translation(p[0],0,p[1])),0!=d.rotation_angle&&(L=L.multiply(BABYLON.Matrix.Translation(-d.rotation_x*t.base1U[0],0,d.rotation_y*t.base1U[1])),L=L.multiply(BABYLON.Matrix.RotationY(d.rotation_angle*Math.PI/180)),L=L.multiply(BABYLON.Matrix.Translation(d.rotation_x*t.base1U[0],0,-d.rotation_y*t.base1U[1]))),B.outline=[BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-h[0],0,-h[1]),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(h[0],0,-h[1]),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(h[0],0,h[1]),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-h[0],0,h[1]),L)],B.pcbBoxes=[],B.switchCut=[],u(d.width,d.height,L,B.switchCut,B.pcbBoxes),B.keycap&&n.removeMesh(B.keycap),t.keyShape&&(B.keycap=BABYLON.MeshBuilder.CreatePolygon(s,{shape:B.outline,depth:7,updatable:!1},n),B.keycap.translate(new BABYLON.Vector3(0,10.5,0),1,BABYLON.Space.LOCAL),d.matName&&e.renderData.mats[d.matName]&&(B.keycap.material=e.renderData.mats[d.matName])),B.bezelHole=[BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-h[0]-t.bezelGap,0,-h[1]-t.bezelGap),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(h[0]+t.bezelGap,0,-h[1]-t.bezelGap),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(h[0]+t.bezelGap,0,h[1]+t.bezelGap),L),BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-h[0]-t.bezelGap,0,h[1]+t.bezelGap),L)],l.push(B.bezelHole);for(let e of B.bezelHole)B.bezelMins[0]=Math.min(B.bezelMins[0],e.x),B.bezelMaxs[0]=Math.max(B.bezelMaxs[0],e.x),B.bezelMins[1]=Math.min(B.bezelMins[1],e.z),B.bezelMaxs[1]=Math.max(B.bezelMaxs[1],e.z);for(let e of B.outline)B.mins[0]=Math.min(B.mins[0],e.x),B.maxs[0]=Math.max(B.maxs[0],e.x),B.mins[1]=Math.min(B.mins[1],e.z),B.maxs[1]=Math.max(B.maxs[1],e.z);a[0]=Math.min(B.mins[0],a[0]),r[0]=Math.max(B.maxs[0],r[0]),a[1]=Math.min(B.mins[1],a[1]),r[1]=Math.max(B.maxs[1],r[1]);let b=function(e,t,n,o){if(t.bezelMins[0]+BABYLON.Epsilon>o.bezelMaxs[0]||o.bezelMins[0]+BABYLON.Epsilon>t.bezelMaxs[0]||t.bezelMins[1]+BABYLON.Epsilon>o.bezelMaxs[1]||o.bezelMins[1]+BABYLON.Epsilon>t.bezelMaxs[1])return!1;let a=(e,t)=>{for(let n=0;n<e.bezelHole.length;n++){let o=e.bezelHole[(n+1)%e.bezelHole.length].subtract(e.bezelHole[n]),a=!0,r=!0;for(let l=0;l<t.bezelHole.length;l++){let s=BABYLON.Vector3.Dot(o,t.bezelHole[l].subtract(e.bezelHole[n]));r&=s>-BABYLON.Epsilon,a&=s<BABYLON.Epsilon}if(r||a)return!0}return!1},r=a(t,o);if(r||(r=a(o,t)),r)if(t.overlappingKeys[o.id]=o,o.overlappingKeys[t.id]=t,t.keyGroupId&&o.keyGroupId){let e=t.keyGroupId,n=o.keyGroupId;for(const[t,o]of Object.entries(i))o.keyGroupId==n&&(o.keyGroupId=e)}else t.keyGroupId?o.keyGroupId=t.keyGroupId:o.keyGroupId?t.keyGroupId=o.keyGroupId:t.keyGroupId=o.keyGroupId=c++};for(const[e,t]of Object.entries(i))e!=s&&b(d,B,o.layout.keys[e],t);B.keyGroupId||(B.keyGroupId=c++)}let d=[];for(let[e,t]of Object.entries(i))for(let e of t.pcbBoxes)for(let t of e)d.push(t);o.pcbOutline=s(d),o.pcbBounds={mins:[1e5,1e5],maxs:[-1e5,-1e5]};for(let e of o.pcbOutline)o.pcbBounds.mins[0]=Math.min(o.pcbBounds.mins[0],e.x),o.pcbBounds.maxs[0]=Math.max(o.pcbBounds.maxs[0],e.x),o.pcbBounds.mins[1]=Math.min(o.pcbBounds.mins[1],e.z),o.pcbBounds.maxs[1]=Math.max(o.pcbBounds.maxs[1],e.z);o.layout.bounds={mins:a,maxs:r},B()}(),p()}function b(t){fetch(t).then((e=>e.json())).then((t=>{let n=e.renderData.mats,o={};o.meta=t.meta,o.forceSymmetrical=!0,o.caseType="convex",o.case=t.case,o.layout={keys:{}};let a=0;for(let e of t.keys)e.id="key"+a++,n[e.color]||c(e.color,BABYLON.Color3.FromHexString(e.color)),e.matName=e.color,o.layout.keys[e.id]=e;e.boardData=o,function(){let t=e.renderData.mats,n="keySel";t[n]=new BABYLON.StandardMaterial(n,e.scene),t[n].diffuseColor=new BABYLON.Color3(0,0,0),t[n].emissiveColor=new BABYLON.Color3(1,0,0),t[n].specularColor=new BABYLON.Color3(0,0,0);let o="case";t.case=new BABYLON.PBRMetallicRoughnessMaterial(o,e.scene),t.case.metallic=1,t.case.roughness=.8,t.case.baseColor=new BABYLON.Color3(.6,.6,.6),t.case.environmentTexture=e.hdrTexture;let a="plate";t.plate=new BABYLON.PBRMetallicRoughnessMaterial(a,e.scene),t.plate.metallic=1,t.plate.roughness=.2,t.plate.baseColor=new BABYLON.Color3(.5,.5,.5),t.plate.environmentTexture=e.hdrTexture;let r="fr4";t.fr4=new BABYLON.PBRMetallicRoughnessMaterial(r,e.scene),t.fr4.metallic=0,t.fr4.roughness=.2,t.fr4.baseColor=new BABYLON.Color3(41/255,110/255,1/255),t.fr4.environmentTexture=e.hdrTexture,c("key",new BABYLON.Color3(.9,.9,.9))}(),L(),function(){const t=e.boardData;e.camera.setTarget(new BABYLON.Vector3(t.layout.bounds.mins[0]+(t.layout.bounds.maxs[0]-t.layout.bounds.mins[0])/2,0,t.layout.bounds.mins[1]+(t.layout.bounds.maxs[1]-t.layout.bounds.mins[1])/2)),e.camera.alpha=-Math.PI/2,e.camera.beta=0,e.camera.radius=300}()}))}const f={addButton:function(e,t,n){n=n||{};var o=BABYLON.GUI.Button.CreateSimpleButton("button",e);return o.top="0px",o.left="0px",o.width=n.width?n.width:"60px",o.height=n.height?n.height:".4",o.cornerRadius=5,o.thickness=2,o.children[0].color="#DFF9FB",o.children[0].fontSize=24,o.color="#FF7979",o.background="#EB4D4B",o.onPointerClickObservable.add(t),o},addLabel:function(e){var t=new BABYLON.GUI.TextBlock;return t.width="80px",t.height=".9",t.text=e,t.color="white",t.fontSize=24,t},addKeyActionButton:function(t,n){return f.addButton(t,(function(){for(let t of e.pickedKeys){let o=e.boardData.layout.keys[t];n(o)}L()}))},modes:{key:{add:function(){let t=new BABYLON.GUI.StackPanel;t.height=".2",t.isPointerBlocker=!0,t.isVertical=!1,t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,t.addControl(f.addLabel("Pos: ")),t.addControl(f.addKeyActionButton("◄",(e=>e.x-=.25))),t.addControl(f.addKeyActionButton("▲",(e=>e.y-=.25))),t.addControl(f.addKeyActionButton("▼",(e=>e.y+=.25))),t.addControl(f.addKeyActionButton("►",(e=>e.x+=.25))),t.addControl(f.addLabel("Rot: ")),t.addControl(f.addKeyActionButton("⤹",(e=>e.rotation_angle-=5))),t.addControl(f.addKeyActionButton("⤸",(e=>e.rotation_angle+=5))),t.addControl(f.addLabel("W: ")),t.addControl(f.addKeyActionButton("⬌",(e=>e.width+=.25))),t.addControl(f.addKeyActionButton("⬄",(e=>e.width-=.25))),t.addControl(f.addLabel("H: ")),t.addControl(f.addKeyActionButton("⬍",(e=>e.height+=.25))),t.addControl(f.addKeyActionButton("⇳",(e=>e.height-=.25))),e.screengui.addControl(t),f.activeModeCtrl=t}},case:{add:function(){let t=new BABYLON.GUI.StackPanel;t.height=".2",t.isPointerBlocker=!0,t.isVertical=!1,t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,t.addControl(f.addLabel("Type: "));var n=function(t,n){var o=new BABYLON.GUI.RadioButton;o.width="20px",o.height="20px",o.color="white",o.background="green",o.onIsCheckedChangedObservable.add((function(n){n&&(e.boardData.caseType=t,p())}));var a=BABYLON.GUI.Control.AddHeader(o,t,"100px",{isHorizontal:!0,controlFirst:!0});a.height="30px",n.addControl(a)};let o=new BABYLON.GUI.StackPanel;o.height="1",o.width="200px",o.isVertical=!0,n("rectangle",o),n("convex",o),n("concave",o),t.addControl(o);var a=new BABYLON.GUI.Checkbox;a.width="20px",a.height="20px",a.isChecked=!1,a.color="green",a.onIsCheckedChangedObservable.add((function(t){e.boardData.forceSymmetrical=t,p()})),t.addControl(f.addLabel("SYM: ")),t.addControl(a),e.screengui.addControl(t),f.activeModeCtrl=t}},details:{add:function(){let t=new BABYLON.GUI.StackPanel;t.height=".2",t.isPointerBlocker=!0,t.isVertical=!1,t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;let n=f.addLabel("WORK IN PROGRESS.  Press 'r' to cycle keyboards, press 'k', 'b', 'p' and 'c' to toggle rendering of stuff");n.width="1200px",t.addControl(n),e.screengui.addControl(t),f.activeModeCtrl=t}}},setGUIMode:function(t){f.activeModeCtrl&&e.screengui.removeControl(f.activeModeCtrl),f.modes[t]&&f.modes[t].add()},addModeGUI:function(){let t=new BABYLON.GUI.StackPanel;t.height=".1",t.isPointerBlocker=!0,t.isVertical=!1,t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,t.addControl(f.addButton("layout",(()=>{f.setGUIMode("key")}),{height:"1",width:"120px"})),t.addControl(f.addButton("case",(()=>{f.setGUIMode("case")}),{height:"1",width:"120px"})),t.addControl(f.addButton("pcb",(()=>{f.setGUIMode("pcb")}),{height:"1",width:"120px"})),t.addControl(f.addButton("deets",(()=>{f.setGUIMode("details")}),{height:"1",width:"120px"})),f.modeCtrl=t,e.screengui.addControl(t)}};window.addEventListener("DOMContentLoaded",(function(){!function(){d(),e.screengui=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("screenUI"),f.addModeGUI(),e.engine.runRenderLoop((function(){e.scene.render()}));let n=["testkbs/hy_nova.kle","testkbs/ansi104.kle","testkbs/fc660m.kle","testkbs/kle_atreus.kle","testkbs/basis-mono.kle","testkbs/basis-stagger-3.kle","testkbs/kle-ergodox.kle","testkbs/foggy_sp_knobs.kle","testkbs/reddit-9d-ortho.kle","testkbs/onekey.kle","testkbs/twokey.kle","testkbs/threekey.kle","testkbs/threekeyoffset.kle","testkbs/keysize_test.kle"],o=13;b(n[o]),window.addEventListener("resize",(function(){e.engine.resize()})),window.addEventListener("keydown",(a=>{"i"==a.key&&(e.scene.debugLayer.isVisible()?e.scene.debugLayer.hide():e.scene.debugLayer.show()),"k"==a.key&&(t.keyShape=t.keyShape?null:"square",L()),"c"==a.key&&(t.drawCase=!t.drawCase,L()),"p"==a.key&&(t.drawPlate=!t.drawPlate,L()),"e"==a.key&&(t.drawPCB=!t.drawPCB,L()),"b"==a.key&&(t.drawBezel=!t.drawBezel,L()),"r"==a.key&&(o=(o+1)%n.length,b(n[o]))}))}()})),window.addEventListener("click",(function(t){const n=e.scene;var o=n.pick(n.pointerX,n.pointerY);o&&o.pickedMesh&&e.boardData.layout.keys[o.pickedMesh.name]&&(t.metaKey||t.ctrlKey?e.pickedKeys.indexOf(o.pickedMesh.name)>0?e.pickedKeys.splice(e.pickedKeys.indexOf(o.pickedMesh.name),1):e.pickedKeys.push(o.pickedMesh.name):e.pickedKeys=[o.pickedMesh.name],console.log("picked key "+o.pickedMesh.name),B())}))}));
//# sourceMappingURL=pack.js.map
